b5765d0fada67692ae5d34d025e6866c
var assignMergeValue = require("./_assignMergeValue"),
    cloneBuffer = require("./_cloneBuffer"),
    cloneTypedArray = require("./_cloneTypedArray"),
    copyArray = require("./_copyArray"),
    initCloneObject = require("./_initCloneObject"),
    isArguments = require("./isArguments"),
    isArray = require("./isArray"),
    isArrayLikeObject = require("./isArrayLikeObject"),
    isBuffer = require("./isBuffer"),
    isFunction = require("./isFunction"),
    isObject = require("./isObject"),
    isPlainObject = require("./isPlainObject"),
    isTypedArray = require("./isTypedArray"),
    safeGet = require("./_safeGet"),
    toPlainObject = require("./toPlainObject");

function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
  var objValue = safeGet(object, key),
      srcValue = safeGet(source, key),
      stacked = stack.get(srcValue);

  if (stacked) {
    assignMergeValue(object, key, stacked);
    return;
  }

  var newValue = customizer ? customizer(objValue, srcValue, key + '', object, source, stack) : undefined;
  var isCommon = newValue === undefined;

  if (isCommon) {
    var isArr = isArray(srcValue),
        isBuff = !isArr && isBuffer(srcValue),
        isTyped = !isArr && !isBuff && isTypedArray(srcValue);
    newValue = srcValue;

    if (isArr || isBuff || isTyped) {
      if (isArray(objValue)) {
        newValue = objValue;
      } else if (isArrayLikeObject(objValue)) {
        newValue = copyArray(objValue);
      } else if (isBuff) {
        isCommon = false;
        newValue = cloneBuffer(srcValue, true);
      } else if (isTyped) {
        isCommon = false;
        newValue = cloneTypedArray(srcValue, true);
      } else {
        newValue = [];
      }
    } else if (isPlainObject(srcValue) || isArguments(srcValue)) {
      newValue = objValue;

      if (isArguments(objValue)) {
        newValue = toPlainObject(objValue);
      } else if (!isObject(objValue) || isFunction(objValue)) {
        newValue = initCloneObject(srcValue);
      }
    } else {
      isCommon = false;
    }
  }

  if (isCommon) {
    stack.set(srcValue, newValue);
    mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
    stack['delete'](srcValue);
  }

  assignMergeValue(object, key, newValue);
}

module.exports = baseMergeDeep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9iYXNlTWVyZ2VEZWVwLmpzIl0sIm5hbWVzIjpbImFzc2lnbk1lcmdlVmFsdWUiLCJyZXF1aXJlIiwiY2xvbmVCdWZmZXIiLCJjbG9uZVR5cGVkQXJyYXkiLCJjb3B5QXJyYXkiLCJpbml0Q2xvbmVPYmplY3QiLCJpc0FyZ3VtZW50cyIsImlzQXJyYXkiLCJpc0FycmF5TGlrZU9iamVjdCIsImlzQnVmZmVyIiwiaXNGdW5jdGlvbiIsImlzT2JqZWN0IiwiaXNQbGFpbk9iamVjdCIsImlzVHlwZWRBcnJheSIsInNhZmVHZXQiLCJ0b1BsYWluT2JqZWN0IiwiYmFzZU1lcmdlRGVlcCIsIm9iamVjdCIsInNvdXJjZSIsImtleSIsInNyY0luZGV4IiwibWVyZ2VGdW5jIiwiY3VzdG9taXplciIsInN0YWNrIiwib2JqVmFsdWUiLCJzcmNWYWx1ZSIsInN0YWNrZWQiLCJnZXQiLCJuZXdWYWx1ZSIsInVuZGVmaW5lZCIsImlzQ29tbW9uIiwiaXNBcnIiLCJpc0J1ZmYiLCJpc1R5cGVkIiwic2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsZ0JBQWdCLEdBQUdDLE9BQU8sdUJBQTlCO0FBQUEsSUFDSUMsV0FBVyxHQUFHRCxPQUFPLGtCQUR6QjtBQUFBLElBRUlFLGVBQWUsR0FBR0YsT0FBTyxzQkFGN0I7QUFBQSxJQUdJRyxTQUFTLEdBQUdILE9BQU8sZ0JBSHZCO0FBQUEsSUFJSUksZUFBZSxHQUFHSixPQUFPLHNCQUo3QjtBQUFBLElBS0lLLFdBQVcsR0FBR0wsT0FBTyxpQkFMekI7QUFBQSxJQU1JTSxPQUFPLEdBQUdOLE9BQU8sYUFOckI7QUFBQSxJQU9JTyxpQkFBaUIsR0FBR1AsT0FBTyx1QkFQL0I7QUFBQSxJQVFJUSxRQUFRLEdBQUdSLE9BQU8sY0FSdEI7QUFBQSxJQVNJUyxVQUFVLEdBQUdULE9BQU8sZ0JBVHhCO0FBQUEsSUFVSVUsUUFBUSxHQUFHVixPQUFPLGNBVnRCO0FBQUEsSUFXSVcsYUFBYSxHQUFHWCxP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QWM7QUFFWlAsSUFBQUEsS0FBSyxDQUFDVyxHQUFOLENBQVVULFFBQVYsRUFBb0JHLFFBQXBCO0FBQ0FQLElBQUFBLFNBQVMsQ0FBQ08sUUFBRCxFQUFXSCxRQUFYLEVBQXFCTCxRQUFyQixFQUErQkUsVUFBL0IsRUFBMkNDLEtBQTNDLENBQVQ7QUFDQUEsSUFBQUEsS0FBSyxDQUFDLFFBQUQsQ0FBTCxDQUFnQkUsUUFBaEI7QUFDRDs7QUFDRHpCLEVBQUFBLGdCQUFnQixDQUFDaUIsTUFBRCxFQUFTRSxHQUFULEVBQWNTLFFBQWQsQ0FBaEI7QUFDRDs7QUFFRE8sTUFBTSxDQUFDQyxPQUFQLEdBQWlCcEIsYUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXNzaWduTWVyZ2VWYWx1ZSA9IHJlcXVpcmUoJy4vX2Fzc2lnbk1lcmdlVmFsdWUnKSxcbiAgICBjbG9uZUJ1ZmZlciA9IHJlcXVpcmUoJy4vX2Nsb25lQnVmZmVyJyksXG4gICAgY2xvbmVUeXBlZEFycmF5ID0gcmVxdWlyZSgnLi9fY2xvbmVUeXBlZEFycmF5JyksXG4gICAgY29weUFycmF5ID0gcmVxdWlyZSgnLi9fY29weUFycmF5JyksXG4gICAgaW5pdENsb25lT2JqZWN0ID0gcmVxdWlyZSgnLi9faW5pdENsb25lT2JqZWN0JyksXG4gICAgaXNBcmd1bWVudHMgPSByZXF1aXJlKCcuL2lzQXJndW1lbnRzJyksXG4gICAgaXNBcnJheSA9IHJlcXVpcmUoJy4vaXNBcnJheScpLFxuICAgIGlzQXJyYXlMaWtlT2JqZWN0ID0gcmVxdWlyZSgnLi9pc0FycmF5TGlrZU9iamVjdCcpLFxuICAgIGlzQnVmZmVyID0gcmVxdWlyZSgnLi9pc0J1ZmZlcicpLFxuICAgIGlzRnVuY3Rpb24gPSByZXF1aXJlKCcuL2lzRnVuY3Rpb24nKSxcbiAgICBpc09iamVjdCA9IHJlcXVpcmUoJy4vaXNPYmplY3QnKSxcbiAgICBpc1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnLi9pc1BsYWluT2JqZWN0JyksXG4gICAgaXNUeXBlZEFycmF5ID0gcmVxdWlyZSgnLi9pc1R5cGVkQXJyYXknKSxcbiAgICBzYWZlR2V0ID0gcmVxdWlyZSgnLi9fc2FmZUdldCcpLFxuICAgIHRvUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuL3RvUGxhaW5PYmplY3QnKTtcblxuLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VNZXJnZWAgZm9yIGFycmF5cyBhbmQgb2JqZWN0cyB3aGljaCBwZXJmb3Jtc1xuICogZGVlcCBtZXJnZXMgYW5kIHRyYWNrcyB0cmF2ZXJzZWQgb2JqZWN0cyBlbmFibGluZyBvYmplY3RzIHdpdGggY2lyY3VsYXJcbiAqIHJlZmVyZW5jZXMgdG8gYmUgbWVyZ2VkLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBtZXJnZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzcmNJbmRleCBUaGUgaW5kZXggb2YgYHNvdXJjZWAuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXJnZUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1lcmdlIHZhbHVlcy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgc291cmNlIHZhbHVlcyBhbmQgdGhlaXIgbWVyZ2VkXG4gKiAgY291bnRlcnBhcnRzLlxuICovXG5mdW5jdGlvbiBiYXNlTWVyZ2VEZWVwKG9iamVjdCwgc291cmNlLCBrZXksIHNyY0luZGV4LCBtZXJnZUZ1bmMsIGN1c3RvbWl6ZXIsIHN0YWNrKSB7XG4gIHZhciBvYmpWYWx1ZSA9IHNhZmVHZXQob2JqZWN0LCBrZXkpLFxuICAgICAgc3JjVmFsdWUgPSBzYWZlR2V0KHNvdXJjZSwga2V5KSxcbiAgICAgIHN0YWNrZWQgPSBzdGFjay5nZXQoc3JjVmFsdWUpO1xuXG4gIGlmIChzdGFja2VkKSB7XG4gICAgYXNzaWduTWVyZ2VWYWx1ZShvYmplY3QsIGtleSwgc3RhY2tlZCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBuZXdWYWx1ZSA9IGN1c3RvbWl6ZXJcbiAgICA/IGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlLCAoa2V5ICsgJycpLCBvYmplY3QsIHNvdXJjZSwgc3RhY2spXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgdmFyIGlzQ29tbW9uID0gbmV3VmFsdWUgPT09IHVuZGVmaW5lZDtcblxuICBpZiAoaXNDb21tb24pIHtcbiAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHNyY1ZhbHVlKSxcbiAgICAgICAgaXNCdWZmID0gIWlzQXJyICYmIGlzQnVmZmVyKHNyY1ZhbHVlKSxcbiAgICAgICAgaXNUeXBlZCA9ICFpc0FyciAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheShzcmNWYWx1ZSk7XG5cbiAgICBuZXdWYWx1ZSA9IHNyY1ZhbHVlO1xuICAgIGlmIChpc0FyciB8fCBpc0J1ZmYgfHwgaXNUeXBlZCkge1xuICAgICAgaWYgKGlzQXJyYXkob2JqVmFsdWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlID0gb2JqVmFsdWU7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChpc0FycmF5TGlrZU9iamVjdChvYmpWYWx1ZSkpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBjb3B5QXJyYXkob2JqVmFsdWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNCdWZmKSB7XG4gICAgICAgIGlzQ29tbW9uID0gZmFsc2U7XG4gICAgICAgIG5ld1ZhbHVlID0gY2xvbmVCdWZmZXIoc3JjVmFsdWUsIHRydWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNUeXBlZCkge1xuICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICBuZXdWYWx1ZSA9IGNsb25lVHlwZWRBcnJheShzcmNWYWx1ZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbmV3VmFsdWUgPSBbXTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoaXNQbGFpbk9iamVjdChzcmNWYWx1ZSkgfHwgaXNBcmd1bWVudHMoc3JjVmFsdWUpKSB7XG4gICAgICBuZXdWYWx1ZSA9IG9ialZhbHVlO1xuICAgICAgaWYgKGlzQXJndW1lbnRzKG9ialZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IHRvUGxhaW5PYmplY3Qob2JqVmFsdWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoIWlzT2JqZWN0KG9ialZhbHVlKSB8fCBpc0Z1bmN0aW9uKG9ialZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IGluaXRDbG9uZU9iamVjdChzcmNWYWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaXNDb21tb24gPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgaWYgKGlzQ29tbW9uKSB7XG4gICAgLy8gUmVjdXJzaXZlbHkgbWVyZ2Ugb2JqZWN0cyBhbmQgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgc3RhY2suc2V0KHNyY1ZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgbWVyZ2VGdW5jKG5ld1ZhbHVlLCBzcmNWYWx1ZSwgc3JjSW5kZXgsIGN1c3RvbWl6ZXIsIHN0YWNrKTtcbiAgICBzdGFja1snZGVsZXRlJ10oc3JjVmFsdWUpO1xuICB9XG4gIGFzc2lnbk1lcmdlVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBiYXNlTWVyZ2VEZWVwO1xuIl19