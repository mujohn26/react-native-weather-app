4215b4186b4dd3c7884cbfdde52f6921
"use strict";

module.exports = parse;
var re_name = /^(?:\\.|[\w\-\u00b0-\uFFFF])+/,
    re_escape = /\\([\da-f]{1,6}\s?|(\s)|.)/ig,
    re_attr = /^\s*((?:\\.|[\w\u00b0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])([^]*?)\3|(#?(?:\\.|[\w\u00b0-\uFFFF\-])*)|)|)\s*(i)?\]/;
var actionTypes = {
  __proto__: null,
  "undefined": "exists",
  "": "equals",
  "~": "element",
  "^": "start",
  "$": "end",
  "*": "any",
  "!": "not",
  "|": "hyphen"
};
var simpleSelectors = {
  __proto__: null,
  ">": "child",
  "<": "parent",
  "~": "sibling",
  "+": "adjacent"
};
var attribSelectors = {
  __proto__: null,
  "#": ["id", "equals"],
  ".": ["class", "element"]
};
var unpackPseudos = {
  __proto__: null,
  "has": true,
  "not": true,
  "matches": true
};
var stripQuotesFromPseudos = {
  __proto__: null,
  "contains": true,
  "icontains": true
};
var quotes = {
  __proto__: null,
  "\"": true,
  "'": true
};

function funescape(_, escaped, escapedWhitespace) {
  var high = "0x" + escaped - 0x10000;
  return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 0x10000) : String.fromCharCode(high >> 10 | 0xD800, high & 0x3FF | 0xDC00);
}

function unescapeCSS(str) {
  return str.replace(re_escape, funescape);
}

function isWhitespace(c) {
  return c === " " || c === "\n" || c === "\t" || c === "\f" || c === "\r";
}

function parse(selector, options) {
  var subselects = [];
  selector = parseSelector(subselects, selector + "", options);

  if (selector !== "") {
    throw new SyntaxError("Unmatched selector: " + selector);
  }

  return subselects;
}

function parseSelector(subselects, selector, options) {
  var tokens = [],
      sawWS = false,
      data,
      firstChar,
      name,
      quot;

  function getName() {
    var sub = selector.match(re_name)[0];
    selector = selector.substr(sub.length);
    return unescapeCSS(sub);
  }

  function stripWhitespace(start) {
    while (isWhitespace(selector.charAt(start))) {
      start++;
    }

    selector = selector.substr(start);
  }

  function isEscaped(pos) {
    var slashCount = 0;

    while (selector.charAt(--pos) === "\\") {
      slashCount++;
    }

    return (slashCount & 1) === 1;
  }

  stripWhitespace(0);

  while (selector !== "") {
    firstChar = selector.charAt(0);

    if (isWhitespace(firstChar)) {
      sawWS = true;
      stripWhitespace(1);
    } else if (firstChar in simpleSelectors) {
      tokens.push({
        type: simpleSelectors[firstChar]
      });
      sawWS = false;
      stripWhitespace(1);
    } else if (firstChar === ",") {
      if (tokens.length === 0) {
        throw new SyntaxError("empty sub-selector");
      }

      subselects.push(tokens);
      tokens = [];
      sawWS = false;
      stripWhitespace(1);
    } else {
      if (sawWS) {
        if (tokens.length > 0) {
          tokens.push({
            type: "descendant"
          });
        }

        sawWS = false;
      }

      if (firstChar === "*") {
        selector = selector.substr(1);
        tokens.push({
          type: "universal"
        });
      } else if (firstChar in attribSelectors) {
        selector = selector.substr(1);
        tokens.push({
          type: "attribute",
          name: attribSelectors[firstChar][0],
          action: attribSelectors[firstChar][1],
          value: getName(),
          ignoreCase: false
        });
      } else if (firstChar === "[") {
        selector = selector.substr(1);
        data = selector.match(re_attr);

        if (!data) {
          throw new SyntaxError("Malformed attribute selector: " + selector);
        }

        selector = selector.substr(data[0].length);
        name = unescapeCSS(data[1]);

        if (!options || ("lowerCaseAttributeNames" in options ? options.lowerCaseAttributeNames : !options.xmlMode)) {
          name = name.toLowerCase();
        }

        tokens.push({
          type: "attribute",
          name: name,
          action: actionTypes[data[2]],
          value: unescapeCSS(data[4] || data[5] || ""),
          ignoreCase: !!data[6]
        });
      } else if (firstChar === ":") {
        if (selector.charAt(1) === ":") {
          selector = selector.substr(2);
          tokens.push({
            type: "pseudo-element",
            name: getName().toLowerCase()
          });
          continue;
        }

        selector = selector.substr(1);
        name = getName().toLowerCase();
        data = null;

        if (selector.charAt(0) === "(") {
          if (name in unpackPseudos) {
            quot = selector.charAt(1);
            var quoted = (quot in quotes);
            selector = selector.substr(quoted + 1);
            data = [];
            selector = parseSelector(data, selector, options);

            if (quoted) {
              if (selector.charAt(0) !== quot) {
                throw new SyntaxError("unmatched quotes in :" + name);
              } else {
                selector = selector.substr(1);
              }
            }

            if (selector.charAt(0) !== ")") {
              throw new SyntaxError("missing closing parenthesis in :" + name + " " + selector);
            }

            selector = selector.substr(1);
          } else {
            var pos = 1,
                counter = 1;

            for (; counter > 0 && pos < selector.length; pos++) {
              if (selector.charAt(pos) === "(" && !isEscaped(pos)) counter++;else if (selector.charAt(pos) === ")" && !isEscaped(pos)) counter--;
            }

            if (counter) {
              throw new SyntaxError("parenthesis not matched");
            }

            data = selector.substr(1, pos - 2);
            selector = selector.substr(pos);

            if (name in stripQuotesFromPseudos) {
              quot = data.charAt(0);

              if (quot === data.slice(-1) && quot in quotes) {
                data = data.slice(1, -1);
              }

              data = unescapeCSS(data);
            }
          }
        }

        tokens.push({
          type: "pseudo",
          name: name,
          data: data
        });
      } else if (re_name.test(selector)) {
        name = getName();

        if (!options || ("lowerCaseTags" in options ? options.lowerCaseTags : !options.xmlMode)) {
          name = name.toLowerCase();
        }

        tokens.push({
          type: "tag",
          name: name
        });
      } else {
        if (tokens.length && tokens[tokens.length - 1].type === "descendant") {
          tokens.pop();
        }

        addToken(subselects, tokens);
        return selector;
      }
    }
  }

  addToken(subselects, tokens);
  return selector;
}

function addToken(subselects, tokens) {
  if (subselects.length > 0 && tokens.length === 0) {
    throw new SyntaxError("empty sub-selector");
  }

  subselects.push(tokens);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZSIsInJlX25hbWUiLCJyZV9lc2NhcGUiLCJyZV9hdHRyIiwiYWN0aW9uVHlwZXMiLCJfX3Byb3RvX18iLCJzaW1wbGVTZWxlY3RvcnMiLCJhdHRyaWJTZWxlY3RvcnMiLCJ1bnBhY2tQc2V1ZG9zIiwic3RyaXBRdW90ZXNGcm9tUHNldWRvcyIsInF1b3RlcyIsImZ1bmVzY2FwZSIsIl8iLCJlc2NhcGVkIiwiZXNjYXBlZFdoaXRlc3BhY2UiLCJoaWdoIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwidW5lc2NhcGVDU1MiLCJzdHIiLCJyZXBsYWNlIiwiaXNXaGl0ZXNwYWNlIiwiYyIsInNlbGVjdG9yIiwib3B0aW9ucyIsInN1YnNlbGVjdHMiLCJwYXJzZVNlbGVjdG9yIiwiU3ludGF4RXJyb3IiLCJ0b2tlbnMiLCJzYXdXUyIsImRhdGEiLCJmaXJzdENoYXIiLCJuYW1lIiwicXVvdCIsImdldE5hbWUiLCJzdWIiLCJtYXRjaCIsInN1YnN0ciIsImxlbmd0aCIsInN0cmlwV2hpdGVzcGFjZSIsInN0YXJ0IiwiY2hhckF0IiwiaXNFc2NhcGVkIiwicG9zIiwic2xhc2hDb3VudCIsInB1c2giLCJ0eXBlIiwiYWN0aW9uIiwidmFsdWUiLCJpZ25vcmVDYXNlIiwibG93ZXJDYXNlQXR0cmlidXRlTmFtZXMiLCJ4bWxNb2RlIiwidG9Mb3dlckNhc2UiLCJxdW90ZWQiLCJjb3VudGVyIiwic2xpY2UiLCJ0ZXN0IiwibG93ZXJDYXNlVGFncyIsInBvcCIsImFkZFRva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxPQUFQLEdBQWlCQyxLQUFqQjtBQUVBLElBQUlDLE9BQU8sR0FBRywrQkFBZDtBQUFBLElBQ0lDLFNBQVMsR0FBRyw4QkFEaEI7QUFBQSxJQUdJQyxPQUFPLEdBQUcsbUhBSGQ7QUFLQSxJQUFJQyxXQUFXLEdBQUc7QUFDakJDLEVBQUFBLFNBQVMs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QlEsSUFBMUIsS0FBbUMsWUFBdkQsRUFBb0U7QUFDbkVsQixVQUFBQSxNQUFNLENBQUM4QixHQUFQO0FBQ0E7O0FBQ0RDLFFBQUFBLFFBQVEsQ0FBQ2xDLFVBQUQsRUFBYUcsTUFBYixDQUFSO0FBQ0EsZUFBT0wsUUFBUDtBQUNBO0FBQ0Q7QUFDRDs7QUFFRG9DLEVBQUFBLFFBQVEsQ0FBQ2xDLFVBQUQsRUFBYUcsTUFBYixDQUFSO0FBRUEsU0FBT0wsUUFBUDtBQUNBOztBQUVELFNBQVNvQyxRQUFULENBQWtCbEMsVUFBbEIsRUFBOEJHLE1BQTlCLEVBQXFDO0FBQ3BDLE1BQUdILFVBQVUsQ0FBQ2EsTUFBWCxHQUFvQixDQUFwQixJQUF5QlYsTUFBTSxDQUFDVSxNQUFQLEtBQWtCLENBQTlDLEVBQWdEO0FBQy9DLFVBQU0sSUFBSVgsV0FBSixDQUFnQixvQkFBaEIsQ0FBTjtBQUNBOztBQUVERixFQUFBQSxVQUFVLENBQUNvQixJQUFYLENBQWdCakIsTUFBaEI7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHBhcnNlO1xuXG52YXIgcmVfbmFtZSA9IC9eKD86XFxcXC58W1xcd1xcLVxcdTAwYjAtXFx1RkZGRl0pKy8sXG4gICAgcmVfZXNjYXBlID0gL1xcXFwoW1xcZGEtZl17MSw2fVxccz98KFxccyl8LikvaWcsXG4gICAgLy9tb2RpZmllZCB2ZXJzaW9uIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvc2l6emxlL2Jsb2IvbWFzdGVyL3NyYy9zaXp6bGUuanMjTDg3XG4gICAgcmVfYXR0ciA9IC9eXFxzKigoPzpcXFxcLnxbXFx3XFx1MDBiMC1cXHVGRkZGXFwtXSkrKVxccyooPzooXFxTPyk9XFxzKig/OihbJ1wiXSkoW15dKj8pXFwzfCgjPyg/OlxcXFwufFtcXHdcXHUwMGIwLVxcdUZGRkZcXC1dKSopfCl8KVxccyooaSk/XFxdLztcblxudmFyIGFjdGlvblR5cGVzID0ge1xuXHRfX3Byb3RvX186IG51bGwsXG5cdFwidW5kZWZpbmVkXCI6IFwiZXhpc3RzXCIsXG5cdFwiXCI6ICBcImVxdWFsc1wiLFxuXHRcIn5cIjogXCJlbGVtZW50XCIsXG5cdFwiXlwiOiBcInN0YXJ0XCIsXG5cdFwiJFwiOiBcImVuZFwiLFxuXHRcIipcIjogXCJhbnlcIixcblx0XCIhXCI6IFwibm90XCIsXG5cdFwifFwiOiBcImh5cGhlblwiXG59O1xuXG52YXIgc2ltcGxlU2VsZWN0b3JzID0ge1xuXHRfX3Byb3RvX186IG51bGwsXG5cdFwiPlwiOiBcImNoaWxkXCIsXG5cdFwiPFwiOiBcInBhcmVudFwiLFxuXHRcIn5cIjogXCJzaWJsaW5nXCIsXG5cdFwiK1wiOiBcImFkamFjZW50XCJcbn07XG5cbnZhciBhdHRyaWJTZWxlY3RvcnMgPSB7XG5cdF9fcHJvdG9fXzogbnVsbCxcblx0XCIjXCI6IFtcImlkXCIsIFwiZXF1YWxzXCJdLFxuXHRcIi5cIjogW1wiY2xhc3NcIiwgXCJlbGVtZW50XCJdXG59O1xuXG4vL3BzZXVkb3MsIHdob3NlIGRhdGEtcHJvcGVydHkgaXMgcGFyc2VkIGFzIHdlbGxcbnZhciB1bnBhY2tQc2V1ZG9zID0ge1xuXHRfX3Byb3RvX186IG51bGwsXG5cdFwiaGFzXCI6IHRydWUsXG5cdFwibm90XCI6IHRydWUsXG5cdFwibWF0Y2hlc1wiOiB0cnVlXG59O1xuXG52YXIgc3RyaXBRdW90ZXNGcm9tUHNldWRvcyA9IHtcblx0X19wcm90b19fOiBudWxsLFxuXHRcImNvbnRhaW5zXCI6IHRydWUsXG5cdFwiaWNvbnRhaW5zXCI6IHRydWVcbn07XG5cbnZhciBxdW90ZXMgPSB7XG5cdF9fcHJvdG9fXzogbnVsbCxcblx0XCJcXFwiXCI6IHRydWUsXG5cdFwiJ1wiOiB0cnVlXG59O1xuXG4vL3VuZXNjYXBlIGZ1bmN0aW9uIHRha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvYmxvYi9tYXN0ZXIvc3JjL3NpenpsZS5qcyNMMTM5XG5mdW5jdGlvbiBmdW5lc2NhcGUoIF8sIGVzY2FwZWQsIGVzY2FwZWRXaGl0ZXNwYWNlICkge1xuXHR2YXIgaGlnaCA9IFwiMHhcIiArIGVzY2FwZWQgLSAweDEwMDAwO1xuXHQvLyBOYU4gbWVhbnMgbm9uLWNvZGVwb2ludFxuXHQvLyBTdXBwb3J0OiBGaXJlZm94XG5cdC8vIFdvcmthcm91bmQgZXJyb25lb3VzIG51bWVyaWMgaW50ZXJwcmV0YXRpb24gb2YgK1wiMHhcIlxuXHRyZXR1cm4gaGlnaCAhPT0gaGlnaCB8fCBlc2NhcGVkV2hpdGVzcGFjZSA/XG5cdFx0ZXNjYXBlZCA6XG5cdFx0Ly8gQk1QIGNvZGVwb2ludFxuXHRcdGhpZ2ggPCAwID9cblx0XHRcdFN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOlxuXHRcdFx0Ly8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpXG5cdFx0XHRTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTtcbn1cblxuZnVuY3Rpb24gdW5lc2NhcGVDU1Moc3RyKXtcblx0cmV0dXJuIHN0ci5yZXBsYWNlKHJlX2VzY2FwZSwgZnVuZXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKGMpe1xuXHRyZXR1cm4gYyA9PT0gXCIgXCIgfHwgYyA9PT0gXCJcXG5cIiB8fCBjID09PSBcIlxcdFwiIHx8IGMgPT09IFwiXFxmXCIgfHwgYyA9PT0gXCJcXHJcIjtcbn1cblxuZnVuY3Rpb24gcGFyc2Uoc2VsZWN0b3IsIG9wdGlvbnMpe1xuXHR2YXIgc3Vic2VsZWN0cyA9IFtdO1xuXG5cdHNlbGVjdG9yID0gcGFyc2VTZWxlY3RvcihzdWJzZWxlY3RzLCBzZWxlY3RvciArIFwiXCIsIG9wdGlvbnMpO1xuXG5cdGlmKHNlbGVjdG9yICE9PSBcIlwiKXtcblx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJVbm1hdGNoZWQgc2VsZWN0b3I6IFwiICsgc2VsZWN0b3IpO1xuXHR9XG5cblx0cmV0dXJuIHN1YnNlbGVjdHM7XG59XG5cbmZ1bmN0aW9uIHBhcnNlU2VsZWN0b3Ioc3Vic2VsZWN0cywgc2VsZWN0b3IsIG9wdGlvbnMpe1xuXHR2YXIgdG9rZW5zID0gW10sXG5cdFx0c2F3V1MgPSBmYWxzZSxcblx0XHRkYXRhLCBmaXJzdENoYXIsIG5hbWUsIHF1b3Q7XG5cblx0ZnVuY3Rpb24gZ2V0TmFtZSgpe1xuXHRcdHZhciBzdWIgPSBzZWxlY3Rvci5tYXRjaChyZV9uYW1lKVswXTtcblx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cihzdWIubGVuZ3RoKTtcblx0XHRyZXR1cm4gdW5lc2NhcGVDU1Moc3ViKTtcblx0fVxuXG5cdGZ1bmN0aW9uIHN0cmlwV2hpdGVzcGFjZShzdGFydCl7XG5cdFx0d2hpbGUoaXNXaGl0ZXNwYWNlKHNlbGVjdG9yLmNoYXJBdChzdGFydCkpKSBzdGFydCsrO1xuXHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKHN0YXJ0KTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzRXNjYXBlZChwb3MpIHtcblx0XHR2YXIgc2xhc2hDb3VudCA9IDA7XG5cblx0XHR3aGlsZSAoc2VsZWN0b3IuY2hhckF0KC0tcG9zKSA9PT0gXCJcXFxcXCIpIHNsYXNoQ291bnQrKztcblx0XHRyZXR1cm4gKHNsYXNoQ291bnQgJiAxKSA9PT0gMTtcblx0fVxuXG5cdHN0cmlwV2hpdGVzcGFjZSgwKTtcblxuXHR3aGlsZShzZWxlY3RvciAhPT0gXCJcIil7XG5cdFx0Zmlyc3RDaGFyID0gc2VsZWN0b3IuY2hhckF0KDApO1xuXG5cdFx0aWYoaXNXaGl0ZXNwYWNlKGZpcnN0Q2hhcikpe1xuXHRcdFx0c2F3V1MgPSB0cnVlO1xuXHRcdFx0c3RyaXBXaGl0ZXNwYWNlKDEpO1xuXHRcdH0gZWxzZSBpZihmaXJzdENoYXIgaW4gc2ltcGxlU2VsZWN0b3JzKXtcblx0XHRcdHRva2Vucy5wdXNoKHt0eXBlOiBzaW1wbGVTZWxlY3RvcnNbZmlyc3RDaGFyXX0pO1xuXHRcdFx0c2F3V1MgPSBmYWxzZTtcblxuXHRcdFx0c3RyaXBXaGl0ZXNwYWNlKDEpO1xuXHRcdH0gZWxzZSBpZihmaXJzdENoYXIgPT09IFwiLFwiKXtcblx0XHRcdGlmKHRva2Vucy5sZW5ndGggPT09IDApe1xuXHRcdFx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJlbXB0eSBzdWItc2VsZWN0b3JcIik7XG5cdFx0XHR9XG5cdFx0XHRzdWJzZWxlY3RzLnB1c2godG9rZW5zKTtcblx0XHRcdHRva2VucyA9IFtdO1xuXHRcdFx0c2F3V1MgPSBmYWxzZTtcblx0XHRcdHN0cmlwV2hpdGVzcGFjZSgxKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYoc2F3V1Mpe1xuXHRcdFx0XHRpZih0b2tlbnMubGVuZ3RoID4gMCl7XG5cdFx0XHRcdFx0dG9rZW5zLnB1c2goe3R5cGU6IFwiZGVzY2VuZGFudFwifSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2F3V1MgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYoZmlyc3RDaGFyID09PSBcIipcIil7XG5cdFx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKDEpO1xuXHRcdFx0XHR0b2tlbnMucHVzaCh7dHlwZTogXCJ1bml2ZXJzYWxcIn0pO1xuXHRcdFx0fSBlbHNlIGlmKGZpcnN0Q2hhciBpbiBhdHRyaWJTZWxlY3RvcnMpe1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblx0XHRcdFx0dG9rZW5zLnB1c2goe1xuXHRcdFx0XHRcdHR5cGU6IFwiYXR0cmlidXRlXCIsXG5cdFx0XHRcdFx0bmFtZTogYXR0cmliU2VsZWN0b3JzW2ZpcnN0Q2hhcl1bMF0sXG5cdFx0XHRcdFx0YWN0aW9uOiBhdHRyaWJTZWxlY3RvcnNbZmlyc3RDaGFyXVsxXSxcblx0XHRcdFx0XHR2YWx1ZTogZ2V0TmFtZSgpLFxuXHRcdFx0XHRcdGlnbm9yZUNhc2U6IGZhbHNlXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmKGZpcnN0Q2hhciA9PT0gXCJbXCIpe1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblx0XHRcdFx0ZGF0YSA9IHNlbGVjdG9yLm1hdGNoKHJlX2F0dHIpO1xuXHRcdFx0XHRpZighZGF0YSl7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwiTWFsZm9ybWVkIGF0dHJpYnV0ZSBzZWxlY3RvcjogXCIgKyBzZWxlY3Rvcik7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoZGF0YVswXS5sZW5ndGgpO1xuXHRcdFx0XHRuYW1lID0gdW5lc2NhcGVDU1MoZGF0YVsxXSk7XG5cblx0XHRcdFx0aWYoXG5cdFx0XHRcdFx0IW9wdGlvbnMgfHwgKFxuXHRcdFx0XHRcdFx0XCJsb3dlckNhc2VBdHRyaWJ1dGVOYW1lc1wiIGluIG9wdGlvbnMgP1xuXHRcdFx0XHRcdFx0XHRvcHRpb25zLmxvd2VyQ2FzZUF0dHJpYnV0ZU5hbWVzIDpcblx0XHRcdFx0XHRcdFx0IW9wdGlvbnMueG1sTW9kZVxuXHRcdFx0XHRcdClcblx0XHRcdFx0KXtcblx0XHRcdFx0XHRuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dG9rZW5zLnB1c2goe1xuXHRcdFx0XHRcdHR5cGU6IFwiYXR0cmlidXRlXCIsXG5cdFx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0XHRhY3Rpb246IGFjdGlvblR5cGVzW2RhdGFbMl1dLFxuXHRcdFx0XHRcdHZhbHVlOiB1bmVzY2FwZUNTUyhkYXRhWzRdIHx8IGRhdGFbNV0gfHwgXCJcIiksXG5cdFx0XHRcdFx0aWdub3JlQ2FzZTogISFkYXRhWzZdXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHR9IGVsc2UgaWYoZmlyc3RDaGFyID09PSBcIjpcIil7XG5cdFx0XHRcdGlmKHNlbGVjdG9yLmNoYXJBdCgxKSA9PT0gXCI6XCIpe1xuXHRcdFx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKDIpO1xuXHRcdFx0XHRcdHRva2Vucy5wdXNoKHt0eXBlOiBcInBzZXVkby1lbGVtZW50XCIsIG5hbWU6IGdldE5hbWUoKS50b0xvd2VyQ2FzZSgpfSk7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblxuXHRcdFx0XHRuYW1lID0gZ2V0TmFtZSgpLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdGRhdGEgPSBudWxsO1xuXG5cdFx0XHRcdGlmKHNlbGVjdG9yLmNoYXJBdCgwKSA9PT0gXCIoXCIpe1xuXHRcdFx0XHRcdGlmKG5hbWUgaW4gdW5wYWNrUHNldWRvcyl7XG5cdFx0XHRcdFx0XHRxdW90ID0gc2VsZWN0b3IuY2hhckF0KDEpO1xuXHRcdFx0XHRcdFx0dmFyIHF1b3RlZCA9IHF1b3QgaW4gcXVvdGVzO1xuXG5cdFx0XHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cihxdW90ZWQgKyAxKTtcblxuXHRcdFx0XHRcdFx0ZGF0YSA9IFtdO1xuXHRcdFx0XHRcdFx0c2VsZWN0b3IgPSBwYXJzZVNlbGVjdG9yKGRhdGEsIHNlbGVjdG9yLCBvcHRpb25zKTtcblxuXHRcdFx0XHRcdFx0aWYocXVvdGVkKXtcblx0XHRcdFx0XHRcdFx0aWYoc2VsZWN0b3IuY2hhckF0KDApICE9PSBxdW90KXtcblx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJ1bm1hdGNoZWQgcXVvdGVzIGluIDpcIiArIG5hbWUpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmKHNlbGVjdG9yLmNoYXJBdCgwKSAhPT0gXCIpXCIpe1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJtaXNzaW5nIGNsb3NpbmcgcGFyZW50aGVzaXMgaW4gOlwiICsgbmFtZSArIFwiIFwiICsgc2VsZWN0b3IpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dmFyIHBvcyA9IDEsIGNvdW50ZXIgPSAxO1xuXG5cdFx0XHRcdFx0XHRmb3IoOyBjb3VudGVyID4gMCAmJiBwb3MgPCBzZWxlY3Rvci5sZW5ndGg7IHBvcysrKXtcblx0XHRcdFx0XHRcdFx0aWYoc2VsZWN0b3IuY2hhckF0KHBvcykgPT09IFwiKFwiICYmICFpc0VzY2FwZWQocG9zKSkgY291bnRlcisrO1xuXHRcdFx0XHRcdFx0XHRlbHNlIGlmKHNlbGVjdG9yLmNoYXJBdChwb3MpID09PSBcIilcIiAmJiAhaXNFc2NhcGVkKHBvcykpIGNvdW50ZXItLTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYoY291bnRlcil7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBTeW50YXhFcnJvcihcInBhcmVudGhlc2lzIG5vdCBtYXRjaGVkXCIpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRkYXRhID0gc2VsZWN0b3Iuc3Vic3RyKDEsIHBvcyAtIDIpO1xuXHRcdFx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIocG9zKTtcblxuXHRcdFx0XHRcdFx0aWYobmFtZSBpbiBzdHJpcFF1b3Rlc0Zyb21Qc2V1ZG9zKXtcblx0XHRcdFx0XHRcdFx0cXVvdCA9IGRhdGEuY2hhckF0KDApO1xuXG5cdFx0XHRcdFx0XHRcdGlmKHF1b3QgPT09IGRhdGEuc2xpY2UoLTEpICYmIHF1b3QgaW4gcXVvdGVzKXtcblx0XHRcdFx0XHRcdFx0XHRkYXRhID0gZGF0YS5zbGljZSgxLCAtMSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRkYXRhID0gdW5lc2NhcGVDU1MoZGF0YSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dG9rZW5zLnB1c2goe3R5cGU6IFwicHNldWRvXCIsIG5hbWU6IG5hbWUsIGRhdGE6IGRhdGF9KTtcblx0XHRcdH0gZWxzZSBpZihyZV9uYW1lLnRlc3Qoc2VsZWN0b3IpKXtcblx0XHRcdFx0bmFtZSA9IGdldE5hbWUoKTtcblxuXHRcdFx0XHRpZighb3B0aW9ucyB8fCAoXCJsb3dlckNhc2VUYWdzXCIgaW4gb3B0aW9ucyA/IG9wdGlvbnMubG93ZXJDYXNlVGFncyA6ICFvcHRpb25zLnhtbE1vZGUpKXtcblx0XHRcdFx0XHRuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dG9rZW5zLnB1c2goe3R5cGU6IFwidGFnXCIsIG5hbWU6IG5hbWV9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRva2Vucy5sZW5ndGggJiYgdG9rZW5zW3Rva2Vucy5sZW5ndGggLSAxXS50eXBlID09PSBcImRlc2NlbmRhbnRcIil7XG5cdFx0XHRcdFx0dG9rZW5zLnBvcCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGFkZFRva2VuKHN1YnNlbGVjdHMsIHRva2Vucyk7XG5cdFx0XHRcdHJldHVybiBzZWxlY3Rvcjtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRhZGRUb2tlbihzdWJzZWxlY3RzLCB0b2tlbnMpO1xuXG5cdHJldHVybiBzZWxlY3Rvcjtcbn1cblxuZnVuY3Rpb24gYWRkVG9rZW4oc3Vic2VsZWN0cywgdG9rZW5zKXtcblx0aWYoc3Vic2VsZWN0cy5sZW5ndGggPiAwICYmIHRva2Vucy5sZW5ndGggPT09IDApe1xuXHRcdHRocm93IG5ldyBTeW50YXhFcnJvcihcImVtcHR5IHN1Yi1zZWxlY3RvclwiKTtcblx0fVxuXG5cdHN1YnNlbGVjdHMucHVzaCh0b2tlbnMpO1xufVxuIl19