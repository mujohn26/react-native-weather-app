bcbb2f038ca5ef7a33392292c06154dc
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

var _slicedToArray = function () {
  function sliceIterator(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;

    try {
      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);

        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i["return"]) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }

    return _arr;
  }

  return function (arr, i) {
    if (Array.isArray(arr)) {
      return arr;
    } else if (Symbol.iterator in Object(arr)) {
      return sliceIterator(arr, i);
    } else {
      throw new TypeError("Invalid attempt to destructure non-iterable instance");
    }
  };
}();

exports.buildPredicate = buildPredicate;
exports.reduceTreeBySelector = reduceTreeBySelector;
exports.reduceTreesBySelector = reduceTreesBySelector;

var _rstSelectorParser = require('rst-selector-parser');

var _object = require('object.values');

var _object2 = _interopRequireDefault(_object);

var _arrayPrototype = require('array.prototype.flat');

var _arrayPrototype2 = _interopRequireDefault(_arrayPrototype);

var _objectIs = require('object-is');

var _objectIs2 = _interopRequireDefault(_objectIs);

var _has = require('has');

var _has2 = _interopRequireDefault(_has);

var _byConstructor = require('html-element-map/byConstructor');

var _byConstructor2 = _interopRequireDefault(_byConstructor);

var _RSTTraversal = require("./RSTTraversal");

var _Utils = require("./Utils");

var _getAdapter = require("./getAdapter");

var _getAdapter2 = _interopRequireDefault(_getAdapter);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    'default': obj
  };
}

function _toConsumableArray(arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }

    return arr2;
  } else {
    return Array.from(arr);
  }
}

var parser = (0, _rstSelectorParser.createParser)();
var CHILD = 'childCombinator';
var ADJACENT_SIBLING = 'adjacentSiblingCombinator';
var GENERAL_SIBLING = 'generalSiblingCombinator';
var DESCENDANT = 'descendantCombinator';
var SELECTOR = 'selector';
var TYPE_SELECTOR = 'typeSelector';
var CLASS_SELECTOR = 'classSelector';
var ID_SELECTOR = 'idSelector';
var UNIVERSAL_SELECTOR = 'universalSelector';
var ATTRIBUTE_PRESENCE = 'attributePresenceSelector';
var ATTRIBUTE_VALUE = 'attributeValueSelector';
var PSEUDO_CLASS = 'pseudoClassSelector';
var PSEUDO_ELEMENT = 'pseudoElementSelector';
var EXACT_ATTRIBUTE_OPERATOR = '=';
var WHITELIST_ATTRIBUTE_OPERATOR = '~=';
var HYPHENATED_ATTRIBUTE_OPERATOR = '|=';
var PREFIX_ATTRIBUTE_OPERATOR = '^=';
var SUFFIX_ATTRIBUTE_OPERATOR = '$=';
var SUBSTRING_ATTRIBUTE_OPERATOR = '*=';

function unique(arr) {
  return [].concat(_toConsumableArray(new Set(arr)));
}

function uniqueReduce(fn, nodes) {
  return unique(nodes.reduce(fn, []));
}

function safelyGenerateTokens(selector) {
  try {
    return parser.parse(selector);
  } catch (err) {
    throw new Error('Failed to parse selector: ' + String(selector));
  }
}

function matchAttributeSelector(node, token) {
  var operator = token.operator,
      value = token.value,
      name = token.name;
  var nodeProps = (0, _Utils.propsOfNode)(node);
  var descriptor = Object.getOwnPropertyDescriptor(nodeProps, name);

  if (descriptor && descriptor.get) {
    return false;
  }

  var nodePropValue = nodeProps[name];

  if (typeof nodePropValue === 'undefined') {
    return false;
  }

  if (token.type === ATTRIBUTE_PRESENCE) {
    return (0, _has2['default'])(nodeProps, token.name);
  }

  if (typeof nodePropValue !== 'string' || typeof value !== 'string') {
    if (operator !== EXACT_ATTRIBUTE_OPERATOR) {
      return false;
    }
  }

  switch (operator) {
    case EXACT_ATTRIBUTE_OPERATOR:
      return (0, _objectIs2['default'])(nodePropValue, value);

    case WHITELIST_ATTRIBUTE_OPERATOR:
      return nodePropValue.split(' ').indexOf(value) !== -1;

    case HYPHENATED_ATTRIBUTE_OPERATOR:
      return nodePropValue === value || nodePropValue.startsWith(String(value) + '-');

    case PREFIX_ATTRIBUTE_OPERATOR:
      return value === '' ? false : nodePropValue.slice(0, value.length) === value;

    case SUFFIX_ATTRIBUTE_OPERATOR:
      return value === '' ? false : nodePropValue.slice(-value.length) === value;

    case SUBSTRING_ATTRIBUTE_OPERATOR:
      return value === '' ? false : nodePropValue.indexOf(value) !== -1;

    default:
      throw new Error('Enzyme::Selector: Unknown attribute selector operator "' + String(operator) + '"');
  }
}

function matchPseudoSelector(node, token, root) {
  var name = token.name,
      parameters = token.parameters;

  if (name === 'not') {
    return parameters.every(function (selector) {
      return reduceTreeBySelector(selector, node).length === 0;
    });
  }

  if (name === 'empty') {
    return (0, _RSTTraversal.treeFilter)(node, function (n) {
      return n !== node;
    }).length === 0;
  }

  if (name === 'first-child') {
    var _findParentNode = (0, _RSTTraversal.findParentNode)(root, node),
        rendered = _findParentNode.rendered;

    var _rendered = _slicedToArray(rendered, 1),
        firstChild = _rendered[0];

    return firstChild === node;
  }

  if (name === 'last-child') {
    var _findParentNode2 = (0, _RSTTraversal.findParentNode)(root, node),
        _rendered2 = _findParentNode2.rendered;

    return _rendered2[_rendered2.length - 1] === node;
  }

  if (name === 'focus') {
    if (typeof document === 'undefined') {
      throw new Error('Enzyme::Selector does not support the ":focus" pseudo-element without a global `document`.');
    }

    var adapter = (0, _getAdapter2['default'])();
    return document.activeElement && adapter.nodeToHostNode(node) === document.activeElement;
  }

  throw new TypeError('Enzyme::Selector does not support the "' + String(token.name) + '" pseudo-element or pseudo-class selectors.');
}

function nodeMatchesToken(node, token, root) {
  if (node === null || typeof node === 'string') {
    return false;
  }

  switch (token.type) {
    case UNIVERSAL_SELECTOR:
      return true;

    case CLASS_SELECTOR:
      return (0, _RSTTraversal.hasClassName)(node, token.name);

    case TYPE_SELECTOR:
      return (0, _Utils.nodeHasType)(node, token.name);

    case ID_SELECTOR:
      return (0, _RSTTraversal.nodeHasId)(node, token.name);

    case ATTRIBUTE_PRESENCE:
      return matchAttributeSelector(node, token);

    case ATTRIBUTE_VALUE:
      return matchAttributeSelector(node, token);

    case PSEUDO_ELEMENT:
    case PSEUDO_CLASS:
      return matchPseudoSelector(node, token, root);

    default:
      throw new Error('Unknown token type: ' + String(token.type));
  }
}

function buildPredicateFromToken(token, root) {
  return function (node) {
    return token.body.every(function (bodyToken) {
      return nodeMatchesToken(node, bodyToken, root);
    });
  };
}

function isComplexSelector(tokens) {
  return tokens.some(function (token) {
    return token.type !== SELECTOR;
  });
}

function buildPredicate(selector) {
  if (typeof selector === 'string') {
    var tokens = safelyGenerateTokens(selector);

    if (isComplexSelector(tokens)) {
      throw new TypeError('This method does not support complex CSS selectors');
    }

    return buildPredicateFromToken(tokens[0]);
  }

  var adapter = (0, _getAdapter2['default'])();
  var isElementType = adapter.isValidElementType ? adapter.isValidElementType(selector) : typeof selector === 'function';

  if (isElementType) {
    return function (node) {
      return adapter.matchesElementType(node, selector);
    };
  }

  if ((typeof selector === 'undefined' ? 'undefined' : _typeof(selector)) === 'object') {
    if (!Array.isArray(selector) && selector !== null && Object.keys(selector).length > 0) {
      var hasUndefinedValues = (0, _object2['default'])(selector).some(function (value) {
        return typeof value === 'undefined';
      });

      if (hasUndefinedValues) {
        throw new TypeError('Enzyme::Props can’t have `undefined` values. Try using ‘findWhere()’ instead.');
      }

      return function (node) {
        return (0, _RSTTraversal.nodeMatchesObjectProps)(node, selector);
      };
    }

    throw new TypeError('Enzyme::Selector does not support an array, null, or empty object as a selector');
  }

  throw new TypeError('Enzyme::Selector expects a string, object, or valid element type (Component Constructor)');
}

function matchAdjacentSiblings(nodes, predicate, root) {
  return nodes.reduce(function (matches, node) {
    var parent = (0, _RSTTraversal.findParentNode)(root, node);

    if (!parent) {
      return matches;
    }

    var parentChildren = (0, _RSTTraversal.childrenOfNode)(parent);
    var nodeIndex = parentChildren.indexOf(node);
    var adjacentSibling = parentChildren[nodeIndex + 1];

    if (!adjacentSibling) {
      return matches;
    }

    if (predicate(adjacentSibling)) {
      matches.push(adjacentSibling);
    }

    return matches;
  }, []);
}

function matchGeneralSibling(nodes, predicate, root) {
  return uniqueReduce(function (matches, node) {
    var parent = (0, _RSTTraversal.findParentNode)(root, node);

    if (!parent) {
      return matches;
    }

    var parentChildren = (0, _RSTTraversal.childrenOfNode)(parent);
    var nodeIndex = parentChildren.indexOf(node);
    var youngerSiblings = parentChildren.slice(nodeIndex + 1);
    return matches.concat(youngerSiblings.filter(predicate));
  }, nodes);
}

function matchDirectChild(nodes, predicate) {
  return uniqueReduce(function (matches, node) {
    return matches.concat((0, _RSTTraversal.childrenOfNode)(node).filter(predicate));
  }, nodes);
}

function matchDescendant(nodes, predicate) {
  return uniqueReduce(function (matches, node) {
    return matches.concat((0, _RSTTraversal.treeFilter)(node, predicate));
  }, (0, _arrayPrototype2['default'])(nodes.map(_RSTTraversal.childrenOfNode)));
}

function reduceTreeBySelector(selector, root) {
  if (typeof selector !== 'string') {
    var elements = (0, _byConstructor2['default'])(selector);

    if (elements.length > 0) {
      return (0, _arrayPrototype2['default'])(elements.map(function (x) {
        return reduceTreeBySelector(x.tag, root);
      }));
    }
  }

  if (typeof selector === 'function' || (typeof selector === 'undefined' ? 'undefined' : _typeof(selector)) === 'object') {
    return (0, _RSTTraversal.treeFilter)(root, buildPredicate(selector));
  }

  var results = [];

  if (typeof selector === 'string') {
    var tokens = safelyGenerateTokens(selector);
    var index = 0;

    while (index < tokens.length) {
      var token = tokens[index];

      if (token.type === SELECTOR) {
        var predicate = buildPredicateFromToken(token, root);
        results = results.concat((0, _RSTTraversal.treeFilter)(root, predicate));
      } else {
        var type = token.type;
        index += 1;

        var _predicate = buildPredicateFromToken(tokens[index], root);

        switch (type) {
          case ADJACENT_SIBLING:
            results = matchAdjacentSiblings(results, _predicate, root);
            break;

          case GENERAL_SIBLING:
            results = matchGeneralSibling(results, _predicate, root);
            break;

          case CHILD:
            results = matchDirectChild(results, _predicate);
            break;

          case DESCENDANT:
            {
              results = matchDescendant(results, _predicate);
              break;
            }

          default:
            throw new Error('Unknown combinator selector: ' + String(type));
        }
      }

      index += 1;
    }
  } else {
    throw new TypeError('Enzyme::Selector expects a string, object, or Component Constructor');
  }

  return results;
}

function reduceTreesBySelector(selector, roots) {
  var results = roots.map(function (n) {
    return reduceTreeBySelector(selector, n);
  });
  return unique((0, _arrayPrototype2['default'])(results, 1));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZWxlY3RvcnMuanMiXSwibmFtZXMiOlsicGFyc2VyIiwiQ0hJTEQiLCJBREpBQ0VOVF9TSUJMSU5HIiwiR0VORVJBTF9TSUJMSU5HIiwiREVTQ0VOREFOVCIsIlNFTEVDVE9SIiwiVFlQRV9TRUxFQ1RPUiIsIkNMQVNTX1NFTEVDVE9SIiwiSURfU0VMRUNUT1IiLCJVTklWRVJTQUxfU0VMRUNUT1IiLCJBVFRSSUJVVEVfUFJFU0VOQ0UiLCJBVFRSSUJVVEVfVkFMVUUiLCJQU0VVRE9fQ0xBU1MiLCJQU0VVRE9fRUxFTUVOVCIsIkVYQUNUX0FUVFJJQlVURV9PUEVSQVRPUiIsIldISVRFTElTVF9BVFRSSUJVVEVfT1BFUkFUT1IiLCJIWVBIRU5BVEVEX0FUVFJJQlVURV9PUEVSQVRPUiIsIlBSRUZJWF9BVFRSSUJVVEVfT1BFUkFUT1IiLCJTVUZGSVhfQVRUUklCVVRFX09QRVJBVE9SIiwiU1VCU1RSSU5HX0FUVFJJQlVURV9PUEVSQVRPUiIsInVuaXF1ZSIsIm5vZGVzIiwib3BlcmF0b3IiLCJ2YWx1ZSIsIm5hbWUiLCJ0b2tlbiIsIm5vZGVQcm9wcyIsImRlc2NyaXB0b3IiLCJPYmplY3QiLCJub2RlUHJvcFZhbHVlIiwicGFyYW1ldGVycyIsInJlZHVjZVRyZWVCeVNlbGVjdG9yIiwibiIsInJlbmRlcmVkIiwiZmlyc3RDaGlsZCIsImFkYXB0ZXIiLCJkb2N1bWVudCIsIm5vZGUiLCJtYXRjaEF0dHJpYnV0ZVNlbGVjdG9yIiwibWF0Y2hQc2V1ZG9TZWxlY3RvciIsIm5vZGVNYXRjaGVzVG9rZW4iLCJidWlsZFByZWRpY2F0ZSIsInRva2VucyIsInNhZmVseUdlbmVyYXRlVG9rZW5zIiwiaXNDb21wbGV4U2VsZWN0b3IiLCJidWlsZFByZWRpY2F0ZUZyb21Ub2tlbiIsImlzRWxlbWVudFR5cGUiLCJBcnJheSIsInNlbGVjdG9yIiwiaGFzVW5kZWZpbmVkVmFsdWVzIiwicGFyZW50IiwicGFyZW50Q2hpbGRyZW4iLCJub2RlSW5kZXgiLCJhZGphY2VudFNpYmxpbmciLCJwcmVkaWNhdGUiLCJtYXRjaGVzIiwieW91bmdlclNpYmxpbmdzIiwiY2hpbGRyZW5PZk5vZGUiLCJlbGVtZW50cyIsIngiLCJyZXN1bHRzIiwiaW5kZXgiLCJ0eXBlIiwibWF0Y2hBZGphY2VudFNpYmxpbmdzIiwibWF0Y2hHZW5lcmFsU2libGluZyIsIm1hdGNoRGlyZWN0Q2hpbGQiLCJtYXRjaERlc2NlbmRhbnQiLCJyZWR1Y2VUcmVlc0J5U2VsZWN0b3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBbVFnQnlDLGMsR0FBQUEsYztRQXFIQVYsb0IsR0FBQUEsb0I7UUErRUFvQyxxQixHQUFBQSxxQjs7QUF2Y2hCLElBQUEsa0JBQUEsR0FBQSxPQUFBLENBQUEscUJBQUEsQ0FBQTs7QUFDQSxJQUFBLE9BQUEsR0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBOzs7O0FBQ0EsSUFBQSxlQUFBLEdBQUEsT0FBQSxDQUFBLHNCQUFBLENBQUE7Ozs7QUFDQSxJQUFBLFNBQUEsR0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBOzs7O0FBQ0EsSUFBQSxJQUFBLEdBQUEsT0FBQSxDQUFBLEtBQUEsQ0FBQTs7OztBQUNBLElBQUEsY0FBQSxHQUFBLE9BQUEsQ0FBQSxnQ0FBQSxDQUFBOzs7O0FBQ0EsSUFBQSxhQUFBLEdBQUEsT0FBQSxrQkFBQTs7QUFRQSxJQUFBLE1BQUEsR0FBQSxPQUFBLFdBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsT0FBQSxnQkFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1uRSxNQUFBQSxHQUFTLENBQUEsR0FBQSxrQkFBQSxDQUFmLFlBQWUsR0FBZjtBQUdBLElBQU1DLEtBQUFBLEdBQU4saUJBQUE7QUFDQSxJQUFNQyxnQkFBQUEsR0FBTiwyQkFBQTtBQUNBLElBQU1DLGVBQUFBLEdBQU4sMEJBQUE7QUFDQSxJQUFNQyxVQUFBQSxHQUFOLHNCQUFBO0FBR0EsSUFBTUMsUUFB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O0FBRUYsZUFBQSxLQUFBO0FBQ0VBLFlBQUFBLE9BQUFBLEdBQVVLLGdCQUFBQSxDQUFBQSxPQUFBQSxFQUFWTCxVQUFVSyxDQUFWTDtBQUNBOztBQUVGLGVBQUEsVUFBQTtBQUFpQjtBQUNmQSxjQUFBQSxPQUFBQSxHQUFVTSxlQUFBQSxDQUFBQSxPQUFBQSxFQUFWTixVQUFVTSxDQUFWTjtBQUNBO0FBQ0Q7O0FBQ0Q7QUFDRSxrQkFBTSxJQUFBLEtBQUEsQ0FBQSxrQ0FBQSxNQUFBLENBQU4sSUFBTSxDQUFBLENBQU47QUFuQko7QUFxQkQ7O0FBQ0RDLE1BQUFBLEtBQUFBLElBQUFBLENBQUFBO0FBQ0Q7QUF2REgsR0FBQSxNQXdETztBQUNMLFVBQU0sSUFBQSxTQUFBLENBQU4scUVBQU0sQ0FBTjtBQUNEOztBQUNELFNBQUEsT0FBQTtBQUNEOztBQUVNLFNBQUEscUJBQUEsQ0FBQSxRQUFBLEVBQUEsS0FBQSxFQUFnRDtBQUNyRCxNQUFNRCxPQUFBQSxHQUFVLEtBQUEsQ0FBQSxHQUFBLENBQVUsVUFBQSxDQUFBLEVBQUE7QUFBQSxXQUFPN0Isb0JBQUFBLENBQUFBLFFBQUFBLEVBQVAsQ0FBT0EsQ0FBUDtBQUExQixHQUFnQixDQUFoQjtBQUNBLFNBQU9YLE1BQUFBLENBQU8sQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsT0FBQSxFQUFkLENBQWMsQ0FBUEEsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlUGFyc2VyIH0gZnJvbSAncnN0LXNlbGVjdG9yLXBhcnNlcic7XG5pbXBvcnQgdmFsdWVzIGZyb20gJ29iamVjdC52YWx1ZXMnO1xuaW1wb3J0IGZsYXQgZnJvbSAnYXJyYXkucHJvdG90eXBlLmZsYXQnO1xuaW1wb3J0IGlzIGZyb20gJ29iamVjdC1pcyc7XG5pbXBvcnQgaGFzIGZyb20gJ2hhcyc7XG5pbXBvcnQgZWxlbWVudHNCeUNvbnN0cnVjdG9yIGZyb20gJ2h0bWwtZWxlbWVudC1tYXAvYnlDb25zdHJ1Y3Rvcic7XG5pbXBvcnQge1xuICB0cmVlRmlsdGVyLFxuICBub2RlSGFzSWQsXG4gIGZpbmRQYXJlbnROb2RlLFxuICBub2RlTWF0Y2hlc09iamVjdFByb3BzLFxuICBjaGlsZHJlbk9mTm9kZSxcbiAgaGFzQ2xhc3NOYW1lLFxufSBmcm9tICcuL1JTVFRyYXZlcnNhbCc7XG5pbXBvcnQgeyBub2RlSGFzVHlwZSwgcHJvcHNPZk5vZGUgfSBmcm9tICcuL1V0aWxzJztcbmltcG9ydCBnZXRBZGFwdGVyIGZyb20gJy4vZ2V0QWRhcHRlcic7XG4vLyBvdXIgQ1NTIHNlbGVjdG9yIHBhcnNlciBpbnN0YW5jZVxuY29uc3QgcGFyc2VyID0gY3JlYXRlUGFyc2VyKCk7XG5cbi8vIENvbWJpbmF0b3JzIHRoYXQgYWxsb3cgeW91IHRvIGNoYW5jZSBzZWxlY3RvcnNcbmNvbnN0IENISUxEID0gJ2NoaWxkQ29tYmluYXRvcic7XG5jb25zdCBBREpBQ0VOVF9TSUJMSU5HID0gJ2FkamFjZW50U2libGluZ0NvbWJpbmF0b3InO1xuY29uc3QgR0VORVJBTF9TSUJMSU5HID0gJ2dlbmVyYWxTaWJsaW5nQ29tYmluYXRvcic7XG5jb25zdCBERVNDRU5EQU5UID0gJ2Rlc2NlbmRhbnRDb21iaW5hdG9yJztcblxuLy8gU2VsZWN0b3JzIGZvciB0YXJnZXRpbmcgZWxlbWVudHNcbmNvbnN0IFNFTEVDVE9SID0gJ3NlbGVjdG9yJztcbmNvbnN0IFRZUEVfU0VMRUNUT1IgPSAndHlwZVNlbGVjdG9yJztcbmNvbnN0IENMQVNTX1NFTEVDVE9SID0gJ2NsYXNzU2VsZWN0b3InO1xuY29uc3QgSURfU0VMRUNUT1IgPSAnaWRTZWxlY3Rvcic7XG5jb25zdCBVTklWRVJTQUxfU0VMRUNUT1IgPSAndW5pdmVyc2FsU2VsZWN0b3InO1xuY29uc3QgQVRUUklCVVRFX1BSRVNFTkNFID0gJ2F0dHJpYnV0ZVByZXNlbmNlU2VsZWN0b3InO1xuY29uc3QgQVRUUklCVVRFX1ZBTFVFID0gJ2F0dHJpYnV0ZVZhbHVlU2VsZWN0b3InO1xuLy8gQFRPRE8gd2UgZG9udCBzdXBwb3J0IHRoZXNlLCB0aHJvdyBpZiB0aGV5IGFyZSB1c2VkXG5jb25zdCBQU0VVRE9fQ0xBU1MgPSAncHNldWRvQ2xhc3NTZWxlY3Rvcic7XG5jb25zdCBQU0VVRE9fRUxFTUVOVCA9ICdwc2V1ZG9FbGVtZW50U2VsZWN0b3InO1xuXG5jb25zdCBFWEFDVF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnPSc7XG5jb25zdCBXSElURUxJU1RfQVRUUklCVVRFX09QRVJBVE9SID0gJ349JztcbmNvbnN0IEhZUEhFTkFURURfQVRUUklCVVRFX09QRVJBVE9SID0gJ3w9JztcbmNvbnN0IFBSRUZJWF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnXj0nO1xuY29uc3QgU1VGRklYX0FUVFJJQlVURV9PUEVSQVRPUiA9ICckPSc7XG5jb25zdCBTVUJTVFJJTkdfQVRUUklCVVRFX09QRVJBVE9SID0gJyo9JztcblxuZnVuY3Rpb24gdW5pcXVlKGFycikge1xuICByZXR1cm4gWy4uLm5ldyBTZXQoYXJyKV07XG59XG5cbi8qKlxuICogQ2FsbHMgcmVkdWNlIG9uIGEgYXJyYXkgb2Ygbm9kZXMgd2l0aCB0aGUgcGFzc2VkXG4gKiBmdW5jdGlvbiwgcmV0dXJuaW5nIG9ubHkgdW5pcXVlIHJlc3VsdHMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmblxuICogQHBhcmFtIHtBcnJheTxOb2RlPn0gbm9kZXNcbiAqL1xuZnVuY3Rpb24gdW5pcXVlUmVkdWNlKGZuLCBub2Rlcykge1xuICByZXR1cm4gdW5pcXVlKG5vZGVzLnJlZHVjZShmbiwgW10pKTtcbn1cblxuLyoqXG4gKiBUYWtlcyBhIENTUyBzZWxlY3RvciBhbmQgcmV0dXJucyBhIHNldCBvZiB0b2tlbnMgcGFyc2VkXG4gKiBieSBzY2FscGVsLlxuICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yXG4gKi9cbmZ1bmN0aW9uIHNhZmVseUdlbmVyYXRlVG9rZW5zKHNlbGVjdG9yKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHBhcnNlci5wYXJzZShzZWxlY3Rvcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHBhcnNlIHNlbGVjdG9yOiAke3NlbGVjdG9yfWApO1xuICB9XG59XG5cbmZ1bmN0aW9uIG1hdGNoQXR0cmlidXRlU2VsZWN0b3Iobm9kZSwgdG9rZW4pIHtcbiAgY29uc3QgeyBvcGVyYXRvciwgdmFsdWUsIG5hbWUgfSA9IHRva2VuO1xuICBjb25zdCBub2RlUHJvcHMgPSBwcm9wc09mTm9kZShub2RlKTtcbiAgY29uc3QgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobm9kZVByb3BzLCBuYW1lKTtcbiAgaWYgKGRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5nZXQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3Qgbm9kZVByb3BWYWx1ZSA9IG5vZGVQcm9wc1tuYW1lXTtcbiAgaWYgKHR5cGVvZiBub2RlUHJvcFZhbHVlID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAodG9rZW4udHlwZSA9PT0gQVRUUklCVVRFX1BSRVNFTkNFKSB7XG4gICAgcmV0dXJuIGhhcyhub2RlUHJvcHMsIHRva2VuLm5hbWUpO1xuICB9XG4gIC8vIE9ubHkgdGhlIGV4YWN0IHZhbHVlIG9wZXJhdG9yIChcIj1cIikgY2FuIG1hdGNoIG5vbi1zdHJpbmdzXG4gIGlmICh0eXBlb2Ygbm9kZVByb3BWYWx1ZSAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIGlmIChvcGVyYXRvciAhPT0gRVhBQ1RfQVRUUklCVVRFX09QRVJBVE9SKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSB3aG9zZSB2YWx1ZSBpcyBleGFjdGx5IFwidmFsXCIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBbYXR0cj1cInZhbFwiXSBtYXRjaGVzIGF0dHI9XCJ2YWxcIlxuICAgICAqL1xuICAgIGNhc2UgRVhBQ1RfQVRUUklCVVRFX09QRVJBVE9SOlxuICAgICAgcmV0dXJuIGlzKG5vZGVQcm9wVmFsdWUsIHZhbHVlKTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSB3aG9zZSB2YWx1ZSBpcyBhIHdoaXRlc3BhY2Utc2VwYXJhdGVkXG4gICAgICogbGlzdCBvZiB3b3Jkcywgb25lIG9mIHdoaWNoIGlzIGV4YWN0bHlcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqICBbcmVsfj1cImNvcHlyaWdodFwiXSBtYXRjaGVzIHJlbD1cImNvcHlyaWdodCBvdGhlclwiXG4gICAgICovXG4gICAgY2FzZSBXSElURUxJU1RfQVRUUklCVVRFX09QRVJBVE9SOlxuICAgICAgcmV0dXJuIG5vZGVQcm9wVmFsdWUuc3BsaXQoJyAnKS5pbmRleE9mKHZhbHVlKSAhPT0gLTE7XG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhbiBlbGVtZW50IHdpdGggdGhlIGF0dCBhdHRyaWJ1dGUsIGl0cyB2YWx1ZSBlaXRoZXIgYmVpbmcgZXhhY3RseSB0aGVcbiAgICAgKiB2YWx1ZSBvciBiZWdpbm5pbmcgd2l0aCB0aGUgdmFsdWUgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgXCItXCJcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIFtocmVmbGFuZ3w9XCJlblwiXSBtYXRjaGVzIGhyZWZsYW5nPVwiZW4tVVNcIlxuICAgICAqL1xuICAgIGNhc2UgSFlQSEVOQVRFRF9BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gbm9kZVByb3BWYWx1ZSA9PT0gdmFsdWUgfHwgbm9kZVByb3BWYWx1ZS5zdGFydHNXaXRoKGAke3ZhbHVlfS1gKTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSB3aG9zZSB2YWx1ZSBiZWdpbnMgd2l0aCB0aGUgcHJlZml4IHZhbHVlLlxuICAgICAqIElmIHRoZSB2YWx1ZSBpcyB0aGUgZW1wdHkgc3RyaW5nIHRoZW4gdGhlIHNlbGVjdG9yIGRvZXMgbm90IHJlcHJlc2VudCBhbnl0aGluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIFt0eXBlXj1cImltYWdlXCJdIG1hdGNoZXMgdHlwZT1cImltYWdlb2JqZWN0XCJcbiAgICAgKi9cbiAgICBjYXNlIFBSRUZJWF9BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gdmFsdWUgPT09ICcnID8gZmFsc2UgOiBub2RlUHJvcFZhbHVlLnNsaWNlKDAsIHZhbHVlLmxlbmd0aCkgPT09IHZhbHVlO1xuICAgIC8qKlxuICAgICAqIFJlcHJlc2VudHMgYW4gZWxlbWVudCB3aXRoIHRoZSBhdHQgYXR0cmlidXRlIHdob3NlIHZhbHVlIGVuZHMgd2l0aCB0aGUgc3VmZml4IHZhbHVlLlxuICAgICAqIElmIHRoZSB2YWx1ZSBpcyB0aGUgZW1wdHkgc3RyaW5nIHRoZW4gdGhlIHNlbGVjdG9yIGRvZXMgbm90IHJlcHJlc2VudCBhbnl0aGluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIFt0eXBlJD1cImltYWdlXCJdIG1hdGNoZXMgdHlwZT1cImltYWdlb2JqZWN0XCJcbiAgICAgKi9cbiAgICBjYXNlIFNVRkZJWF9BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gdmFsdWUgPT09ICcnID8gZmFsc2UgOiBub2RlUHJvcFZhbHVlLnNsaWNlKC12YWx1ZS5sZW5ndGgpID09PSB2YWx1ZTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSB3aG9zZSB2YWx1ZSBjb250YWlucyBhdCBsZWFzdCBvbmVcbiAgICAgKiBpbnN0YW5jZSBvZiB0aGUgdmFsdWUuIElmIHZhbHVlIGlzIHRoZSBlbXB0eSBzdHJpbmcgdGhlbiB0aGVcbiAgICAgKiBzZWxlY3RvciBkb2VzIG5vdCByZXByZXNlbnQgYW55dGhpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBbdGl0bGUqPVwiaGVsbG9cIl0gbWF0Y2hlcyB0aXRsZT1cIndlbGwgaGVsbG8gdGhlcmVcIlxuICAgICAqL1xuICAgIGNhc2UgU1VCU1RSSU5HX0FUVFJJQlVURV9PUEVSQVRPUjpcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gJycgPyBmYWxzZSA6IG5vZGVQcm9wVmFsdWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVuenltZTo6U2VsZWN0b3I6IFVua25vd24gYXR0cmlidXRlIHNlbGVjdG9yIG9wZXJhdG9yIFwiJHtvcGVyYXRvcn1cImApO1xuICB9XG59XG5cblxuZnVuY3Rpb24gbWF0Y2hQc2V1ZG9TZWxlY3Rvcihub2RlLCB0b2tlbiwgcm9vdCkge1xuICBjb25zdCB7IG5hbWUsIHBhcmFtZXRlcnMgfSA9IHRva2VuO1xuICBpZiAobmFtZSA9PT0gJ25vdCcpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlLWJlZm9yZS1kZWZpbmVcbiAgICByZXR1cm4gcGFyYW1ldGVycy5ldmVyeSgoc2VsZWN0b3IpID0+IHJlZHVjZVRyZWVCeVNlbGVjdG9yKHNlbGVjdG9yLCBub2RlKS5sZW5ndGggPT09IDApO1xuICB9XG4gIGlmIChuYW1lID09PSAnZW1wdHknKSB7XG4gICAgcmV0dXJuIHRyZWVGaWx0ZXIobm9kZSwgKG4pID0+IG4gIT09IG5vZGUpLmxlbmd0aCA9PT0gMDtcbiAgfVxuICBpZiAobmFtZSA9PT0gJ2ZpcnN0LWNoaWxkJykge1xuICAgIGNvbnN0IHsgcmVuZGVyZWQgfSA9IGZpbmRQYXJlbnROb2RlKHJvb3QsIG5vZGUpO1xuICAgIGNvbnN0IFtmaXJzdENoaWxkXSA9IHJlbmRlcmVkO1xuICAgIHJldHVybiBmaXJzdENoaWxkID09PSBub2RlO1xuICB9XG4gIGlmIChuYW1lID09PSAnbGFzdC1jaGlsZCcpIHtcbiAgICBjb25zdCB7IHJlbmRlcmVkIH0gPSBmaW5kUGFyZW50Tm9kZShyb290LCBub2RlKTtcbiAgICByZXR1cm4gcmVuZGVyZWRbcmVuZGVyZWQubGVuZ3RoIC0gMV0gPT09IG5vZGU7XG4gIH1cbiAgaWYgKG5hbWUgPT09ICdmb2N1cycpIHtcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbnp5bWU6OlNlbGVjdG9yIGRvZXMgbm90IHN1cHBvcnQgdGhlIFwiOmZvY3VzXCIgcHNldWRvLWVsZW1lbnQgd2l0aG91dCBhIGdsb2JhbCBgZG9jdW1lbnRgLicpO1xuICAgIH1cbiAgICBjb25zdCBhZGFwdGVyID0gZ2V0QWRhcHRlcigpO1xuICAgIC8qIGVzbGludC1lbnYgYnJvd3NlciAqL1xuICAgIHJldHVybiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGFkYXB0ZXIubm9kZVRvSG9zdE5vZGUobm9kZSkgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICB0aHJvdyBuZXcgVHlwZUVycm9yKGBFbnp5bWU6OlNlbGVjdG9yIGRvZXMgbm90IHN1cHBvcnQgdGhlIFwiJHt0b2tlbi5uYW1lfVwiIHBzZXVkby1lbGVtZW50IG9yIHBzZXVkby1jbGFzcyBzZWxlY3RvcnMuYCk7XG59XG5cbi8qKlxuICogVGFrZXMgYSBub2RlIGFuZCBhIHRva2VuIGFuZCBkZXRlcm1pbmVzIGlmIHRoZSBub2RlXG4gKiBtYXRjaGVzIHRoZSBwcmVkaWNhdGUgZGVmaW5lZCBieSB0aGUgdG9rZW4uXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEBwYXJhbSB7VG9rZW59IHRva2VuXG4gKi9cbmZ1bmN0aW9uIG5vZGVNYXRjaGVzVG9rZW4obm9kZSwgdG9rZW4sIHJvb3QpIHtcbiAgaWYgKG5vZGUgPT09IG51bGwgfHwgdHlwZW9mIG5vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHN3aXRjaCAodG9rZW4udHlwZSkge1xuICAgIC8qKlxuICAgICAqIE1hdGNoIGV2ZXJ5IG5vZGVcbiAgICAgKiBAZXhhbXBsZSAnKicgbWF0Y2hlcyBldmVyeSBub2RlXG4gICAgICovXG4gICAgY2FzZSBVTklWRVJTQUxfU0VMRUNUT1I6XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICAvKipcbiAgICAgKiBNYXRjaCBhZ2FpbnN0IHRoZSBjbGFzc05hbWUgcHJvcFxuICAgICAqIEBleGFtcGxlICcuYWN0aXZlJyBtYXRjaGVzIDxkaXYgY2xhc3NOYW1lPSdhY3RpdmUnIC8+XG4gICAgICovXG4gICAgY2FzZSBDTEFTU19TRUxFQ1RPUjpcbiAgICAgIHJldHVybiBoYXNDbGFzc05hbWUobm9kZSwgdG9rZW4ubmFtZSk7XG4gICAgLyoqXG4gICAgICogU2ltcGxlIHR5cGUgbWF0Y2hpbmdcbiAgICAgKiBAZXhhbXBsZSAnZGl2JyBtYXRjaGVzIDxkaXYgLz5cbiAgICAgKi9cbiAgICBjYXNlIFRZUEVfU0VMRUNUT1I6XG4gICAgICByZXR1cm4gbm9kZUhhc1R5cGUobm9kZSwgdG9rZW4ubmFtZSk7XG4gICAgLyoqXG4gICAgICogTWF0Y2ggYWdhaW5zdCB0aGUgYGlkYCBwcm9wXG4gICAgICogQGV4YW1wbGUgJyNuYXYnIG1hdGNoZXMgPHVsIGlkPVwibmF2XCIgLz5cbiAgICAgKi9cbiAgICBjYXNlIElEX1NFTEVDVE9SOlxuICAgICAgcmV0dXJuIG5vZGVIYXNJZChub2RlLCB0b2tlbi5uYW1lKTtcbiAgICAvKipcbiAgICAgKiBNYXRjaGVzIGlmIGFuIGF0dHJpYnV0ZSBpcyBwcmVzZW50LCByZWdhcmRsZXNzXG4gICAgICogb2YgaXRzIHZhbHVlXG4gICAgICogQGV4YW1wbGUgJ1tkaXNhYmxlZF0nIG1hdGNoZXMgPGEgZGlzYWJsZWQgLz5cbiAgICAgKi9cbiAgICBjYXNlIEFUVFJJQlVURV9QUkVTRU5DRTpcbiAgICAgIHJldHVybiBtYXRjaEF0dHJpYnV0ZVNlbGVjdG9yKG5vZGUsIHRva2VuKTtcbiAgICAvKipcbiAgICAgKiBNYXRjaGVzIGlmIGFuIGF0dHJpYnV0ZSBpcyBwcmVzZW50IHdpdGggdGhlXG4gICAgICogcHJvdmlkZWQgdmFsdWVcbiAgICAgKiBAZXhhbXBsZSAnW2RhdGEtZm9vPWZvb10nIG1hdGNoZXMgPGRpdiBkYXRhLWZvbz1cImZvb1wiIC8+XG4gICAgICovXG4gICAgY2FzZSBBVFRSSUJVVEVfVkFMVUU6XG4gICAgICByZXR1cm4gbWF0Y2hBdHRyaWJ1dGVTZWxlY3Rvcihub2RlLCB0b2tlbik7XG4gICAgY2FzZSBQU0VVRE9fRUxFTUVOVDpcbiAgICBjYXNlIFBTRVVET19DTEFTUzpcbiAgICAgIHJldHVybiBtYXRjaFBzZXVkb1NlbGVjdG9yKG5vZGUsIHRva2VuLCByb290KTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHRva2VuIHR5cGU6ICR7dG9rZW4udHlwZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBwcmVkaWNhdGUgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgYVxuICogbm9kZSBtYXRjaGVzIGV2ZXJ5IHRva2VuIGluIHRoZSBib2R5IG9mIGEgc2VsZWN0b3JcbiAqIHRva2VuLlxuICogQHBhcmFtIHtUb2tlbn0gdG9rZW5cbiAqL1xuZnVuY3Rpb24gYnVpbGRQcmVkaWNhdGVGcm9tVG9rZW4odG9rZW4sIHJvb3QpIHtcbiAgcmV0dXJuIChub2RlKSA9PiB0b2tlbi5ib2R5LmV2ZXJ5KChib2R5VG9rZW4pID0+IG5vZGVNYXRjaGVzVG9rZW4obm9kZSwgYm9keVRva2VuLCByb290KSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGEgcGFyc2VkIHNlbGVjdG9yIGlzIGEgY29tcGxleCBzZWxlY3Rvciwgd2hpY2hcbiAqIGlzIGRlZmluZWQgYXMgYSBzZWxlY3RvciB0aGF0IGNvbnRhaW5zIGNvbWJpbmF0b3JzLlxuICogQHBhcmFtIHtBcnJheTxUb2tlbj59IHRva2Vuc1xuICovXG5mdW5jdGlvbiBpc0NvbXBsZXhTZWxlY3Rvcih0b2tlbnMpIHtcbiAgcmV0dXJuIHRva2Vucy5zb21lKCh0b2tlbikgPT4gdG9rZW4udHlwZSAhPT0gU0VMRUNUT1IpO1xufVxuXG5cbi8qKlxuICogVGFrZXMgYSBjb21wb25lbnQgY29uc3RydWN0b3IsIG9iamVjdCwgb3Igc3RyaW5nIHJlcHJlc2VudGluZ1xuICogYSBzaW1wbGUgc2VsZWN0b3IgYW5kIHJldHVybnMgYSBwcmVkaWNhdGUgZnVuY3Rpb24gdGhhdCBjYW5cbiAqIGJlIGFwcGxpZWQgdG8gYSBzaW5nbGUgbm9kZS5cbiAqIEBwYXJhbSB7RW56eW1lU2VsZWN0b3J9IHNlbGVjdG9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFByZWRpY2F0ZShzZWxlY3Rvcikge1xuICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgYSBzdHJpbmcsIHBhcnNlIGl0IGFzIGEgc2ltcGxlIENTUyBzZWxlY3RvclxuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHRva2VucyA9IHNhZmVseUdlbmVyYXRlVG9rZW5zKHNlbGVjdG9yKTtcbiAgICBpZiAoaXNDb21wbGV4U2VsZWN0b3IodG9rZW5zKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCBjb21wbGV4IENTUyBzZWxlY3RvcnMnKTtcbiAgICB9XG4gICAgLy8gU2ltcGxlIHNlbGVjdG9ycyBvbmx5IGhhdmUgYSBzaW5nbGUgc2VsZWN0b3IgdG9rZW5cbiAgICByZXR1cm4gYnVpbGRQcmVkaWNhdGVGcm9tVG9rZW4odG9rZW5zWzBdKTtcbiAgfVxuXG4gIC8vIElmIHRoZSBzZWxlY3RvciBpcyBhbiBlbGVtZW50IHR5cGUsIGNoZWNrIGlmIHRoZSBub2RlJ3MgdHlwZSBtYXRjaGVzXG4gIGNvbnN0IGFkYXB0ZXIgPSBnZXRBZGFwdGVyKCk7XG4gIGNvbnN0IGlzRWxlbWVudFR5cGUgPSBhZGFwdGVyLmlzVmFsaWRFbGVtZW50VHlwZVxuICAgID8gYWRhcHRlci5pc1ZhbGlkRWxlbWVudFR5cGUoc2VsZWN0b3IpXG4gICAgOiB0eXBlb2Ygc2VsZWN0b3IgPT09ICdmdW5jdGlvbic7XG4gIGlmIChpc0VsZW1lbnRUeXBlKSB7XG4gICAgcmV0dXJuIChub2RlKSA9PiBhZGFwdGVyLm1hdGNoZXNFbGVtZW50VHlwZShub2RlLCBzZWxlY3Rvcik7XG4gIH1cbiAgLy8gSWYgdGhlIHNlbGVjdG9yIGlzIGFuIG5vbi1lbXB0eSBvYmplY3QsIHRyZWF0IHRoZSBrZXlzL3ZhbHVlcyBhcyBwcm9wc1xuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnb2JqZWN0Jykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShzZWxlY3RvcikgJiYgc2VsZWN0b3IgIT09IG51bGwgJiYgT2JqZWN0LmtleXMoc2VsZWN0b3IpLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGhhc1VuZGVmaW5lZFZhbHVlcyA9IHZhbHVlcyhzZWxlY3Rvcikuc29tZSgodmFsdWUpID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpO1xuICAgICAgaWYgKGhhc1VuZGVmaW5lZFZhbHVlcykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFbnp5bWU6OlByb3BzIGNhbuKAmXQgaGF2ZSBgdW5kZWZpbmVkYCB2YWx1ZXMuIFRyeSB1c2luZyDigJhmaW5kV2hlcmUoKeKAmSBpbnN0ZWFkLicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChub2RlKSA9PiBub2RlTWF0Y2hlc09iamVjdFByb3BzKG5vZGUsIHNlbGVjdG9yKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRW56eW1lOjpTZWxlY3RvciBkb2VzIG5vdCBzdXBwb3J0IGFuIGFycmF5LCBudWxsLCBvciBlbXB0eSBvYmplY3QgYXMgYSBzZWxlY3RvcicpO1xuICB9XG5cbiAgdGhyb3cgbmV3IFR5cGVFcnJvcignRW56eW1lOjpTZWxlY3RvciBleHBlY3RzIGEgc3RyaW5nLCBvYmplY3QsIG9yIHZhbGlkIGVsZW1lbnQgdHlwZSAoQ29tcG9uZW50IENvbnN0cnVjdG9yKScpO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgb25seSBub2RlcyB3aGljaCBhcmUgYWRqYWNlbnQgc2libGluZ3MgKGRpcmVjdCBuZXh0IHNpYmxpbmcpXG4gKiBhZ2FpbnN0IGEgcHJlZGljYXRlLCByZXR1cm5pbmcgdGhvc2UgdGhhdCBtYXRjaC5cbiAqIEBwYXJhbSB7QXJyYXk8Tm9kZT59IG5vZGVzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGVcbiAqIEBwYXJhbSB7Tm9kZX0gcm9vdFxuICovXG5mdW5jdGlvbiBtYXRjaEFkamFjZW50U2libGluZ3Mobm9kZXMsIHByZWRpY2F0ZSwgcm9vdCkge1xuICByZXR1cm4gbm9kZXMucmVkdWNlKChtYXRjaGVzLCBub2RlKSA9PiB7XG4gICAgY29uc3QgcGFyZW50ID0gZmluZFBhcmVudE5vZGUocm9vdCwgbm9kZSk7XG4gICAgLy8gSWYgdGhlcmUncyBubyBwYXJlbnQsIHRoZXJlJ3Mgbm8gc2libGluZ3NcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICAgIGNvbnN0IHBhcmVudENoaWxkcmVuID0gY2hpbGRyZW5PZk5vZGUocGFyZW50KTtcbiAgICBjb25zdCBub2RlSW5kZXggPSBwYXJlbnRDaGlsZHJlbi5pbmRleE9mKG5vZGUpO1xuICAgIGNvbnN0IGFkamFjZW50U2libGluZyA9IHBhcmVudENoaWxkcmVuW25vZGVJbmRleCArIDFdO1xuICAgIC8vIE5vIHNpYmxpbmdcbiAgICBpZiAoIWFkamFjZW50U2libGluZykge1xuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICAgIGlmIChwcmVkaWNhdGUoYWRqYWNlbnRTaWJsaW5nKSkge1xuICAgICAgbWF0Y2hlcy5wdXNoKGFkamFjZW50U2libGluZyk7XG4gICAgfVxuICAgIHJldHVybiBtYXRjaGVzO1xuICB9LCBbXSk7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBvbmx5IG5vZGVzIHdoaWNoIGFyZSBnZW5lcmFsIHNpYmxpbmdzIChhbnkgc2libGluZyAqYWZ0ZXIqKVxuICogYWdhaW5zdCBhIHByZWRpY2F0ZSwgcmV0dXJuaW5nIHRob3NlIHRoYXQgbWF0Y2guXG4gKiBAcGFyYW0ge0FycmF5PE5vZGU+fSBub2Rlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG4gKiBAcGFyYW0ge05vZGV9IHJvb3RcbiAqL1xuZnVuY3Rpb24gbWF0Y2hHZW5lcmFsU2libGluZyhub2RlcywgcHJlZGljYXRlLCByb290KSB7XG4gIHJldHVybiB1bmlxdWVSZWR1Y2UoKG1hdGNoZXMsIG5vZGUpID0+IHtcbiAgICBjb25zdCBwYXJlbnQgPSBmaW5kUGFyZW50Tm9kZShyb290LCBub2RlKTtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICAgIGNvbnN0IHBhcmVudENoaWxkcmVuID0gY2hpbGRyZW5PZk5vZGUocGFyZW50KTtcbiAgICBjb25zdCBub2RlSW5kZXggPSBwYXJlbnRDaGlsZHJlbi5pbmRleE9mKG5vZGUpO1xuICAgIGNvbnN0IHlvdW5nZXJTaWJsaW5ncyA9IHBhcmVudENoaWxkcmVuLnNsaWNlKG5vZGVJbmRleCArIDEpO1xuICAgIHJldHVybiBtYXRjaGVzLmNvbmNhdCh5b3VuZ2VyU2libGluZ3MuZmlsdGVyKHByZWRpY2F0ZSkpO1xuICB9LCBub2Rlcyk7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBvbmx5IG5vZGVzIHdoaWNoIGFyZSBkaXJlY3QgY2hpbGRyZW4gKG5vdCBncmFuZGNoaWxkcmVuLCBldGMuKVxuICogYWdhaW5zdCBhIHByZWRpY2F0ZSwgcmV0dXJuaW5nIHRob3NlIHRoYXQgbWF0Y2guXG4gKiBAcGFyYW0ge0FycmF5PE5vZGU+fSBub2Rlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG4gKi9cbmZ1bmN0aW9uIG1hdGNoRGlyZWN0Q2hpbGQobm9kZXMsIHByZWRpY2F0ZSkge1xuICByZXR1cm4gdW5pcXVlUmVkdWNlKFxuICAgIChtYXRjaGVzLCBub2RlKSA9PiBtYXRjaGVzLmNvbmNhdChjaGlsZHJlbk9mTm9kZShub2RlKS5maWx0ZXIocHJlZGljYXRlKSksXG4gICAgbm9kZXMsXG4gICk7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBhbGwgZGVzY2VuZGFudCBub2RlcyBhZ2FpbnN0IGEgcHJlZGljYXRlLFxuICogcmV0dXJuaW5nIHRob3NlIHRoYXQgbWF0Y2guXG4gKiBAcGFyYW0ge0FycmF5PE5vZGU+fSBub2Rlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG4gKi9cbmZ1bmN0aW9uIG1hdGNoRGVzY2VuZGFudChub2RlcywgcHJlZGljYXRlKSB7XG4gIHJldHVybiB1bmlxdWVSZWR1Y2UoXG4gICAgKG1hdGNoZXMsIG5vZGUpID0+IG1hdGNoZXMuY29uY2F0KHRyZWVGaWx0ZXIobm9kZSwgcHJlZGljYXRlKSksXG4gICAgZmxhdChub2Rlcy5tYXAoY2hpbGRyZW5PZk5vZGUpKSxcbiAgKTtcbn1cblxuLyoqXG4gKiBUYWtlcyBhbiBSU1QgYW5kIHJlZHVjZXMgaXQgdG8gYSBzZXQgb2Ygbm9kZXMgbWF0Y2hpbmdcbiAqIHRoZSBzZWxlY3Rvci4gVGhlIHNlbGVjdG9yIGNhbiBiZSBhIHNpbXBsZSBzZWxlY3Rvciwgd2hpY2hcbiAqIGlzIGhhbmRsZWQgYnkgYGJ1aWxkUHJlZGljYXRlYCwgb3IgYSBjb21wbGV4IENTUyBzZWxlY3RvciB3aGljaFxuICogcmVkdWNlVHJlZUJ5U2VsZWN0b3IgcGFyc2VzIGFuZCByZWR1Y2VzIHRoZSB0cmVlIGJhc2VkIG9uIHRoZSBjb21iaW5hdG9ycy5cbiAqXG4gKiBAcGFyYW0ge0VuenltZVNlbGVjdG9yfSBzZWxlY3RvclxuICogQHBhcmFtIHtSU1ROb2RlfSByb290XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWR1Y2VUcmVlQnlTZWxlY3RvcihzZWxlY3Rvciwgcm9vdCkge1xuICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gZWxlbWVudHNCeUNvbnN0cnVjdG9yKHNlbGVjdG9yKTtcbiAgICBpZiAoZWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGZsYXQoZWxlbWVudHMubWFwKCh4KSA9PiByZWR1Y2VUcmVlQnlTZWxlY3Rvcih4LnRhZywgcm9vdCkpKTtcblxuICAgICAgLy8gd2hlbiBodHRwczovL2dpdGh1Yi5jb20vYXdlYXJ5L3JzdC1zZWxlY3Rvci1wYXJzZXIvaXNzdWVzLzE1IGlzIHJlc29sdmVkXG4gICAgICAvLyBjb25zdCBodG1sVGFnTmFtZXMgPSBlbGVtZW50cy5tYXAoeCA9PiB4LnRhZykuam9pbignLCAnKTtcbiAgICAgIC8vIHJldHVybiByZWR1Y2VUcmVlQnlTZWxlY3RvcihodG1sVGFnTmFtZXMsIHJvb3QpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHNlbGVjdG9yID09PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB0cmVlRmlsdGVyKHJvb3QsIGJ1aWxkUHJlZGljYXRlKHNlbGVjdG9yKSk7XG4gIH1cblxuICBsZXQgcmVzdWx0cyA9IFtdO1xuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHRva2VucyA9IHNhZmVseUdlbmVyYXRlVG9rZW5zKHNlbGVjdG9yKTtcbiAgICBsZXQgaW5kZXggPSAwO1xuICAgIHdoaWxlIChpbmRleCA8IHRva2Vucy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2luZGV4XTtcbiAgICAgIC8qKlxuICAgICAgICogVGhlcmUgYXJlIHR3byB0eXBlcyBvZiB0b2tlbnMgaW4gYSBDU1Mgc2VsZWN0b3I6XG4gICAgICAgKlxuICAgICAgICogMS4gU2VsZWN0b3IgdG9rZW5zLiBUaGVzZSB0YXJnZXQgbm9kZXMgZGlyZWN0bHksIGxpa2VcbiAgICAgICAqICAgIHR5cGUgb3IgYXR0cmlidXRlIHNlbGVjdG9ycy4gVGhlc2UgYXJlIGVhc3kgdG8gYXBwbHlcbiAgICAgICAqICAgIGJlY2F1c2Ugd2UgY2FuIHRyYXZlcnNlIHRoZSB0cmVlIGFuZCByZXR1cm4gb25seVxuICAgICAgICogICAgdGhlIG5vZGVzIHRoYXQgbWF0Y2ggdGhlIHByZWRpY2F0ZS5cbiAgICAgICAqXG4gICAgICAgKiAyLiBDb21iaW5hdG9yIHRva2Vucy4gVGhlc2UgdG9rZW5zIGNoYWluIHRvZ2V0aGVyXG4gICAgICAgKiAgICBzZWxlY3RvciBub2Rlcy4gRm9yIGV4YW1wbGUgPiBmb3IgY2hpbGRyZW4sIG9yICtcbiAgICAgICAqICAgIGZvciBhZGphY2VudCBzaWJsaW5ncy4gVGhlc2UgYXJlIGhhcmRlciB0byBtYXRjaFxuICAgICAgICogICAgYXMgd2UgaGF2ZSB0byB0cmFjayB3aGVyZSBpbiB0aGUgdHJlZSB3ZSBhcmVcbiAgICAgICAqICAgIHRvIGRldGVybWluZSBpZiBhIHNlbGVjdG9yIG5vZGUgYXBwbGllcyBvciBub3QuXG4gICAgICAgKi9cbiAgICAgIGlmICh0b2tlbi50eXBlID09PSBTRUxFQ1RPUikge1xuICAgICAgICBjb25zdCBwcmVkaWNhdGUgPSBidWlsZFByZWRpY2F0ZUZyb21Ub2tlbih0b2tlbiwgcm9vdCk7XG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmNvbmNhdCh0cmVlRmlsdGVyKHJvb3QsIHByZWRpY2F0ZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gV2UgY2FuIGFzc3VtZSB0aGVyZSBhbHdheXMgYWxsIHByZXZpb3VzbHkgbWF0Y2hlZCB0b2tlbnMgc2luY2Ugc2VsZWN0b3JzXG4gICAgICAgIC8vIGNhbm5vdCBzdGFydCB3aXRoIGNvbWJpbmF0b3JzLlxuICAgICAgICBjb25zdCB7IHR5cGUgfSA9IHRva2VuO1xuICAgICAgICAvLyBXZSBhc3N1bWUgdGhlIG5leHQgdG9rZW4gaXMgYSBzZWxlY3Rvciwgc28gbW92ZSB0aGUgaW5kZXhcbiAgICAgICAgLy8gZm9yd2FyZCBhbmQgYnVpbGQgdGhlIHByZWRpY2F0ZS5cbiAgICAgICAgaW5kZXggKz0gMTtcbiAgICAgICAgY29uc3QgcHJlZGljYXRlID0gYnVpbGRQcmVkaWNhdGVGcm9tVG9rZW4odG9rZW5zW2luZGV4XSwgcm9vdCk7XG4gICAgICAgIC8vIFdlIG1hdGNoIGFnYWluc3Qgb25seSB0aGUgbm9kZXMgd2hpY2ggaGF2ZSBhbHJlYWR5IGJlZW4gbWF0Y2hlZCxcbiAgICAgICAgLy8gc2luY2UgYSBjb21iaW5hdG9yIGlzIG1lYW50IHRvIHJlZmluZSBhIHByZXZpb3VzIHNlbGVjdG9yLlxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAvLyBUaGUgKyBjb21iaW5hdG9yXG4gICAgICAgICAgY2FzZSBBREpBQ0VOVF9TSUJMSU5HOlxuICAgICAgICAgICAgcmVzdWx0cyA9IG1hdGNoQWRqYWNlbnRTaWJsaW5ncyhyZXN1bHRzLCBwcmVkaWNhdGUsIHJvb3QpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgLy8gVGhlIH4gY29tYmluYXRvclxuICAgICAgICAgIGNhc2UgR0VORVJBTF9TSUJMSU5HOlxuICAgICAgICAgICAgcmVzdWx0cyA9IG1hdGNoR2VuZXJhbFNpYmxpbmcocmVzdWx0cywgcHJlZGljYXRlLCByb290KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIC8vIFRoZSA+IGNvbWJpbmF0b3JcbiAgICAgICAgICBjYXNlIENISUxEOlxuICAgICAgICAgICAgcmVzdWx0cyA9IG1hdGNoRGlyZWN0Q2hpbGQocmVzdWx0cywgcHJlZGljYXRlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIC8vIFRoZSAnICcgKHdoaXRlc3BhY2UpIGNvbWJpbmF0b3JcbiAgICAgICAgICBjYXNlIERFU0NFTkRBTlQ6IHtcbiAgICAgICAgICAgIHJlc3VsdHMgPSBtYXRjaERlc2NlbmRhbnQocmVzdWx0cywgcHJlZGljYXRlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGNvbWJpbmF0b3Igc2VsZWN0b3I6ICR7dHlwZX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaW5kZXggKz0gMTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRW56eW1lOjpTZWxlY3RvciBleHBlY3RzIGEgc3RyaW5nLCBvYmplY3QsIG9yIENvbXBvbmVudCBDb25zdHJ1Y3RvcicpO1xuICB9XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVkdWNlVHJlZXNCeVNlbGVjdG9yKHNlbGVjdG9yLCByb290cykge1xuICBjb25zdCByZXN1bHRzID0gcm9vdHMubWFwKChuKSA9PiByZWR1Y2VUcmVlQnlTZWxlY3RvcihzZWxlY3RvciwgbikpO1xuICByZXR1cm4gdW5pcXVlKGZsYXQocmVzdWx0cywgMSkpO1xufVxuIl19