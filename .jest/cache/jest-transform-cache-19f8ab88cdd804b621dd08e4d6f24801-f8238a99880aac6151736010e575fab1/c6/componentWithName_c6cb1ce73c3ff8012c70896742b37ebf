7671252c5a979b6e09e2d2fcc4782f11
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = componentWithName;

var _react = _interopRequireDefault(require("react"));

var _isRegex = _interopRequireDefault(require("is-regex"));

var _arrayPrototype = _interopRequireDefault(require("array.prototype.find"));

var _getComponentName = _interopRequireDefault(require("./helpers/getComponentName"));

var _wrapValidator = _interopRequireDefault(require("./helpers/wrapValidator"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

function stripHOCs(fullName, namesOfHOCsToStrip) {
  var innerName = fullName;

  while (/\([^()]*\)/g.test(innerName)) {
    var HOC = innerName;
    var previousHOC = void 0;

    do {
      previousHOC = HOC;
      HOC = previousHOC.replace(/\([^()]*\)/g, '');
    } while (previousHOC !== HOC);

    if (namesOfHOCsToStrip.indexOf(HOC) === -1) {
      return innerName;
    }

    innerName = innerName.replace(RegExp("^".concat(HOC, "\\(|\\)$"), 'g'), '');
  }

  return innerName;
}

function hasName(name, namesOfHOCsToStrip, propValue, propName, componentName) {
  for (var _len = arguments.length, rest = new Array(_len > 5 ? _len - 5 : 0), _key = 5; _key < _len; _key++) {
    rest[_key - 5] = arguments[_key];
  }

  if (Array.isArray(propValue)) {
    return (0, _arrayPrototype["default"])(propValue.map(function (item) {
      return hasName.apply(void 0, [name, namesOfHOCsToStrip, item, propName, componentName].concat(rest));
    }), Boolean) || null;
  }

  if (!_react["default"].isValidElement(propValue)) {
    return new TypeError("".concat(componentName, ".").concat(propName, " is not a valid React element"));
  }

  var type = propValue.type;
  var componentNameFromType = (0, _getComponentName["default"])(type);
  var innerComponentName = namesOfHOCsToStrip.length > 0 ? stripHOCs(componentNameFromType, namesOfHOCsToStrip) : componentNameFromType;

  if ((0, _isRegex["default"])(name) && !name.test(innerComponentName)) {
    return new TypeError("`".concat(componentName, ".").concat(propName, "` only accepts components matching the regular expression ").concat(name));
  }

  if (!(0, _isRegex["default"])(name) && innerComponentName !== name) {
    return new TypeError("`".concat(componentName, ".").concat(propName, "` only accepts components named ").concat(name, ", got ").concat(innerComponentName));
  }

  return null;
}

function componentWithName(name) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (typeof name !== 'string' && !(0, _isRegex["default"])(name)) {
    throw new TypeError('name must be a string or a regex');
  }

  var passedOptions = Object.keys(options);

  if (passedOptions.length > 1 || passedOptions.length === 1 && passedOptions[0] !== 'stripHOCs') {
    throw new TypeError("The only options supported are: \u201CstripHOCs\u201D, got: \u201C".concat(passedOptions.join('â€, â€œ'), "\u201D"));
  }

  var _options$stripHOCs = options.stripHOCs,
      namesOfHOCsToStrip = _options$stripHOCs === void 0 ? [] : _options$stripHOCs;
  var allHOCNamesAreValid = namesOfHOCsToStrip.every(function (x) {
    if (typeof x !== 'string' || /[()]/g.test(x)) {
      return false;
    }

    return /^(?:[a-z][a-zA-Z0-9]+|[A-Z][a-z][a-zA-Z0-9]+)$/.test(x);
  });

  if (!allHOCNamesAreValid) {
    throw new TypeError('every provided HOC name must be a string with no parens, and in camelCase');
  }

  function componentWithNameValidator(props, propName, componentName) {
    var propValue = props[propName];

    if (props[propName] == null) {
      return null;
    }

    for (var _len2 = arguments.length, rest = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {
      rest[_key2 - 3] = arguments[_key2];
    }

    return hasName.apply(void 0, [name, namesOfHOCsToStrip, propValue, propName, componentName].concat(rest));
  }

  componentWithNameValidator.isRequired = function componentWithNameRequired(props, propName, componentName) {
    var propValue = props[propName];

    if (propValue == null) {
      return new TypeError("`".concat(componentName, ".").concat(propName, "` requires at least one component named ").concat(name));
    }

    for (var _len3 = arguments.length, rest = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {
      rest[_key3 - 3] = arguments[_key3];
    }

    return hasName.apply(void 0, [name, namesOfHOCsToStrip, propValue, propName, componentName].concat(rest));
  };

  return (0, _wrapValidator["default"])(componentWithNameValidator, "componentWithName:".concat(name), name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRXaXRoTmFtZS5qcyJdLCJuYW1lcyI6WyJpbm5lck5hbWUiLCJIT0MiLCJwcmV2aW91c0hPQyIsIm5hbWVzT2ZIT0NzVG9TdHJpcCIsIlJlZ0V4cCIsInJlc3QiLCJBcnJheSIsImhhc05hbWUiLCJSZWFjdCIsInR5cGUiLCJwcm9wVmFsdWUiLCJjb21wb25lbnROYW1lRnJvbVR5cGUiLCJpbm5lckNvbXBvbmVudE5hbWUiLCJzdHJpcEhPQ3MiLCJuYW1lIiwib3B0aW9ucyIsInBhc3NlZE9wdGlvbnMiLCJPYmplY3QiLCJhbGxIT0NOYW1lc0FyZVZhbGlkIiwicHJvcHMiLCJjb21wb25lbnRXaXRoTmFtZVZhbGlkYXRvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsZUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLHNCQUFBLENBQUEsQ0FBQTs7QUFFQSxJQUFBLGlCQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLDhCQUFBLENBQUE7O0FBQ0EsSUFBQSxjQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLDJCQUFBLENBQUE7Ozs7Ozs7O0FBRUEsU0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLGtCQUFBLEVBQWlEO0FBQy9DLE1BQUlBLFNBQVMsR0FBYixRQUFBOztBQUNBLFNBQU8sY0FBQSxJQUFBLENBQVAsU0FBTyxDQUFQLEVBQXdDO0FBQ3RDLFFBQUlDLEdBQUcsR0FBUCxTQUFBO0FBQ0EsUUFBSUMsV0FBVyxHQUFBLEtBQWYsQ0FBQTs7QUFDQSxPQUFHO0FBQ0RBLE1BQUFBLFdBQVcsR0FBWEEsR0FBQUE7QUFDQUQsTUFBQUEsR0FBRyxHQUFHQyxXQUFXLENBQVhBLE9BQUFBLENBQUFBLGFBQUFBLEVBQU5ELEVB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QSxNQUFBLENBQUEsUUFBQSxFQUFBLDBDQUFBLEVBQUEsTUFBQSxDQUFQLElBQU8sQ0FBQSxDQUFQO0FBQ0Q7O0FBSkQsU0FBQSxJQUFBLEtBQUEsR0FBQSxTQUFBLENBQUEsTUFBQSxFQURHTCxJQUNILEdBQUEsSUFBQSxLQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsR0FBQSxLQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxFQUFBLEtBQUEsR0FBQSxDQUFBLEVBQUEsS0FBQSxHQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQTtBQURHQSxNQUFBQSxJQUNILENBQUEsS0FBQSxHQUFBLENBQUEsQ0FER0EsR0FDSCxTQUFBLENBQUEsS0FBQSxDQURHQTtBQUNIOztBQUtBLFdBQU9FLE9BQU8sQ0FBUEEsS0FBQUEsQ0FBQUEsS0FBQUEsQ0FBQUEsRUFBQUEsQ0FBQUEsSUFBQUEsRUFBQUEsa0JBQUFBLEVBQUFBLFNBQUFBLEVBQUFBLFFBQUFBLEVBQUFBLGFBQUFBLEVBQUFBLE1BQUFBLENBQVAsSUFBT0EsQ0FBQUEsQ0FBUDtBQVZGYSxHQUFBQTs7QUFhQSxTQUFPLENBQUEsR0FBQSxjQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsMEJBQUEsRUFBQSxxQkFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEVBQVAsSUFBTyxDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IGlzUmVnZXggZnJvbSAnaXMtcmVnZXgnO1xuaW1wb3J0IGZpbmQgZnJvbSAnYXJyYXkucHJvdG90eXBlLmZpbmQnO1xuXG5pbXBvcnQgZ2V0Q29tcG9uZW50TmFtZSBmcm9tICcuL2hlbHBlcnMvZ2V0Q29tcG9uZW50TmFtZSc7XG5pbXBvcnQgd3JhcFZhbGlkYXRvciBmcm9tICcuL2hlbHBlcnMvd3JhcFZhbGlkYXRvcic7XG5cbmZ1bmN0aW9uIHN0cmlwSE9DcyhmdWxsTmFtZSwgbmFtZXNPZkhPQ3NUb1N0cmlwKSB7XG4gIGxldCBpbm5lck5hbWUgPSBmdWxsTmFtZTtcbiAgd2hpbGUgKCgvXFwoW14oKV0qXFwpL2cpLnRlc3QoaW5uZXJOYW1lKSkge1xuICAgIGxldCBIT0MgPSBpbm5lck5hbWU7XG4gICAgbGV0IHByZXZpb3VzSE9DO1xuICAgIGRvIHtcbiAgICAgIHByZXZpb3VzSE9DID0gSE9DO1xuICAgICAgSE9DID0gcHJldmlvdXNIT0MucmVwbGFjZSgvXFwoW14oKV0qXFwpL2csICcnKTtcbiAgICB9IHdoaWxlIChwcmV2aW91c0hPQyAhPT0gSE9DKTtcblxuICAgIGlmIChuYW1lc09mSE9Dc1RvU3RyaXAuaW5kZXhPZihIT0MpID09PSAtMSkge1xuICAgICAgcmV0dXJuIGlubmVyTmFtZTtcbiAgICB9XG4gICAgaW5uZXJOYW1lID0gaW5uZXJOYW1lLnJlcGxhY2UoUmVnRXhwKGBeJHtIT0N9XFxcXCh8XFxcXCkkYCwgJ2cnKSwgJycpO1xuICB9XG4gIHJldHVybiBpbm5lck5hbWU7XG59XG5cbmZ1bmN0aW9uIGhhc05hbWUobmFtZSwgbmFtZXNPZkhPQ3NUb1N0cmlwLCBwcm9wVmFsdWUsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHByb3BWYWx1ZSkpIHtcbiAgICByZXR1cm4gZmluZChcbiAgICAgIHByb3BWYWx1ZS5tYXAoKGl0ZW0pID0+IGhhc05hbWUoXG4gICAgICAgIG5hbWUsXG4gICAgICAgIG5hbWVzT2ZIT0NzVG9TdHJpcCxcbiAgICAgICAgaXRlbSxcbiAgICAgICAgcHJvcE5hbWUsXG4gICAgICAgIGNvbXBvbmVudE5hbWUsXG4gICAgICAgIC4uLnJlc3QsXG4gICAgICApKSxcbiAgICAgIEJvb2xlYW4sXG4gICAgKSB8fCBudWxsO1xuICB9XG5cbiAgaWYgKCFSZWFjdC5pc1ZhbGlkRWxlbWVudChwcm9wVmFsdWUpKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoXG4gICAgICBgJHtjb21wb25lbnROYW1lfS4ke3Byb3BOYW1lfSBpcyBub3QgYSB2YWxpZCBSZWFjdCBlbGVtZW50YCxcbiAgICApO1xuICB9XG5cbiAgY29uc3QgeyB0eXBlIH0gPSBwcm9wVmFsdWU7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWVGcm9tVHlwZSA9IGdldENvbXBvbmVudE5hbWUodHlwZSk7XG4gIGNvbnN0IGlubmVyQ29tcG9uZW50TmFtZSA9IG5hbWVzT2ZIT0NzVG9TdHJpcC5sZW5ndGggPiAwXG4gICAgPyBzdHJpcEhPQ3MoY29tcG9uZW50TmFtZUZyb21UeXBlLCBuYW1lc09mSE9Dc1RvU3RyaXApXG4gICAgOiBjb21wb25lbnROYW1lRnJvbVR5cGU7XG5cbiAgaWYgKGlzUmVnZXgobmFtZSkgJiYgIW5hbWUudGVzdChpbm5lckNvbXBvbmVudE5hbWUpKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoXG4gICAgICBgXFxgJHtjb21wb25lbnROYW1lfS4ke3Byb3BOYW1lfVxcYCBvbmx5IGFjY2VwdHMgY29tcG9uZW50cyBtYXRjaGluZyB0aGUgcmVndWxhciBleHByZXNzaW9uICR7bmFtZX1gLFxuICAgICk7XG4gIH1cblxuICBpZiAoIWlzUmVnZXgobmFtZSkgJiYgaW5uZXJDb21wb25lbnROYW1lICE9PSBuYW1lKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoXG4gICAgICBgXFxgJHtjb21wb25lbnROYW1lfS4ke3Byb3BOYW1lfVxcYCBvbmx5IGFjY2VwdHMgY29tcG9uZW50cyBuYW1lZCAke25hbWV9LCBnb3QgJHtpbm5lckNvbXBvbmVudE5hbWV9YCxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNvbXBvbmVudFdpdGhOYW1lKFxuICBuYW1lLFxuICBvcHRpb25zID0ge30sXG4pIHtcbiAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyAmJiAhaXNSZWdleChuYW1lKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ25hbWUgbXVzdCBiZSBhIHN0cmluZyBvciBhIHJlZ2V4Jyk7XG4gIH1cblxuICBjb25zdCBwYXNzZWRPcHRpb25zID0gT2JqZWN0LmtleXMob3B0aW9ucyk7XG4gIGlmIChwYXNzZWRPcHRpb25zLmxlbmd0aCA+IDEgfHwgKHBhc3NlZE9wdGlvbnMubGVuZ3RoID09PSAxICYmIHBhc3NlZE9wdGlvbnNbMF0gIT09ICdzdHJpcEhPQ3MnKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFRoZSBvbmx5IG9wdGlvbnMgc3VwcG9ydGVkIGFyZTog4oCcc3RyaXBIT0Nz4oCdLCBnb3Q6IOKAnCR7cGFzc2VkT3B0aW9ucy5qb2luKCfigJ0sIOKAnCcpfeKAnWApO1xuICB9XG4gIGNvbnN0IHsgc3RyaXBIT0NzOiBuYW1lc09mSE9Dc1RvU3RyaXAgPSBbXSB9ID0gb3B0aW9ucztcblxuICBjb25zdCBhbGxIT0NOYW1lc0FyZVZhbGlkID0gbmFtZXNPZkhPQ3NUb1N0cmlwLmV2ZXJ5KCh4KSA9PiB7XG4gICAgaWYgKHR5cGVvZiB4ICE9PSAnc3RyaW5nJyB8fCAvWygpXS9nLnRlc3QoeCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIC9eKD86W2Etel1bYS16QS1aMC05XSt8W0EtWl1bYS16XVthLXpBLVowLTldKykkLy50ZXN0KHgpO1xuICB9KTtcbiAgaWYgKCFhbGxIT0NOYW1lc0FyZVZhbGlkKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignZXZlcnkgcHJvdmlkZWQgSE9DIG5hbWUgbXVzdCBiZSBhIHN0cmluZyB3aXRoIG5vIHBhcmVucywgYW5kIGluIGNhbWVsQ2FzZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcG9uZW50V2l0aE5hbWVWYWxpZGF0b3IocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KSB7XG4gICAgY29uc3QgeyBbcHJvcE5hbWVdOiBwcm9wVmFsdWUgfSA9IHByb3BzO1xuICAgIGlmIChwcm9wc1twcm9wTmFtZV0gPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBoYXNOYW1lKG5hbWUsIG5hbWVzT2ZIT0NzVG9TdHJpcCwgcHJvcFZhbHVlLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgLi4ucmVzdCk7XG4gIH1cblxuICBjb21wb25lbnRXaXRoTmFtZVZhbGlkYXRvci5pc1JlcXVpcmVkID0gZnVuY3Rpb24gY29tcG9uZW50V2l0aE5hbWVSZXF1aXJlZChcbiAgICBwcm9wcyxcbiAgICBwcm9wTmFtZSxcbiAgICBjb21wb25lbnROYW1lLFxuICAgIC4uLnJlc3RcbiAgKSB7XG4gICAgY29uc3QgeyBbcHJvcE5hbWVdOiBwcm9wVmFsdWUgfSA9IHByb3BzO1xuICAgIGlmIChwcm9wVmFsdWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoYFxcYCR7Y29tcG9uZW50TmFtZX0uJHtwcm9wTmFtZX1cXGAgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIGNvbXBvbmVudCBuYW1lZCAke25hbWV9YCk7XG4gICAgfVxuICAgIHJldHVybiBoYXNOYW1lKG5hbWUsIG5hbWVzT2ZIT0NzVG9TdHJpcCwgcHJvcFZhbHVlLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgLi4ucmVzdCk7XG4gIH07XG5cbiAgcmV0dXJuIHdyYXBWYWxpZGF0b3IoY29tcG9uZW50V2l0aE5hbWVWYWxpZGF0b3IsIGBjb21wb25lbnRXaXRoTmFtZToke25hbWV9YCwgbmFtZSk7XG59XG4iXX0=