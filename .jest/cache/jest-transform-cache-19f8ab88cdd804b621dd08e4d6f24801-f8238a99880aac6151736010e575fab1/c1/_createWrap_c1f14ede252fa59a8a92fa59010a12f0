f3edd508b8bded159b46b38cbcde97d0
var baseSetData = require("./_baseSetData"),
    createBind = require("./_createBind"),
    createCurry = require("./_createCurry"),
    createHybrid = require("./_createHybrid"),
    createPartial = require("./_createPartial"),
    getData = require("./_getData"),
    mergeData = require("./_mergeData"),
    setData = require("./_setData"),
    setWrapToString = require("./_setWrapToString"),
    toInteger = require("./toInteger");

var FUNC_ERROR_TEXT = 'Expected a function';
var WRAP_BIND_FLAG = 1,
    WRAP_BIND_KEY_FLAG = 2,
    WRAP_CURRY_FLAG = 8,
    WRAP_CURRY_RIGHT_FLAG = 16,
    WRAP_PARTIAL_FLAG = 32,
    WRAP_PARTIAL_RIGHT_FLAG = 64;
var nativeMax = Math.max;

function createWrap(func, bitmask, thisArg, partials, holders, argPos, ary, arity) {
  var isBindKey = bitmask & WRAP_BIND_KEY_FLAG;

  if (!isBindKey && typeof func != 'function') {
    throw new TypeError(FUNC_ERROR_TEXT);
  }

  var length = partials ? partials.length : 0;

  if (!length) {
    bitmask &= ~(WRAP_PARTIAL_FLAG | WRAP_PARTIAL_RIGHT_FLAG);
    partials = holders = undefined;
  }

  ary = ary === undefined ? ary : nativeMax(toInteger(ary), 0);
  arity = arity === undefined ? arity : toInteger(arity);
  length -= holders ? holders.length : 0;

  if (bitmask & WRAP_PARTIAL_RIGHT_FLAG) {
    var partialsRight = partials,
        holdersRight = holders;
    partials = holders = undefined;
  }

  var data = isBindKey ? undefined : getData(func);
  var newData = [func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity];

  if (data) {
    mergeData(newData, data);
  }

  func = newData[0];
  bitmask = newData[1];
  thisArg = newData[2];
  partials = newData[3];
  holders = newData[4];
  arity = newData[9] = newData[9] === undefined ? isBindKey ? 0 : func.length : nativeMax(newData[9] - length, 0);

  if (!arity && bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG)) {
    bitmask &= ~(WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG);
  }

  if (!bitmask || bitmask == WRAP_BIND_FLAG) {
    var result = createBind(func, bitmask, thisArg);
  } else if (bitmask == WRAP_CURRY_FLAG || bitmask == WRAP_CURRY_RIGHT_FLAG) {
    result = createCurry(func, bitmask, arity);
  } else if ((bitmask == WRAP_PARTIAL_FLAG || bitmask == (WRAP_BIND_FLAG | WRAP_PARTIAL_FLAG)) && !holders.length) {
    result = createPartial(func, bitmask, thisArg, partials);
  } else {
    result = createHybrid.apply(undefined, newData);
  }

  var setter = data ? baseSetData : setData;
  return setWrapToString(setter(result, newData), func, bitmask);
}

module.exports = createWrap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9jcmVhdGVXcmFwLmpzIl0sIm5hbWVzIjpbImJhc2VTZXREYXRhIiwicmVxdWlyZSIsImNyZWF0ZUJpbmQiLCJjcmVhdGVDdXJyeSIsImNyZWF0ZUh5YnJpZCIsImNyZWF0ZVBhcnRpYWwiLCJnZXREYXRhIiwibWVyZ2VEYXRhIiwic2V0RGF0YSIsInNldFdyYXBUb1N0cmluZyIsInRvSW50ZWdlciIsIkZVTkNfRVJST1JfVEVYVCIsIldSQVBfQklORF9GTEFHIiwiV1JBUF9CSU5EX0tFWV9GTEFHIiwiV1JBUF9DVVJSWV9GTEFHIiwiV1JBUF9DVVJSWV9SSUdIVF9GTEFHIiwiV1JBUF9QQVJUSUFMX0ZMQUciLCJXUkFQX1BBUlRJQUxfUklHSFRfRkxBRyIsIm5hdGl2ZU1heCIsIk1hdGgiLCJtYXgiLCJjcmVhdGVXcmFwIiwiZnVuYyIsImJpdG1hc2siLCJ0aGlzQXJnIiwicGFydGlhbHMiLCJob2xkZXJzIiwiYXJnUG9zIiwiYXJ5IiwiYXJpdHkiLCJpc0JpbmRLZXkiLCJUeXBlRXJyb3IiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwYXJ0aWFsc1JpZ2h0IiwiaG9sZGVyc1JpZ2h0IiwiZGF0YSIsIm5ld0RhdGEiLCJyZXN1bHQiLCJhcHBseSIsInNldHRlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxrQkFBekI7QUFBQSxJQUNJQyxVQUFVLEdBQUdELE9BQU8saUJBRHhCO0FBQUEsSUFFSUUsV0FBVyxHQUFHRixPQUFPLGtCQUZ6QjtBQUFBLElBR0lHLFlBQVksR0FBR0gsT0FBTyxtQkFIMUI7QUFBQSxJQUlJSSxhQUFhLEdBQUdKLE9BQU8sb0JBSjNCO0FBQUEsSUFLSUssT0FBTyxHQUFHTCxPQUFPLGNBTHJCO0FBQUEsSUFNSU0sU0FBUyxHQUFHTixPQUFPLGdCQU52QjtBQUFBLElBT0lPLE9BQU8sR0FBR1AsT0FBTyxjQVByQjtBQUFBLElBUUlRLGVBQWUsR0FBR1IsT0FBTyxzQkFS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b250ZW50IjpbInZhciBiYXNlU2V0RGF0YSA9IHJlcXVpcmUoJy4vX2Jhc2VTZXREYXRhJyksXG4gICAgY3JlYXRlQmluZCA9IHJlcXVpcmUoJy4vX2NyZWF0ZUJpbmQnKSxcbiAgICBjcmVhdGVDdXJyeSA9IHJlcXVpcmUoJy4vX2NyZWF0ZUN1cnJ5JyksXG4gICAgY3JlYXRlSHlicmlkID0gcmVxdWlyZSgnLi9fY3JlYXRlSHlicmlkJyksXG4gICAgY3JlYXRlUGFydGlhbCA9IHJlcXVpcmUoJy4vX2NyZWF0ZVBhcnRpYWwnKSxcbiAgICBnZXREYXRhID0gcmVxdWlyZSgnLi9fZ2V0RGF0YScpLFxuICAgIG1lcmdlRGF0YSA9IHJlcXVpcmUoJy4vX21lcmdlRGF0YScpLFxuICAgIHNldERhdGEgPSByZXF1aXJlKCcuL19zZXREYXRhJyksXG4gICAgc2V0V3JhcFRvU3RyaW5nID0gcmVxdWlyZSgnLi9fc2V0V3JhcFRvU3RyaW5nJyksXG4gICAgdG9JbnRlZ2VyID0gcmVxdWlyZSgnLi90b0ludGVnZXInKTtcblxuLyoqIEVycm9yIG1lc3NhZ2UgY29uc3RhbnRzLiAqL1xudmFyIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJztcblxuLyoqIFVzZWQgdG8gY29tcG9zZSBiaXRtYXNrcyBmb3IgZnVuY3Rpb24gbWV0YWRhdGEuICovXG52YXIgV1JBUF9CSU5EX0ZMQUcgPSAxLFxuICAgIFdSQVBfQklORF9LRVlfRkxBRyA9IDIsXG4gICAgV1JBUF9DVVJSWV9GTEFHID0gOCxcbiAgICBXUkFQX0NVUlJZX1JJR0hUX0ZMQUcgPSAxNixcbiAgICBXUkFQX1BBUlRJQUxfRkxBRyA9IDMyLFxuICAgIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHID0gNjQ7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi9cbnZhciBuYXRpdmVNYXggPSBNYXRoLm1heDtcblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBlaXRoZXIgY3VycmllcyBvciBpbnZva2VzIGBmdW5jYCB3aXRoIG9wdGlvbmFsXG4gKiBgdGhpc2AgYmluZGluZyBhbmQgcGFydGlhbGx5IGFwcGxpZWQgYXJndW1lbnRzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufHN0cmluZ30gZnVuYyBUaGUgZnVuY3Rpb24gb3IgbWV0aG9kIG5hbWUgdG8gd3JhcC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLlxuICogICAgMSAtIGBfLmJpbmRgXG4gKiAgICAyIC0gYF8uYmluZEtleWBcbiAqICAgIDQgLSBgXy5jdXJyeWAgb3IgYF8uY3VycnlSaWdodGAgb2YgYSBib3VuZCBmdW5jdGlvblxuICogICAgOCAtIGBfLmN1cnJ5YFxuICogICAxNiAtIGBfLmN1cnJ5UmlnaHRgXG4gKiAgIDMyIC0gYF8ucGFydGlhbGBcbiAqICAgNjQgLSBgXy5wYXJ0aWFsUmlnaHRgXG4gKiAgMTI4IC0gYF8ucmVhcmdgXG4gKiAgMjU2IC0gYF8uYXJ5YFxuICogIDUxMiAtIGBfLmZsaXBgXG4gKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLlxuICogQHBhcmFtIHtBcnJheX0gW3BhcnRpYWxzXSBUaGUgYXJndW1lbnRzIHRvIGJlIHBhcnRpYWxseSBhcHBsaWVkLlxuICogQHBhcmFtIHtBcnJheX0gW2hvbGRlcnNdIFRoZSBgcGFydGlhbHNgIHBsYWNlaG9sZGVyIGluZGV4ZXMuXG4gKiBAcGFyYW0ge0FycmF5fSBbYXJnUG9zXSBUaGUgYXJndW1lbnQgcG9zaXRpb25zIG9mIHRoZSBuZXcgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge251bWJlcn0gW2FyeV0gVGhlIGFyaXR5IGNhcCBvZiBgZnVuY2AuXG4gKiBAcGFyYW0ge251bWJlcn0gW2FyaXR5XSBUaGUgYXJpdHkgb2YgYGZ1bmNgLlxuICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgd3JhcHBlZCBmdW5jdGlvbi5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlV3JhcChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnLCBwYXJ0aWFscywgaG9sZGVycywgYXJnUG9zLCBhcnksIGFyaXR5KSB7XG4gIHZhciBpc0JpbmRLZXkgPSBiaXRtYXNrICYgV1JBUF9CSU5EX0tFWV9GTEFHO1xuICBpZiAoIWlzQmluZEtleSAmJiB0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpO1xuICB9XG4gIHZhciBsZW5ndGggPSBwYXJ0aWFscyA/IHBhcnRpYWxzLmxlbmd0aCA6IDA7XG4gIGlmICghbGVuZ3RoKSB7XG4gICAgYml0bWFzayAmPSB+KFdSQVBfUEFSVElBTF9GTEFHIHwgV1JBUF9QQVJUSUFMX1JJR0hUX0ZMQUcpO1xuICAgIHBhcnRpYWxzID0gaG9sZGVycyA9IHVuZGVmaW5lZDtcbiAgfVxuICBhcnkgPSBhcnkgPT09IHVuZGVmaW5lZCA/IGFyeSA6IG5hdGl2ZU1heCh0b0ludGVnZXIoYXJ5KSwgMCk7XG4gIGFyaXR5ID0gYXJpdHkgPT09IHVuZGVmaW5lZCA/IGFyaXR5IDogdG9JbnRlZ2VyKGFyaXR5KTtcbiAgbGVuZ3RoIC09IGhvbGRlcnMgPyBob2xkZXJzLmxlbmd0aCA6IDA7XG5cbiAgaWYgKGJpdG1hc2sgJiBXUkFQX1BBUlRJQUxfUklHSFRfRkxBRykge1xuICAgIHZhciBwYXJ0aWFsc1JpZ2h0ID0gcGFydGlhbHMsXG4gICAgICAgIGhvbGRlcnNSaWdodCA9IGhvbGRlcnM7XG5cbiAgICBwYXJ0aWFscyA9IGhvbGRlcnMgPSB1bmRlZmluZWQ7XG4gIH1cbiAgdmFyIGRhdGEgPSBpc0JpbmRLZXkgPyB1bmRlZmluZWQgOiBnZXREYXRhKGZ1bmMpO1xuXG4gIHZhciBuZXdEYXRhID0gW1xuICAgIGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBwYXJ0aWFsc1JpZ2h0LCBob2xkZXJzUmlnaHQsXG4gICAgYXJnUG9zLCBhcnksIGFyaXR5XG4gIF07XG5cbiAgaWYgKGRhdGEpIHtcbiAgICBtZXJnZURhdGEobmV3RGF0YSwgZGF0YSk7XG4gIH1cbiAgZnVuYyA9IG5ld0RhdGFbMF07XG4gIGJpdG1hc2sgPSBuZXdEYXRhWzFdO1xuICB0aGlzQXJnID0gbmV3RGF0YVsyXTtcbiAgcGFydGlhbHMgPSBuZXdEYXRhWzNdO1xuICBob2xkZXJzID0gbmV3RGF0YVs0XTtcbiAgYXJpdHkgPSBuZXdEYXRhWzldID0gbmV3RGF0YVs5XSA9PT0gdW5kZWZpbmVkXG4gICAgPyAoaXNCaW5kS2V5ID8gMCA6IGZ1bmMubGVuZ3RoKVxuICAgIDogbmF0aXZlTWF4KG5ld0RhdGFbOV0gLSBsZW5ndGgsIDApO1xuXG4gIGlmICghYXJpdHkgJiYgYml0bWFzayAmIChXUkFQX0NVUlJZX0ZMQUcgfCBXUkFQX0NVUlJZX1JJR0hUX0ZMQUcpKSB7XG4gICAgYml0bWFzayAmPSB+KFdSQVBfQ1VSUllfRkxBRyB8IFdSQVBfQ1VSUllfUklHSFRfRkxBRyk7XG4gIH1cbiAgaWYgKCFiaXRtYXNrIHx8IGJpdG1hc2sgPT0gV1JBUF9CSU5EX0ZMQUcpIHtcbiAgICB2YXIgcmVzdWx0ID0gY3JlYXRlQmluZChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnKTtcbiAgfSBlbHNlIGlmIChiaXRtYXNrID09IFdSQVBfQ1VSUllfRkxBRyB8fCBiaXRtYXNrID09IFdSQVBfQ1VSUllfUklHSFRfRkxBRykge1xuICAgIHJlc3VsdCA9IGNyZWF0ZUN1cnJ5KGZ1bmMsIGJpdG1hc2ssIGFyaXR5KTtcbiAgfSBlbHNlIGlmICgoYml0bWFzayA9PSBXUkFQX1BBUlRJQUxfRkxBRyB8fCBiaXRtYXNrID09IChXUkFQX0JJTkRfRkxBRyB8IFdSQVBfUEFSVElBTF9GTEFHKSkgJiYgIWhvbGRlcnMubGVuZ3RoKSB7XG4gICAgcmVzdWx0ID0gY3JlYXRlUGFydGlhbChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnLCBwYXJ0aWFscyk7XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ID0gY3JlYXRlSHlicmlkLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7XG4gIH1cbiAgdmFyIHNldHRlciA9IGRhdGEgPyBiYXNlU2V0RGF0YSA6IHNldERhdGE7XG4gIHJldHVybiBzZXRXcmFwVG9TdHJpbmcoc2V0dGVyKHJlc3VsdCwgbmV3RGF0YSksIGZ1bmMsIGJpdG1hc2spO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVdyYXA7XG4iXX0=