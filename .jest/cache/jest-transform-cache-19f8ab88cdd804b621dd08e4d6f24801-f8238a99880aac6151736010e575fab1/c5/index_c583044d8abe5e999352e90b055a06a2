c057f14ea553085376dee1791db21c30
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var ElementType = require('domelementtype');

var entities = require('entities');

var foreignNames = require("./foreignNames.json");

foreignNames.elementNames.__proto__ = null;
foreignNames.attributeNames.__proto__ = null;
var unencodedElements = {
  __proto__: null,
  style: true,
  script: true,
  xmp: true,
  iframe: true,
  noembed: true,
  noframes: true,
  plaintext: true,
  noscript: true
};

function formatAttrs(attributes, opts) {
  if (!attributes) return;
  var output = '';
  var value;

  for (var key in attributes) {
    value = attributes[key];

    if (output) {
      output += ' ';
    }

    if (opts.xmlMode === 'foreign') {
      key = foreignNames.attributeNames[key] || key;
    }

    output += key;

    if (value !== null && value !== '' || opts.xmlMode) {
      output += '="' + (opts.decodeEntities ? entities.encodeXML(value) : value.replace(/\"/g, '&quot;')) + '"';
    }
  }

  return output;
}

var singleTag = {
  __proto__: null,
  area: true,
  base: true,
  basefont: true,
  br: true,
  col: true,
  command: true,
  embed: true,
  frame: true,
  hr: true,
  img: true,
  input: true,
  isindex: true,
  keygen: true,
  link: true,
  meta: true,
  param: true,
  source: true,
  track: true,
  wbr: true
};

var render = module.exports = function (dom, opts) {
  if (!Array.isArray(dom) && !dom.cheerio) dom = [dom];
  opts = opts || {};
  var output = '';

  for (var i = 0; i < dom.length; i++) {
    var elem = dom[i];
    if (elem.type === 'root') output += render(elem.children, opts);else if (ElementType.isTag(elem)) output += renderTag(elem, opts);else if (elem.type === ElementType.Directive) output += renderDirective(elem);else if (elem.type === ElementType.Comment) output += renderComment(elem);else if (elem.type === ElementType.CDATA) output += renderCdata(elem);else output += renderText(elem, opts);
  }

  return output;
};

var foreignModeIntegrationPoints = ['mi', 'mo', 'mn', 'ms', 'mtext', 'annotation-xml', 'foreignObject', 'desc', 'title'];

function renderTag(elem, opts) {
  if (opts.xmlMode === 'foreign') {
    elem.name = foreignNames.elementNames[elem.name] || elem.name;
    if (elem.parent && foreignModeIntegrationPoints.indexOf(elem.parent.name) >= 0) opts = (0, _extends2.default)({}, opts, {
      xmlMode: false
    });
  }

  if (!opts.xmlMode && ['svg', 'math'].indexOf(elem.name) >= 0) {
    opts = (0, _extends2.default)({}, opts, {
      xmlMode: 'foreign'
    });
  }

  var tag = '<' + elem.name;
  var attribs = formatAttrs(elem.attribs, opts);

  if (attribs) {
    tag += ' ' + attribs;
  }

  if (opts.xmlMode && (!elem.children || elem.children.length === 0)) {
    tag += '/>';
  } else {
    tag += '>';

    if (elem.children) {
      tag += render(elem.children, opts);
    }

    if (!singleTag[elem.name] || opts.xmlMode) {
      tag += '</' + elem.name + '>';
    }
  }

  return tag;
}

function renderDirective(elem) {
  return '<' + elem.data + '>';
}

function renderText(elem, opts) {
  var data = elem.data || '';

  if (opts.decodeEntities && !(elem.parent && elem.parent.name in unencodedElements)) {
    data = entities.encodeXML(data);
  }

  return data;
}

function renderCdata(elem) {
  return '<![CDATA[' + elem.children[0].data + ']]>';
}

function renderComment(elem) {
  return '<!--' + elem.data + '-->';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkVsZW1lbnRUeXBlIiwicmVxdWlyZSIsImVudGl0aWVzIiwiZm9yZWlnbk5hbWVzIiwiZWxlbWVudE5hbWVzIiwiX19wcm90b19fIiwiYXR0cmlidXRlTmFtZXMiLCJ1bmVuY29kZWRFbGVtZW50cyIsInN0eWxlIiwic2NyaXB0IiwieG1wIiwiaWZyYW1lIiwibm9lbWJlZCIsIm5vZnJhbWVzIiwicGxhaW50ZXh0Iiwibm9zY3JpcHQiLCJmb3JtYXRBdHRycyIsImF0dHJpYnV0ZXMiLCJvcHRzIiwib3V0cHV0IiwidmFsdWUiLCJrZXkiLCJ4bWxNb2RlIiwiZGVjb2RlRW50aXRpZXMiLCJlbmNvZGVYTUwiLCJyZXBsYWNlIiwic2luZ2xlVGFnIiwiYXJlYSIsImJhc2UiLCJiYXNlZm9udCIsImJyIiwiY29sIiwiY29tbWFuZCIsImVtYmVkIiwiZnJhbWUiLCJociIsImltZyIsImlucHV0IiwiaXNpbmRleCIsImtleWdlbiIsImxpbmsiLCJtZXRhIiwicGFyYW0iLCJzb3VyY2UiLCJ0cmFjayIsIndiciIsInJlbmRlciIsIm1vZHVsZSIsImV4cG9ydHMiLCJkb20iLCJBcnJheSIsImlzQXJyYXkiLCJjaGVlcmlvIiwiaSIsImxlbmd0aCIsImVsZW0iLCJ0eXBlIiwiY2hpbGRyZW4iLCJpc1RhZyIsInJlbmRlclRhZyIsIkRpcmVjdGl2ZSIsInJlbmRlckRpcmVjdGl2ZSIsIkNvbW1lbnQiLCJyZW5kZXJDb21tZW50IiwiQ0RBVEEiLCJyZW5kZXJDZGF0YSIsInJlbmRlclRleHQiLCJmb3JlaWduTW9kZUludGVncmF0aW9uUG9pbnRzIiwibmFtZSIsInBhcmVudCIsImluZGV4T2YiLCJ0YWciLCJhdHRyaWJzIiwiZGF0YSJdLCJtYXBwaW5ncyI6Ijs7OztBQUdBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQXpCOztBQUNBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBTUEs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QWQsRUFBaUJnQixJQUEvQixHQUFzQyxLQUE3QztBQUNEOztBQUVELFNBQVNWLGFBQVQsQ0FBdUJSLElBQXZCLEVBQTZCO0FBQzNCLFNBQU8sU0FBU0EsSUFBSSxDQUFDa0IsSUFBZCxHQUFxQixLQUE1QjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAgTW9kdWxlIGRlcGVuZGVuY2llc1xuKi9cbnZhciBFbGVtZW50VHlwZSA9IHJlcXVpcmUoJ2RvbWVsZW1lbnR0eXBlJyk7XG52YXIgZW50aXRpZXMgPSByZXF1aXJlKCdlbnRpdGllcycpO1xuXG4vKiBtaXhlZC1jYXNlIFNWRyBhbmQgTWF0aE1MIHRhZ3MgJiBhdHRyaWJ1dGVzXG4gICByZWNvZ25pemVkIGJ5IHRoZSBIVE1MIHBhcnNlciwgc2VlXG4gICBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9wYXJzaW5nLmh0bWwjcGFyc2luZy1tYWluLWluZm9yZWlnblxuKi9cbnZhciBmb3JlaWduTmFtZXMgPSByZXF1aXJlKCcuL2ZvcmVpZ25OYW1lcy5qc29uJyk7XG5mb3JlaWduTmFtZXMuZWxlbWVudE5hbWVzLl9fcHJvdG9fXyA9IG51bGw7IC8qIHVzZSBhcyBhIHNpbXBsZSBkaWN0aW9uYXJ5ICovXG5mb3JlaWduTmFtZXMuYXR0cmlidXRlTmFtZXMuX19wcm90b19fID0gbnVsbDtcblxudmFyIHVuZW5jb2RlZEVsZW1lbnRzID0ge1xuICBfX3Byb3RvX186IG51bGwsXG4gIHN0eWxlOiB0cnVlLFxuICBzY3JpcHQ6IHRydWUsXG4gIHhtcDogdHJ1ZSxcbiAgaWZyYW1lOiB0cnVlLFxuICBub2VtYmVkOiB0cnVlLFxuICBub2ZyYW1lczogdHJ1ZSxcbiAgcGxhaW50ZXh0OiB0cnVlLFxuICBub3NjcmlwdDogdHJ1ZVxufTtcblxuLypcbiAgRm9ybWF0IGF0dHJpYnV0ZXNcbiovXG5mdW5jdGlvbiBmb3JtYXRBdHRycyhhdHRyaWJ1dGVzLCBvcHRzKSB7XG4gIGlmICghYXR0cmlidXRlcykgcmV0dXJuO1xuXG4gIHZhciBvdXRwdXQgPSAnJztcbiAgdmFyIHZhbHVlO1xuXG4gIC8vIExvb3AgdGhyb3VnaCB0aGUgYXR0cmlidXRlc1xuICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgIHZhbHVlID0gYXR0cmlidXRlc1trZXldO1xuICAgIGlmIChvdXRwdXQpIHtcbiAgICAgIG91dHB1dCArPSAnICc7XG4gICAgfVxuXG4gICAgaWYgKG9wdHMueG1sTW9kZSA9PT0gJ2ZvcmVpZ24nKSB7XG4gICAgICAvKiBmaXggdXAgbWl4ZWQtY2FzZSBhdHRyaWJ1dGUgbmFtZXMgKi9cbiAgICAgIGtleSA9IGZvcmVpZ25OYW1lcy5hdHRyaWJ1dGVOYW1lc1trZXldIHx8IGtleTtcbiAgICB9XG4gICAgb3V0cHV0ICs9IGtleTtcbiAgICBpZiAoKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAnJykgfHwgb3B0cy54bWxNb2RlKSB7XG4gICAgICBvdXRwdXQgKz1cbiAgICAgICAgJz1cIicgK1xuICAgICAgICAob3B0cy5kZWNvZGVFbnRpdGllc1xuICAgICAgICAgID8gZW50aXRpZXMuZW5jb2RlWE1MKHZhbHVlKVxuICAgICAgICAgIDogdmFsdWUucmVwbGFjZSgvXFxcIi9nLCAnJnF1b3Q7JykpICtcbiAgICAgICAgJ1wiJztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufVxuXG4vKlxuICBTZWxmLWVuY2xvc2luZyB0YWdzIChzdG9sZW4gZnJvbSBub2RlLWh0bWxwYXJzZXIpXG4qL1xudmFyIHNpbmdsZVRhZyA9IHtcbiAgX19wcm90b19fOiBudWxsLFxuICBhcmVhOiB0cnVlLFxuICBiYXNlOiB0cnVlLFxuICBiYXNlZm9udDogdHJ1ZSxcbiAgYnI6IHRydWUsXG4gIGNvbDogdHJ1ZSxcbiAgY29tbWFuZDogdHJ1ZSxcbiAgZW1iZWQ6IHRydWUsXG4gIGZyYW1lOiB0cnVlLFxuICBocjogdHJ1ZSxcbiAgaW1nOiB0cnVlLFxuICBpbnB1dDogdHJ1ZSxcbiAgaXNpbmRleDogdHJ1ZSxcbiAga2V5Z2VuOiB0cnVlLFxuICBsaW5rOiB0cnVlLFxuICBtZXRhOiB0cnVlLFxuICBwYXJhbTogdHJ1ZSxcbiAgc291cmNlOiB0cnVlLFxuICB0cmFjazogdHJ1ZSxcbiAgd2JyOiB0cnVlXG59O1xuXG52YXIgcmVuZGVyID0gKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZG9tLCBvcHRzKSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShkb20pICYmICFkb20uY2hlZXJpbykgZG9tID0gW2RvbV07XG4gIG9wdHMgPSBvcHRzIHx8IHt9O1xuXG4gIHZhciBvdXRwdXQgPSAnJztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGRvbS5sZW5ndGg7IGkrKykge1xuICAgIHZhciBlbGVtID0gZG9tW2ldO1xuXG4gICAgaWYgKGVsZW0udHlwZSA9PT0gJ3Jvb3QnKSBvdXRwdXQgKz0gcmVuZGVyKGVsZW0uY2hpbGRyZW4sIG9wdHMpO1xuICAgIGVsc2UgaWYgKEVsZW1lbnRUeXBlLmlzVGFnKGVsZW0pKSBvdXRwdXQgKz0gcmVuZGVyVGFnKGVsZW0sIG9wdHMpO1xuICAgIGVsc2UgaWYgKGVsZW0udHlwZSA9PT0gRWxlbWVudFR5cGUuRGlyZWN0aXZlKVxuICAgICAgb3V0cHV0ICs9IHJlbmRlckRpcmVjdGl2ZShlbGVtKTtcbiAgICBlbHNlIGlmIChlbGVtLnR5cGUgPT09IEVsZW1lbnRUeXBlLkNvbW1lbnQpIG91dHB1dCArPSByZW5kZXJDb21tZW50KGVsZW0pO1xuICAgIGVsc2UgaWYgKGVsZW0udHlwZSA9PT0gRWxlbWVudFR5cGUuQ0RBVEEpIG91dHB1dCArPSByZW5kZXJDZGF0YShlbGVtKTtcbiAgICBlbHNlIG91dHB1dCArPSByZW5kZXJUZXh0KGVsZW0sIG9wdHMpO1xuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn0pO1xuXG52YXIgZm9yZWlnbk1vZGVJbnRlZ3JhdGlvblBvaW50cyA9IFtcbiAgJ21pJyxcbiAgJ21vJyxcbiAgJ21uJyxcbiAgJ21zJyxcbiAgJ210ZXh0JyxcbiAgJ2Fubm90YXRpb24teG1sJyxcbiAgJ2ZvcmVpZ25PYmplY3QnLFxuICAnZGVzYycsXG4gICd0aXRsZSdcbl07XG5cbmZ1bmN0aW9uIHJlbmRlclRhZyhlbGVtLCBvcHRzKSB7XG4gIC8vIEhhbmRsZSBTVkcgLyBNYXRoTUwgaW4gSFRNTFxuICBpZiAob3B0cy54bWxNb2RlID09PSAnZm9yZWlnbicpIHtcbiAgICAvKiBmaXggdXAgbWl4ZWQtY2FzZSBlbGVtZW50IG5hbWVzICovXG4gICAgZWxlbS5uYW1lID0gZm9yZWlnbk5hbWVzLmVsZW1lbnROYW1lc1tlbGVtLm5hbWVdIHx8IGVsZW0ubmFtZTtcbiAgICAvKiBleGl0IGZvcmVpZ24gbW9kZSBhdCBpbnRlZ3JhdGlvbiBwb2ludHMgKi9cbiAgICBpZiAoXG4gICAgICBlbGVtLnBhcmVudCAmJlxuICAgICAgZm9yZWlnbk1vZGVJbnRlZ3JhdGlvblBvaW50cy5pbmRleE9mKGVsZW0ucGFyZW50Lm5hbWUpID49IDBcbiAgICApXG4gICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0cywgeyB4bWxNb2RlOiBmYWxzZSB9KTtcbiAgfVxuICBpZiAoIW9wdHMueG1sTW9kZSAmJiBbJ3N2ZycsICdtYXRoJ10uaW5kZXhPZihlbGVtLm5hbWUpID49IDApIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0cywgeyB4bWxNb2RlOiAnZm9yZWlnbicgfSk7XG4gIH1cblxuICB2YXIgdGFnID0gJzwnICsgZWxlbS5uYW1lO1xuICB2YXIgYXR0cmlicyA9IGZvcm1hdEF0dHJzKGVsZW0uYXR0cmlicywgb3B0cyk7XG5cbiAgaWYgKGF0dHJpYnMpIHtcbiAgICB0YWcgKz0gJyAnICsgYXR0cmlicztcbiAgfVxuXG4gIGlmIChvcHRzLnhtbE1vZGUgJiYgKCFlbGVtLmNoaWxkcmVuIHx8IGVsZW0uY2hpbGRyZW4ubGVuZ3RoID09PSAwKSkge1xuICAgIHRhZyArPSAnLz4nO1xuICB9IGVsc2Uge1xuICAgIHRhZyArPSAnPic7XG4gICAgaWYgKGVsZW0uY2hpbGRyZW4pIHtcbiAgICAgIHRhZyArPSByZW5kZXIoZWxlbS5jaGlsZHJlbiwgb3B0cyk7XG4gICAgfVxuXG4gICAgaWYgKCFzaW5nbGVUYWdbZWxlbS5uYW1lXSB8fCBvcHRzLnhtbE1vZGUpIHtcbiAgICAgIHRhZyArPSAnPC8nICsgZWxlbS5uYW1lICsgJz4nO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YWc7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckRpcmVjdGl2ZShlbGVtKSB7XG4gIHJldHVybiAnPCcgKyBlbGVtLmRhdGEgKyAnPic7XG59XG5cbmZ1bmN0aW9uIHJlbmRlclRleHQoZWxlbSwgb3B0cykge1xuICB2YXIgZGF0YSA9IGVsZW0uZGF0YSB8fCAnJztcblxuICAvLyBpZiBlbnRpdGllcyB3ZXJlbid0IGRlY29kZWQsIG5vIG5lZWQgdG8gZW5jb2RlIHRoZW0gYmFja1xuICBpZiAoXG4gICAgb3B0cy5kZWNvZGVFbnRpdGllcyAmJlxuICAgICEoZWxlbS5wYXJlbnQgJiYgZWxlbS5wYXJlbnQubmFtZSBpbiB1bmVuY29kZWRFbGVtZW50cylcbiAgKSB7XG4gICAgZGF0YSA9IGVudGl0aWVzLmVuY29kZVhNTChkYXRhKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDZGF0YShlbGVtKSB7XG4gIHJldHVybiAnPCFbQ0RBVEFbJyArIGVsZW0uY2hpbGRyZW5bMF0uZGF0YSArICddXT4nO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDb21tZW50KGVsZW0pIHtcbiAgcmV0dXJuICc8IS0tJyArIGVsZW0uZGF0YSArICctLT4nO1xufVxuIl19