08d3afc9d2c462d7ae8aaba0b7dcc504
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _omitBy = _interopRequireDefault(require("lodash/omitBy"));

var _isNil = _interopRequireDefault(require("lodash/isNil"));

var _reactIs = require("react-is");

var _RSTTraversal = require("enzyme/build/RSTTraversal");

var _utils = require("./utils");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getChildren(node, options) {
  var children = (0, _utils.compact)((0, _RSTTraversal.childrenOfNode)(node).map(function (n) {
    return internalNodeToJson(n, options);
  }));

  if (children.length > 0) {
    return children;
  }

  return null;
}

function getProps(node, options) {
  var props = (0, _omitBy.default)((0, _extends2.default)({}, (0, _RSTTraversal.propsOfNode)(node)), function (val, key) {
    if (key === 'children' || val === undefined) {
      return true;
    }

    if (options.ignoreDefaultProps === true && (0, _reactIs.isValidElementType)(node.type) && node.type.defaultProps && key in node.type.defaultProps && node.type.defaultProps[key] === val) {
      return true;
    }
  });

  if (!(0, _isNil.default)(node.key) && options.noKey !== true) {
    props.key = node.key;
  }

  return props;
}

function internalNodeToJson(node, options) {
  if (typeof node === 'string' || typeof node === 'number') {
    return node;
  }

  if ((0, _isNil.default)(node) || node === false) {
    return '';
  }

  var json = (0, _utils.applyMap)({
    node: node,
    type: (0, _utils.extractTypeName)(node),
    props: getProps(node, options),
    children: getChildren(node, options),
    $$typeof: Symbol.for('react.test.json')
  }, options);

  if (!(0, _isNil.default)(json) && !(0, _isNil.default)(json.type)) {
    return json;
  }
}

var shallowToJson = function shallowToJson(wrapper) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if ((0, _isNil.default)(wrapper) || wrapper.length === 0) {
    return null;
  }

  if (wrapper.length > 1 && typeof wrapper.getNodesInternal === 'function') {
    var nodes = wrapper.getNodesInternal();
    return nodes.map(function (node) {
      return internalNodeToJson(node, options);
    });
  }

  if (typeof wrapper.getNodeInternal === 'function') {
    var node = wrapper.getNodeInternal();
    return internalNodeToJson(node, options);
  }

  return null;
};

var _default = shallowToJson;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNoYWxsb3cuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwiX29taXRCeSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2lzTmlsIiwiX3JlYWN0SXMiLCJfUlNUVHJhdmVyc2FsIiwiX3V0aWxzIiwib2JqIiwiX19lc01vZHVsZSIsImdldENoaWxkcmVuIiwibm9kZSIsIm9wdGlvbnMiLCJjaGlsZHJlbiIsImNvbXBhY3QiLCJjaGlsZHJlbk9mTm9kZSIsIm1hcCIsIm4iLCJpbnRlcm5hbE5vZGVUb0pzb24iLCJsZW5ndGgiLCJnZXRQcm9wcyIsInByb3BzIiwicHJvcHNPZk5vZGUiLCJ2YWwiLCJrZXkiLCJ1bmRlZmluZWQiLCJpZ25vcmVEZWZhdWx0UHJvcHMiLCJpc1ZhbGlkRWxlbWVudFR5cGUiLCJ0eXBlIiwiZGVmYXVsdFByb3BzIiwibm9LZXkiLCJqc29uIiwiYXBwbHlNYXAiLCJleHRyYWN0VHlwZU5hbWUiLCIkJHR5cGVvZiIsIlN5bWJvbCIsImZvciIsInNoYWxsb3dUb0pzb24iLCJ3cmFwcGVyIiwiZ2V0Tm9kZXNJbnRlcm5hbCIsIm5vZGVzIiwiZ2V0Tm9kZUludGVybmFsIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLE9BQU8sR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxlQUFELENBQVIsQ0FBcEM7O0FBRUEsSUFBSUMsTUFBTSxHQUFHRixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLGNBQUQsQ0FBUixDQUFuQzs7QUFFQSxJQUFJRSxRQUFRLEdBQUdGLE9BQU8sQ0FBQyxV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TyxJQUFQO0FBQ0QsQ0FoQkQ7O0FBa0JBLElBQUk4QixRQUFRLEdBQUdMLGFBQWY7QUFDQXZDLE9BQU8sQ0FBQ0UsT0FBUixHQUFrQjBDLFFBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfb21pdEJ5ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwibG9kYXNoL29taXRCeVwiKSk7XG5cbnZhciBfaXNOaWwgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJsb2Rhc2gvaXNOaWxcIikpO1xuXG52YXIgX3JlYWN0SXMgPSByZXF1aXJlKFwicmVhY3QtaXNcIik7XG5cbnZhciBfUlNUVHJhdmVyc2FsID0gcmVxdWlyZShcImVuenltZS9idWlsZC9SU1RUcmF2ZXJzYWxcIik7XG5cbnZhciBfdXRpbHMgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gZ2V0Q2hpbGRyZW4obm9kZSwgb3B0aW9ucykge1xuICBjb25zdCBjaGlsZHJlbiA9ICgwLCBfdXRpbHMuY29tcGFjdCkoKDAsIF9SU1RUcmF2ZXJzYWwuY2hpbGRyZW5PZk5vZGUpKG5vZGUpLm1hcChuID0+IGludGVybmFsTm9kZVRvSnNvbihuLCBvcHRpb25zKSkpO1xuXG4gIGlmIChjaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGdldFByb3BzKG5vZGUsIG9wdGlvbnMpIHtcbiAgY29uc3QgcHJvcHMgPSAoMCwgX29taXRCeS5kZWZhdWx0KShPYmplY3QuYXNzaWduKHt9LCAoMCwgX1JTVFRyYXZlcnNhbC5wcm9wc09mTm9kZSkobm9kZSkpLCAodmFsLCBrZXkpID0+IHtcbiAgICBpZiAoa2V5ID09PSAnY2hpbGRyZW4nIHx8IHZhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5pZ25vcmVEZWZhdWx0UHJvcHMgPT09IHRydWUgJiYgKDAsIF9yZWFjdElzLmlzVmFsaWRFbGVtZW50VHlwZSkobm9kZS50eXBlKSAmJiBub2RlLnR5cGUuZGVmYXVsdFByb3BzICYmIGtleSBpbiBub2RlLnR5cGUuZGVmYXVsdFByb3BzICYmIG5vZGUudHlwZS5kZWZhdWx0UHJvcHNba2V5XSA9PT0gdmFsKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmICghKDAsIF9pc05pbC5kZWZhdWx0KShub2RlLmtleSkgJiYgb3B0aW9ucy5ub0tleSAhPT0gdHJ1ZSkge1xuICAgIHByb3BzLmtleSA9IG5vZGUua2V5O1xuICB9XG5cbiAgcmV0dXJuIHByb3BzO1xufVxuXG5mdW5jdGlvbiBpbnRlcm5hbE5vZGVUb0pzb24obm9kZSwgb3B0aW9ucykge1xuICBpZiAodHlwZW9mIG5vZGUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBub2RlID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgaWYgKCgwLCBfaXNOaWwuZGVmYXVsdCkobm9kZSkgfHwgbm9kZSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBjb25zdCBqc29uID0gKDAsIF91dGlscy5hcHBseU1hcCkoe1xuICAgIG5vZGUsXG4gICAgdHlwZTogKDAsIF91dGlscy5leHRyYWN0VHlwZU5hbWUpKG5vZGUpLFxuICAgIHByb3BzOiBnZXRQcm9wcyhub2RlLCBvcHRpb25zKSxcbiAgICBjaGlsZHJlbjogZ2V0Q2hpbGRyZW4obm9kZSwgb3B0aW9ucyksXG4gICAgJCR0eXBlb2Y6IFN5bWJvbC5mb3IoJ3JlYWN0LnRlc3QuanNvbicpXG4gIH0sIG9wdGlvbnMpO1xuXG4gIGlmICghKDAsIF9pc05pbC5kZWZhdWx0KShqc29uKSAmJiAhKDAsIF9pc05pbC5kZWZhdWx0KShqc29uLnR5cGUpKSB7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cbn1cblxuY29uc3Qgc2hhbGxvd1RvSnNvbiA9ICh3cmFwcGVyLCBvcHRpb25zID0ge30pID0+IHtcbiAgaWYgKCgwLCBfaXNOaWwuZGVmYXVsdCkod3JhcHBlcikgfHwgd3JhcHBlci5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICh3cmFwcGVyLmxlbmd0aCA+IDEgJiYgdHlwZW9mIHdyYXBwZXIuZ2V0Tm9kZXNJbnRlcm5hbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbnN0IG5vZGVzID0gd3JhcHBlci5nZXROb2Rlc0ludGVybmFsKCk7XG4gICAgcmV0dXJuIG5vZGVzLm1hcChub2RlID0+IGludGVybmFsTm9kZVRvSnNvbihub2RlLCBvcHRpb25zKSk7XG4gIH1cblxuICBpZiAodHlwZW9mIHdyYXBwZXIuZ2V0Tm9kZUludGVybmFsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY29uc3Qgbm9kZSA9IHdyYXBwZXIuZ2V0Tm9kZUludGVybmFsKCk7XG4gICAgcmV0dXJuIGludGVybmFsTm9kZVRvSnNvbihub2RlLCBvcHRpb25zKTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxudmFyIF9kZWZhdWx0ID0gc2hhbGxvd1RvSnNvbjtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0OyJdfQ==