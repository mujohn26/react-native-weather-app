2fd1066f024778d33baecf441bfbe3ba
'use strict';

var doctype = require("../common/doctype"),
    DOCUMENT_MODE = require("../common/html").DOCUMENT_MODE;

var nodeTypes = {
  element: 1,
  text: 3,
  cdata: 4,
  comment: 8
};
var nodePropertyShorthands = {
  tagName: 'name',
  childNodes: 'children',
  parentNode: 'parent',
  previousSibling: 'prev',
  nextSibling: 'next',
  nodeValue: 'data'
};

var Node = function Node(props) {
  for (var key in props) {
    if (props.hasOwnProperty(key)) this[key] = props[key];
  }
};

Node.prototype = {
  get firstChild() {
    var children = this.children;
    return children && children[0] || null;
  },

  get lastChild() {
    var children = this.children;
    return children && children[children.length - 1] || null;
  },

  get nodeType() {
    return nodeTypes[this.type] || nodeTypes.element;
  }

};
Object.keys(nodePropertyShorthands).forEach(function (key) {
  var shorthand = nodePropertyShorthands[key];
  Object.defineProperty(Node.prototype, key, {
    get: function get() {
      return this[shorthand] || null;
    },
    set: function set(val) {
      this[shorthand] = val;
      return val;
    }
  });
});

exports.createDocument = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: [],
    'x-mode': DOCUMENT_MODE.NO_QUIRKS
  });
};

exports.createDocumentFragment = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: []
  });
};

exports.createElement = function (tagName, namespaceURI, attrs) {
  var attribs = Object.create(null),
      attribsNamespace = Object.create(null),
      attribsPrefix = Object.create(null);

  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;
    attribs[attrName] = attrs[i].value;
    attribsNamespace[attrName] = attrs[i].namespace;
    attribsPrefix[attrName] = attrs[i].prefix;
  }

  return new Node({
    type: tagName === 'script' || tagName === 'style' ? tagName : 'tag',
    name: tagName,
    namespace: namespaceURI,
    attribs: attribs,
    'x-attribsNamespace': attribsNamespace,
    'x-attribsPrefix': attribsPrefix,
    children: [],
    parent: null,
    prev: null,
    next: null
  });
};

exports.createCommentNode = function (data) {
  return new Node({
    type: 'comment',
    data: data,
    parent: null,
    prev: null,
    next: null
  });
};

var createTextNode = function createTextNode(value) {
  return new Node({
    type: 'text',
    data: value,
    parent: null,
    prev: null,
    next: null
  });
};

var appendChild = exports.appendChild = function (parentNode, newNode) {
  var prev = parentNode.children[parentNode.children.length - 1];

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  parentNode.children.push(newNode);
  newNode.parent = parentNode;
};

var insertBefore = exports.insertBefore = function (parentNode, newNode, referenceNode) {
  var insertionIdx = parentNode.children.indexOf(referenceNode),
      prev = referenceNode.prev;

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  referenceNode.prev = newNode;
  newNode.next = referenceNode;
  parentNode.children.splice(insertionIdx, 0, newNode);
  newNode.parent = parentNode;
};

exports.setTemplateContent = function (templateElement, contentElement) {
  appendChild(templateElement, contentElement);
};

exports.getTemplateContent = function (templateElement) {
  return templateElement.children[0];
};

exports.setDocumentType = function (document, name, publicId, systemId) {
  var data = doctype.serializeContent(name, publicId, systemId),
      doctypeNode = null;

  for (var i = 0; i < document.children.length; i++) {
    if (document.children[i].type === 'directive' && document.children[i].name === '!doctype') {
      doctypeNode = document.children[i];
      break;
    }
  }

  if (doctypeNode) {
    doctypeNode.data = data;
    doctypeNode['x-name'] = name;
    doctypeNode['x-publicId'] = publicId;
    doctypeNode['x-systemId'] = systemId;
  } else {
    appendChild(document, new Node({
      type: 'directive',
      name: '!doctype',
      data: data,
      'x-name': name,
      'x-publicId': publicId,
      'x-systemId': systemId
    }));
  }
};

exports.setDocumentMode = function (document, mode) {
  document['x-mode'] = mode;
};

exports.getDocumentMode = function (document) {
  return document['x-mode'];
};

exports.detachNode = function (node) {
  if (node.parent) {
    var idx = node.parent.children.indexOf(node),
        prev = node.prev,
        next = node.next;
    node.prev = null;
    node.next = null;
    if (prev) prev.next = next;
    if (next) next.prev = prev;
    node.parent.children.splice(idx, 1);
    node.parent = null;
  }
};

exports.insertText = function (parentNode, text) {
  var lastChild = parentNode.children[parentNode.children.length - 1];
  if (lastChild && lastChild.type === 'text') lastChild.data += text;else appendChild(parentNode, createTextNode(text));
};

exports.insertTextBefore = function (parentNode, text, referenceNode) {
  var prevNode = parentNode.children[parentNode.children.indexOf(referenceNode) - 1];
  if (prevNode && prevNode.type === 'text') prevNode.data += text;else insertBefore(parentNode, createTextNode(text), referenceNode);
};

exports.adoptAttributes = function (recipient, attrs) {
  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;

    if (typeof recipient.attribs[attrName] === 'undefined') {
      recipient.attribs[attrName] = attrs[i].value;
      recipient['x-attribsNamespace'][attrName] = attrs[i].namespace;
      recipient['x-attribsPrefix'][attrName] = attrs[i].prefix;
    }
  }
};

exports.getFirstChild = function (node) {
  return node.children[0];
};

exports.getChildNodes = function (node) {
  return node.children;
};

exports.getParentNode = function (node) {
  return node.parent;
};

exports.getAttrList = function (element) {
  var attrList = [];

  for (var name in element.attribs) {
    attrList.push({
      name: name,
      value: element.attribs[name],
      namespace: element['x-attribsNamespace'][name],
      prefix: element['x-attribsPrefix'][name]
    });
  }

  return attrList;
};

exports.getTagName = function (element) {
  return element.name;
};

exports.getNamespaceURI = function (element) {
  return element.namespace;
};

exports.getTextNodeContent = function (textNode) {
  return textNode.data;
};

exports.getCommentNodeContent = function (commentNode) {
  return commentNode.data;
};

exports.getDocumentTypeNodeName = function (doctypeNode) {
  return doctypeNode['x-name'];
};

exports.getDocumentTypeNodePublicId = function (doctypeNode) {
  return doctypeNode['x-publicId'];
};

exports.getDocumentTypeNodeSystemId = function (doctypeNode) {
  return doctypeNode['x-systemId'];
};

exports.isTextNode = function (node) {
  return node.type === 'text';
};

exports.isCommentNode = function (node) {
  return node.type === 'comment';
};

exports.isDocumentTypeNode = function (node) {
  return node.type === 'directive' && node.name === '!doctype';
};

exports.isElementNode = function (node) {
  return !!node.attribs;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxwYXJzZXIyLmpzIl0sIm5hbWVzIjpbImRvY3R5cGUiLCJyZXF1aXJlIiwiRE9DVU1FTlRfTU9ERSIsIm5vZGVUeXBlcyIsImVsZW1lbnQiLCJ0ZXh0IiwiY2RhdGEiLCJjb21tZW50Iiwibm9kZVByb3BlcnR5U2hvcnRoYW5kcyIsInRhZ05hbWUiLCJjaGlsZE5vZGVzIiwicGFyZW50Tm9kZSIsInByZXZpb3VzU2libGluZyIsIm5leHRTaWJsaW5nIiwibm9kZVZhbHVlIiwiTm9kZSIsInByb3BzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJwcm90b3R5cGUiLCJmaXJzdENoaWxkIiwiY2hpbGRyZW4iLCJsYXN0Q2hpbGQiLCJsZW5ndGgiLCJub2RlVHlwZSIsInR5cGUiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInNob3J0aGFuZCIsImRlZmluZVByb3BlcnR5IiwiZ2V0Iiwic2V0IiwidmFsIiwiZXhwb3J0cyIsImNyZWF0ZURvY3VtZW50IiwibmFtZSIsInBhcmVudCIsInByZXYiLCJuZXh0IiwiTk9fUVVJUktTIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJuYW1lc3BhY2VVUkkiLCJhdHRycyIsImF0dHJpYnMiLCJjcmVhdGUiLCJhdHRyaWJzTmFtZXNwYWNlIiwiYXR0cmlic1ByZWZpeCIsImkiLCJhdHRyTmFtZSIsInZhbHVlIiwibmFtZXNwYWNlIiwicHJlZml4IiwiY3JlYXRlQ29tbWVudE5vZGUiLCJkYXRhIiwiY3JlYXRlVGV4dE5vZGUiLCJhcHBlbmRDaGlsZCIsIm5ld05vZGUiLCJwdXNoIiwiaW5zZXJ0QmVmb3JlIiwicmVmZXJlbmNlTm9kZSIsImluc2VydGlvbklkeCIsImluZGV4T2YiLCJzcGxpY2UiLCJzZXRUZW1wbGF0ZUNvbnRlbnQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJjb250ZW50RWxlbWVudCIsImdldFRlbXBsYXRlQ29udGVudCIsInNldERvY3VtZW50VHlwZSIsImRvY3VtZW50IiwicHVibGljSWQiLCJzeXN0ZW1JZCIsInNlcmlhbGl6ZUNvbnRlbnQiLCJkb2N0eXBlTm9kZSIsInNldERvY3VtZW50TW9kZSIsIm1vZGUiLCJnZXREb2N1bWVudE1vZGUiLCJkZXRhY2hOb2RlIiwibm9kZSIsImlkeCIsImluc2VydFRleHQiLCJpbnNlcnRUZXh0QmVmb3JlIiwicHJldk5vZGUiLCJhZG9wdEF0dHJpYnV0ZXMiLCJyZWNpcGllbnQiLCJnZXRGaXJzdENoaWxkIiwiZ2V0Q2hpbGROb2RlcyIsImdldFBhcmVudE5vZGUiLCJnZXRBdHRyTGlzdCIsImF0dHJMaXN0IiwiZ2V0VGFnTmFtZSIsImdldE5hbWVzcGFjZVVSSSIsImdldFRleHROb2RlQ29udGVudCIsInRleHROb2RlIiwiZ2V0Q29tbWVudE5vZGVDb250ZW50IiwiY29tbWVudE5vZGUiLCJnZXREb2N1bWVudFR5cGVOb2RlTmFtZSIsImdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZCIsImdldERvY3VtZW50VHlwZU5vZGVTeXN0ZW1JZCIsImlzVGV4dE5vZGUiLCJpc0NvbW1lbnROb2RlIiwiaXNEb2N1bWVudFR5cGVOb2RlIiwiaXNFbGVtZW50Tm9kZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsT0FBTyxHQUFHQyxPQUFPLHFCQUFyQjtBQUFBLElBQ0lDLGFBQWEsR0FBR0QsT0FBTyxrQkFBUCxDQUEwQkMsYUFEOUM7O0FBS0EsSUFBSUMsU0FBUyxHQUFHO0FBQ1pDLEVBQUFBLE9BQU8sRUFBRSxDQURHO0FBRVpDLEVBQUFBLElBQUksRUFBRSxDQUZNO0FBR1pDLEVBQUFBLEtBQUssRUFBRSxDQUhLO0FBSVpDLEVBQUFBLE9BQU8sRUFBRTtBQUpHLENBQWhCO0FBT0EsSUFBSUMsc0JBQXNCLEdBQUc7QUFDekJDLEVBQUFBLE9BQU8sRUFBRSxNQURnQjtBQUV6QkMsRUFBQUEsVUFBVSxFQUFFLFVBRmE7QUFHekJDLEVBQUFBLFVBQVUsRUFBRSxRQUhhO0FBSXpCQyxFQUFBQSxlQUFlLEVBQUUsTUFKUTtBQUt6QkMsRUFBQUEsV0FBVyxFQUFFLE1BTFk7QUFNekJDLEVBQUFBLFNBQVMsRUFBRTtBQU5jLENBQTdCOztBQVVBLElBQUlDLElBQUksR0FBRyxTQUFQQSxJQUFPLENBQVVDLEtBQVYsRUFBaUI7QUFDeEIsT0FBSyxJQUFJQyxHQUFULElBQWdCRCxLQUFoQixFQUF1QjtBQUNuQixRQUFJQSxLQUFLLENBQUNFLGNBQU4sQ0FBcUJELEdBQXJCLENBQUosRUFDSSxLQUFLQSxHQUFMLElBQVlELEtBQUssQ0FBQ0MsR0FBRCxDQUFqQjtBQUNQO0FBQ0osQ0FMRDs7QUFPQUYsSUFBSSxDQUFDSSxTQUFMLEdBQWlCO0FBQ2IsTUFBSUMsVUFBSixHQUFpQjtBQUNiLFFBQUlDLFFBQVEsR0FBRyxLQUFLQSxRQUFwQjtBQUVBLFdBQU9BLFFBQVEsSUFBSUEsUUFBUSxDQUFDLENBQUQsQ0FBcEIsSUFBMkIsSUFBbEM7QUFDSCxHQUxZOztBQU9iLE1BQUlDLFNBQUosR0FBZ0I7QUFDWixRQUFJRCxRQUFRLEdBQUcsS0FBS0EsUUFBcEI7QUFFQSxXQUFPQSxRQUFRLElBQUlBLFFBQVEsQ0FBQ0EsUUFBUSxDQUFDRSxNQUFULEdBQWtCLENBQW5CLENBQXBCLElBQTZDLElBQXBEO0FBQ0gsR0FYWTs7QUFhYixNQUFJQyxRQUFKLEdBQWU7QUFDWCxXQUFPckIsU0FBUyxDQUFDLEtBQUtzQixJQUFOLENBQVQsSUFBd0J0QixTQUFTLENBQUNDLE9BQXpDO0FBQ0g7O0FBZlksQ0FBakI7QUFrQkFzQixNQUFNLENBQUNDLElBQVAsQ0FBWW5CLHNCQUFaLEVBQW9Db0IsT0FBcEMsQ0FBNEMsVUFBVVgsR0FBVixFQUFlO0FBQ3ZELE1BQUlZLFNBQVMsR0FBR3JCLHNCQUFzQixDQUFDUyxHQUFELENBQXRDO0FBRUFTLEVBQUFBLE1BQU0sQ0FBQ0ksY0FBUCxDQUFzQmYsSUFBSSxDQUFDSSxTQUEzQixFQUFzQ0YsR0FBdEMsRUFBMkM7QUFDdkNjLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsYUFBTyxLQUFLRixTQUFMLEtBQW1CLElBQTFCO0FBQ0gsS0FIc0M7QUFJdkNHLElBQUFBLEdBQUcsRUFBRSxhQUFVQyxHQUFWLEVBQWU7QUFDaEIsV0FBS0osU0FBTCxJQUFrQkksR0FBbEI7QUFDQSxhQUFPQSxHQUFQO0FBQ0g7QUFQc0MsR0FBM0M7QUFTSCxDQVpEOztBQWdCQUMsT0FBTyxDQUFDQyxjQUFSLEdBQXlCLFlBQVk7QUFDakMsU0FBTyxJQUFJcEIsSUFBSixDQUFTO0FBQ1pVLElBQUFBLElBQUksRUFBRSxNQURNO0FBRVpXLElBQUFBLElBQUksRUFBRSxNQUZNO0FBR1pDLElBQUFBLE1BQU0sRUFBRSxJQUhJO0FBSVpDLElBQUFBLElBQUksRUFBRSxJQUpNO0FBS1pDLElBQUFBLElBQUksRUFBRSxJQUxNO0FBTVpsQixJQUFBQSxRQUFRLEVBQUUsRUFORTtBQU9aLGNBQVVuQixhQUFhLENBQUNzQztBQVBaLEdBQVQsQ0FBUDtBQVNILENBVkQ7O0FBWUFOLE9BQU8sQ0FBQ08sc0JBQVIsR0FBaUMsWUFBWTtBQUN6QyxTQUFPLElBQUkxQixJQUFKLENBQVM7QUFDWlUsSUFBQUEsSUFBSSxFQUFFLE1BRE07QUFFWlcsSUFBQUEsSUFBSSxFQUFFLE1BRk07QUFHWkMsSUFBQUEsTUFBTSxFQUFFLElBSEk7QUFJWkMsSUFBQUEsSUFBSSxFQUFFLElBSk07QUFLWkMsSUFBQUEsSUFBSSxFQUFFLElBTE07QUFNWmxCLElBQUFBLFFBQVEsRUFBRTtBQU5FLEdBQVQsQ0FBUDtBQVFILENBVEQ7O0FBV0FhLE9BQU8sQ0FBQ1EsYUFBUixHQUF3QixVQUFVakMsT0FBVixFQUFtQmtDLFlBQW5CLEVBQWlDQyxLQUFqQyxFQUF3QztBQUM1RCxNQUFJQyxPQUFPLEdBQUduQixNQUFNLENBQUNvQixNQUFQLENBQWMsSUFBZCxDQUFkO0FBQUEsTUFDSUMsZ0JBQWdCLEdBQUdyQixNQUFNLENBQUNvQixNQUFQLENBQWMsSUFBZCxDQUR2QjtBQUFBLE1BRUlFLGFBQWEsR0FBR3RCLE1BQU0sQ0FBQ29CLE1BQVAsQ0FBYyxJQUFkLENBRnBCOztBQUlBLE9BQUssSUFBSUcsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0wsS0FBSyxDQUFDckIsTUFBMUIsRUFBa0MwQixDQUFDLEVBQW5DLEVBQXVDO0FBQ25DLFFBQUlDLFFBQVEsR0FBR04sS0FBSyxDQUFDSyxDQUFELENBQUwsQ0FBU2IsSUFBeEI7QUFFQVMsSUFBQUEsT0FBTyxDQUFDSyxRQUFELENBQVAsR0FBb0JOLEtBQUssQ0FBQ0ssQ0FBRCxDQUFMLENBQVNFLEtBQTdCO0FBQ0FKLElBQUFBLGdCQUFnQixDQUFDRyxRQUFELENBQWhCLEdBQTZCTixLQUFLLENBQUNLLENBQUQsQ0FBTCxDQUFTRyxTQUF0QztBQUNBSixJQUFBQSxhQUFhLENBQUNFLFFBQUQsQ0FBYixHQUEwQk4sS0FBSyxDQUFDSyxDQUFELENBQUwsQ0FBU0ksTUFBbkM7QUFDSDs7QUFFRCxTQUFPLElBQUl0QyxJQUFKLENBQVM7QUFDWlUsSUFBQUEsSUFBSSxFQUFFaEIsT0FBTyxLQUFLLFFBQVosSUFBd0JBLE9BQU8sS0FBSyxPQUFwQyxHQUE4Q0EsT0FBOUMsR0FBd0QsS0FEbEQ7QUFFWjJCLElBQUFBLElBQUksRUFBRTNCLE9BRk07QUFHWjJDLElBQUFBLFNBQVMsRUFBRVQsWUFIQztBQUlaRSxJQUFBQSxPQUFPLEVBQUVBLE9BSkc7QUFLWiwwQkFBc0JFLGdCQUxWO0FBTVosdUJBQW1CQyxhQU5QO0FBT1ozQixJQUFBQSxRQUFRLEVBQUUsRUFQRTtBQVFaZ0IsSUFBQUEsTUFBTSxFQUFFLElBUkk7QUFTWkMsSUFBQUEsSUFBSSxFQUFFLElBVE07QUFVWkMsSUFBQUEsSUFBSSxFQUFFO0FBVk0sR0FBVCxDQUFQO0FBWUgsQ0F6QkQ7O0FBMkJBTCxPQUFPLENBQUNvQixpQkFBUixHQUE0QixVQUFVQyxJQUFWLEVBQWdCO0FBQ3hDLFNBQU8sSUFBSXhDLElBQUosQ0FBUztBQUNaVSxJQUFBQSxJQUFJLEVBQUUsU0FETTtBQUVaOEIsSUFBQUEsSUFBSSxFQUFFQSxJQUZNO0FBR1psQixJQUFBQSxNQUFNLEVBQUUsSUFISTtBQUlaQyxJQUFBQSxJQUFJLEVBQUUsSUFKTTtBQUtaQyxJQUFBQSxJQUFJLEVBQUU7QUFMTSxHQUFULENBQVA7QUFPSCxDQVJEOztBQVVBLElBQUlpQixjQUFjLEdBQUcsU0FBakJBLGNBQWlCLENBQVVMLEtBQVYsRUFBaUI7QUFDbEMsU0FBTyxJQUFJcEMsSUFBSixDQUFTO0FBQ1pVLElBQUFBLElBQUksRUFBRSxNQURNO0FBRVo4QixJQUFBQSxJQUFJLEVBQUVKLEtBRk07QUFHWmQsSUFBQUEsTUFBTSxFQUFFLElBSEk7QUFJWkMsSUFBQUEsSUFBSSxFQUFFLElBSk07QUFLWkMsSUFBQUEsSUFBSSxFQUFFO0FBTE0sR0FBVCxDQUFQO0FBT0gsQ0FSRDs7QUFZQSxJQUFJa0IsV0FBVyxHQUFHdkIsT0FBTyxDQUFDdUIsV0FBUixHQUFzQixVQUFVOUMsVUFBVixFQUFzQitDLE9BQXRCLEVBQStCO0FBQ25FLE1BQUlwQixJQUFJLEdBQUczQixVQUFVLENBQUNVLFFBQVgsQ0FBb0JWLFVBQVUsQ0FBQ1UsUUFBWCxDQUFvQkUsTUFBcEIsR0FBNkIsQ0FBakQsQ0FBWDs7QUFFQSxNQUFJZSxJQUFKLEVBQVU7QUFDTkEsSUFBQUEsSUFBSSxDQUFDQyxJQUFMLEdBQVltQixPQUFaO0FBQ0FBLElBQUFBLE9BQU8sQ0FBQ3BCLElBQVIsR0FBZUEsSUFBZjtBQUNIOztBQUVEM0IsRUFBQUEsVUFBVSxDQUFDVSxRQUFYLENBQW9Cc0MsSUFBcEIsQ0FBeUJELE9BQXpCO0FBQ0FBLEVBQUFBLE9BQU8sQ0FBQ3JCLE1BQVIsR0FBaUIxQixVQUFqQjtBQUNILENBVkQ7O0FBWUEsSUFBSWlELFlBQVksR0FBRzFCLE9BQU8sQ0FBQzBCLFlBQVIsR0FBdUIsVUFBVWpELFVBQVYsRUFBc0IrQyxPQUF0QixFQUErQkcsYUFBL0IsRUFBOEM7QUFDcEYsTUFBSUMsWUFBWSxHQUFHbkQsVUFBVSxDQUFDVSxRQUFYLENBQW9CMEMsT0FBcEIsQ0FBNEJGLGFBQTVCLENBQW5CO0FBQUEsTUFDSXZCLElBQUksR0FBR3VCLGFBQWEsQ0FBQ3ZCLElBRHpCOztBQUdBLE1BQUlBLElBQUosRUFBVTtBQUNOQSxJQUFBQSxJQUFJLENBQUNDLElBQUwsR0FBWW1CLE9BQVo7QUFDQUEsSUFBQUEsT0FBTyxDQUFDcEIsSUFBUixHQUFlQSxJQUFmO0FBQ0g7O0FBRUR1QixFQUFBQSxhQUFhLENBQUN2QixJQUFkLEdBQXFCb0IsT0FBckI7QUFDQUEsRUFBQUEsT0FBTyxDQUFDbkIsSUFBUixHQUFlc0IsYUFBZjtBQUVBbEQsRUFBQUEsVUFBVSxDQUFDVSxRQUFYLENBQW9CMkMsTUFBcEIsQ0FBMkJGLFlBQTNCLEVBQXlDLENBQXpDLEVBQTRDSixPQUE1QztBQUNBQSxFQUFBQSxPQUFPLENBQUNyQixNQUFSLEdBQWlCMUIsVUFBakI7QUFDSCxDQWREOztBQWdCQXVCLE9BQU8sQ0FBQytCLGtCQUFSLEdBQTZCLFVBQVVDLGVBQVYsRUFBMkJDLGNBQTNCLEVBQTJDO0FBQ3BFVixFQUFBQSxXQUFXLENBQUNTLGVBQUQsRUFBa0JDLGNBQWxCLENBQVg7QUFDSCxDQUZEOztBQUlBakMsT0FBTyxDQUFDa0Msa0JBQVIsR0FBNkIsVUFBVUYsZUFBVixFQUEyQjtBQUNwRCxTQUFPQSxlQUFlLENBQUM3QyxRQUFoQixDQUF5QixDQUF6QixDQUFQO0FBQ0gsQ0FGRDs7QUFJQWEsT0FBTyxDQUFDbUMsZUFBUixHQUEwQixVQUFVQyxRQUFWLEVBQW9CbEMsSUFBcEIsRUFBMEJtQyxRQUExQixFQUFvQ0MsUUFBcEMsRUFBOEM7QUFDcEUsTUFBSWpCLElBQUksR0FBR3ZELE9BQU8sQ0FBQ3lFLGdCQUFSLENBQXlCckMsSUFBekIsRUFBK0JtQyxRQUEvQixFQUF5Q0MsUUFBekMsQ0FBWDtBQUFBLE1BQ0lFLFdBQVcsR0FBRyxJQURsQjs7QUFHQSxPQUFLLElBQUl6QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHcUIsUUFBUSxDQUFDakQsUUFBVCxDQUFrQkUsTUFBdEMsRUFBOEMwQixDQUFDLEVBQS9DLEVBQW1EO0FBQy9DLFFBQUlxQixRQUFRLENBQUNqRCxRQUFULENBQWtCNEIsQ0FBbEIsRUFBcUJ4QixJQUFyQixLQUE4QixXQUE5QixJQUE2QzZDLFFBQVEsQ0FBQ2pELFFBQVQsQ0FBa0I0QixDQUFsQixFQUFxQmIsSUFBckIsS0FBOEIsVUFBL0UsRUFBMkY7QUFDdkZzQyxNQUFBQSxXQUFXLEdBQUdKLFFBQVEsQ0FBQ2pELFFBQVQsQ0FBa0I0QixDQUFsQixDQUFkO0FBQ0E7QUFDSDtBQUNKOztBQUVELE1BQUl5QixXQUFKLEVBQWlCO0FBQ2JBLElBQUFBLFdBQVcsQ0FBQ25CLElBQVosR0FBbUJBLElBQW5CO0FBQ0FtQixJQUFBQSxXQUFXLENBQUMsUUFBRCxDQUFYLEdBQXdCdEMsSUFBeEI7QUFDQXNDLElBQUFBLFdBQVcsQ0FBQyxZQUFELENBQVgsR0FBNEJILFFBQTVCO0FBQ0FHLElBQUFBLFdBQVcsQ0FBQyxZQUFELENBQVgsR0FBNEJGLFFBQTVCO0FBQ0gsR0FMRCxNQU9LO0FBQ0RmLElBQUFBLFdBQVcsQ0FBQ2EsUUFBRCxFQUFXLElBQUl2RCxJQUFKLENBQVM7QUFDM0JVLE1BQUFBLElBQUksRUFBRSxXQURxQjtBQUUzQlcsTUFBQUEsSUFBSSxFQUFFLFVBRnFCO0FBRzNCbUIsTUFBQUEsSUFBSSxFQUFFQSxJQUhxQjtBQUkzQixnQkFBVW5CLElBSmlCO0FBSzNCLG9CQUFjbUMsUUFMYTtBQU0zQixvQkFBY0M7QUFOYSxLQUFULENBQVgsQ0FBWDtBQVFIO0FBRUosQ0E3QkQ7O0FBK0JBdEMsT0FBTyxDQUFDeUMsZUFBUixHQUEwQixVQUFVTCxRQUFWLEVBQW9CTSxJQUFwQixFQUEwQjtBQUNoRE4sRUFBQUEsUUFBUSxDQUFDLFFBQUQsQ0FBUixHQUFxQk0sSUFBckI7QUFDSCxDQUZEOztBQUlBMUMsT0FBTyxDQUFDMkMsZUFBUixHQUEwQixVQUFVUCxRQUFWLEVBQW9CO0FBQzFDLFNBQU9BLFFBQVEsQ0FBQyxRQUFELENBQWY7QUFDSCxDQUZEOztBQUlBcEMsT0FBTyxDQUFDNEMsVUFBUixHQUFxQixVQUFVQyxJQUFWLEVBQWdCO0FBQ2pDLE1BQUlBLElBQUksQ0FBQzFDLE1BQVQsRUFBaUI7QUFDYixRQUFJMkMsR0FBRyxHQUFHRCxJQUFJLENBQUMxQyxNQUFMLENBQVloQixRQUFaLENBQXFCMEMsT0FBckIsQ0FBNkJnQixJQUE3QixDQUFWO0FBQUEsUUFDSXpDLElBQUksR0FBR3lDLElBQUksQ0FBQ3pDLElBRGhCO0FBQUEsUUFFSUMsSUFBSSxHQUFHd0MsSUFBSSxDQUFDeEMsSUFGaEI7QUFJQXdDLElBQUFBLElBQUksQ0FBQ3pDLElBQUwsR0FBWSxJQUFaO0FBQ0F5QyxJQUFBQSxJQUFJLENBQUN4QyxJQUFMLEdBQVksSUFBWjtBQUVBLFFBQUlELElBQUosRUFDSUEsSUFBSSxDQUFDQyxJQUFMLEdBQVlBLElBQVo7QUFFSixRQUFJQSxJQUFKLEVBQ0lBLElBQUksQ0FBQ0QsSUFBTCxHQUFZQSxJQUFaO0FBRUp5QyxJQUFBQSxJQUFJLENBQUMxQyxNQUFMLENBQVloQixRQUFaLENBQXFCMkMsTUFBckIsQ0FBNEJnQixHQUE1QixFQUFpQyxDQUFqQztBQUNBRCxJQUFBQSxJQUFJLENBQUMxQyxNQUFMLEdBQWMsSUFBZDtBQUNIO0FBQ0osQ0FsQkQ7O0FBb0JBSCxPQUFPLENBQUMrQyxVQUFSLEdBQXFCLFVBQVV0RSxVQUFWLEVBQXNCTixJQUF0QixFQUE0QjtBQUM3QyxNQUFJaUIsU0FBUyxHQUFHWCxVQUFVLENBQUNVLFFBQVgsQ0FBb0JWLFVBQVUsQ0FBQ1UsUUFBWCxDQUFvQkUsTUFBcEIsR0FBNkIsQ0FBakQsQ0FBaEI7QUFFQSxNQUFJRCxTQUFTLElBQUlBLFNBQVMsQ0FBQ0csSUFBVixLQUFtQixNQUFwQyxFQUNJSCxTQUFTLENBQUNpQyxJQUFWLElBQWtCbEQsSUFBbEIsQ0FESixLQUdJb0QsV0FBVyxDQUFDOUMsVUFBRCxFQUFhNkMsY0FBYyxDQUFDbkQsSUFBRCxDQUEzQixDQUFYO0FBQ1AsQ0FQRDs7QUFTQTZCLE9BQU8sQ0FBQ2dELGdCQUFSLEdBQTJCLFVBQVV2RSxVQUFWLEVBQXNCTixJQUF0QixFQUE0QndELGFBQTVCLEVBQTJDO0FBQ2xFLE1BQUlzQixRQUFRLEdBQUd4RSxVQUFVLENBQUNVLFFBQVgsQ0FBb0JWLFVBQVUsQ0FBQ1UsUUFBWCxDQUFvQjBDLE9BQXBCLENBQTRCRixhQUE1QixJQUE2QyxDQUFqRSxDQUFmO0FBRUEsTUFBSXNCLFFBQVEsSUFBSUEsUUFBUSxDQUFDMUQsSUFBVCxLQUFrQixNQUFsQyxFQUNJMEQsUUFBUSxDQUFDNUIsSUFBVCxJQUFpQmxELElBQWpCLENBREosS0FHSXVELFlBQVksQ0FBQ2pELFVBQUQsRUFBYTZDLGNBQWMsQ0FBQ25ELElBQUQsQ0FBM0IsRUFBbUN3RCxhQUFuQyxDQUFaO0FBQ1AsQ0FQRDs7QUFTQTNCLE9BQU8sQ0FBQ2tELGVBQVIsR0FBMEIsVUFBVUMsU0FBVixFQUFxQnpDLEtBQXJCLEVBQTRCO0FBQ2xELE9BQUssSUFBSUssQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0wsS0FBSyxDQUFDckIsTUFBMUIsRUFBa0MwQixDQUFDLEVBQW5DLEVBQXVDO0FBQ25DLFFBQUlDLFFBQVEsR0FBR04sS0FBSyxDQUFDSyxDQUFELENBQUwsQ0FBU2IsSUFBeEI7O0FBRUEsUUFBSSxPQUFPaUQsU0FBUyxDQUFDeEMsT0FBVixDQUFrQkssUUFBbEIsQ0FBUCxLQUF1QyxXQUEzQyxFQUF3RDtBQUNwRG1DLE1BQUFBLFNBQVMsQ0FBQ3hDLE9BQVYsQ0FBa0JLLFFBQWxCLElBQThCTixLQUFLLENBQUNLLENBQUQsQ0FBTCxDQUFTRSxLQUF2QztBQUNBa0MsTUFBQUEsU0FBUyxDQUFDLG9CQUFELENBQVQsQ0FBZ0NuQyxRQUFoQyxJQUE0Q04sS0FBSyxDQUFDSyxDQUFELENBQUwsQ0FBU0csU0FBckQ7QUFDQWlDLE1BQUFBLFNBQVMsQ0FBQyxpQkFBRCxDQUFULENBQTZCbkMsUUFBN0IsSUFBeUNOLEtBQUssQ0FBQ0ssQ0FBRCxDQUFMLENBQVNJLE1BQWxEO0FBQ0g7QUFDSjtBQUNKLENBVkQ7O0FBY0FuQixPQUFPLENBQUNvRCxhQUFSLEdBQXdCLFVBQVVQLElBQVYsRUFBZ0I7QUFDcEMsU0FBT0EsSUFBSSxDQUFDMUQsUUFBTCxDQUFjLENBQWQsQ0FBUDtBQUNILENBRkQ7O0FBSUFhLE9BQU8sQ0FBQ3FELGFBQVIsR0FBd0IsVUFBVVIsSUFBVixFQUFnQjtBQUNwQyxTQUFPQSxJQUFJLENBQUMxRCxRQUFaO0FBQ0gsQ0FGRDs7QUFJQWEsT0FBTyxDQUFDc0QsYUFBUixHQUF3QixVQUFVVCxJQUFWLEVBQWdCO0FBQ3BDLFNBQU9BLElBQUksQ0FBQzFDLE1BQVo7QUFDSCxDQUZEOztBQUlBSCxPQUFPLENBQUN1RCxXQUFSLEdBQXNCLFVBQVVyRixPQUFWLEVBQW1CO0FBQ3JDLE1BQUlzRixRQUFRLEdBQUcsRUFBZjs7QUFFQSxPQUFLLElBQUl0RCxJQUFULElBQWlCaEMsT0FBTyxDQUFDeUMsT0FBekIsRUFBa0M7QUFDOUI2QyxJQUFBQSxRQUFRLENBQUMvQixJQUFULENBQWM7QUFDVnZCLE1BQUFBLElBQUksRUFBRUEsSUFESTtBQUVWZSxNQUFBQSxLQUFLLEVBQUUvQyxPQUFPLENBQUN5QyxPQUFSLENBQWdCVCxJQUFoQixDQUZHO0FBR1ZnQixNQUFBQSxTQUFTLEVBQUVoRCxPQUFPLENBQUMsb0JBQUQsQ0FBUCxDQUE4QmdDLElBQTlCLENBSEQ7QUFJVmlCLE1BQUFBLE1BQU0sRUFBRWpELE9BQU8sQ0FBQyxpQkFBRCxDQUFQLENBQTJCZ0MsSUFBM0I7QUFKRSxLQUFkO0FBTUg7O0FBRUQsU0FBT3NELFFBQVA7QUFDSCxDQWJEOztBQWlCQXhELE9BQU8sQ0FBQ3lELFVBQVIsR0FBcUIsVUFBVXZGLE9BQVYsRUFBbUI7QUFDcEMsU0FBT0EsT0FBTyxDQUFDZ0MsSUFBZjtBQUNILENBRkQ7O0FBSUFGLE9BQU8sQ0FBQzBELGVBQVIsR0FBMEIsVUFBVXhGLE9BQVYsRUFBbUI7QUFDekMsU0FBT0EsT0FBTyxDQUFDZ0QsU0FBZjtBQUNILENBRkQ7O0FBSUFsQixPQUFPLENBQUMyRCxrQkFBUixHQUE2QixVQUFVQyxRQUFWLEVBQW9CO0FBQzdDLFNBQU9BLFFBQVEsQ0FBQ3ZDLElBQWhCO0FBQ0gsQ0FGRDs7QUFJQXJCLE9BQU8sQ0FBQzZELHFCQUFSLEdBQWdDLFVBQVVDLFdBQVYsRUFBdUI7QUFDbkQsU0FBT0EsV0FBVyxDQUFDekMsSUFBbkI7QUFDSCxDQUZEOztBQUlBckIsT0FBTyxDQUFDK0QsdUJBQVIsR0FBa0MsVUFBVXZCLFdBQVYsRUFBdUI7QUFDckQsU0FBT0EsV0FBVyxDQUFDLFFBQUQsQ0FBbEI7QUFDSCxDQUZEOztBQUlBeEMsT0FBTyxDQUFDZ0UsMkJBQVIsR0FBc0MsVUFBVXhCLFdBQVYsRUFBdUI7QUFDekQsU0FBT0EsV0FBVyxDQUFDLFlBQUQsQ0FBbEI7QUFDSCxDQUZEOztBQUlBeEMsT0FBTyxDQUFDaUUsMkJBQVIsR0FBc0MsVUFBVXpCLFdBQVYsRUFBdUI7QUFDekQsU0FBT0EsV0FBVyxDQUFDLFlBQUQsQ0FBbEI7QUFDSCxDQUZEOztBQU1BeEMsT0FBTyxDQUFDa0UsVUFBUixHQUFxQixVQUFVckIsSUFBVixFQUFnQjtBQUNqQyxTQUFPQSxJQUFJLENBQUN0RCxJQUFMLEtBQWMsTUFBckI7QUFDSCxDQUZEOztBQUlBUyxPQUFPLENBQUNtRSxhQUFSLEdBQXdCLFVBQVV0QixJQUFWLEVBQWdCO0FBQ3BDLFNBQU9BLElBQUksQ0FBQ3RELElBQUwsS0FBYyxTQUFyQjtBQUNILENBRkQ7O0FBSUFTLE9BQU8sQ0FBQ29FLGtCQUFSLEdBQTZCLFVBQVV2QixJQUFWLEVBQWdCO0FBQ3pDLFNBQU9BLElBQUksQ0FBQ3RELElBQUwsS0FBYyxXQUFkLElBQTZCc0QsSUFBSSxDQUFDM0MsSUFBTCxLQUFjLFVBQWxEO0FBQ0gsQ0FGRDs7QUFJQUYsT0FBTyxDQUFDcUUsYUFBUixHQUF3QixVQUFVeEIsSUFBVixFQUFnQjtBQUNwQyxTQUFPLENBQUMsQ0FBQ0EsSUFBSSxDQUFDbEMsT0FBZDtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBkb2N0eXBlID0gcmVxdWlyZSgnLi4vY29tbW9uL2RvY3R5cGUnKSxcbiAgICBET0NVTUVOVF9NT0RFID0gcmVxdWlyZSgnLi4vY29tbW9uL2h0bWwnKS5ET0NVTUVOVF9NT0RFO1xuXG5cbi8vQ29udmVyc2lvbiB0YWJsZXMgZm9yIERPTSBMZXZlbDEgc3RydWN0dXJlIGVtdWxhdGlvblxudmFyIG5vZGVUeXBlcyA9IHtcbiAgICBlbGVtZW50OiAxLFxuICAgIHRleHQ6IDMsXG4gICAgY2RhdGE6IDQsXG4gICAgY29tbWVudDogOFxufTtcblxudmFyIG5vZGVQcm9wZXJ0eVNob3J0aGFuZHMgPSB7XG4gICAgdGFnTmFtZTogJ25hbWUnLFxuICAgIGNoaWxkTm9kZXM6ICdjaGlsZHJlbicsXG4gICAgcGFyZW50Tm9kZTogJ3BhcmVudCcsXG4gICAgcHJldmlvdXNTaWJsaW5nOiAncHJldicsXG4gICAgbmV4dFNpYmxpbmc6ICduZXh0JyxcbiAgICBub2RlVmFsdWU6ICdkYXRhJ1xufTtcblxuLy9Ob2RlXG52YXIgTm9kZSA9IGZ1bmN0aW9uIChwcm9wcykge1xuICAgIGZvciAodmFyIGtleSBpbiBwcm9wcykge1xuICAgICAgICBpZiAocHJvcHMuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHRoaXNba2V5XSA9IHByb3BzW2tleV07XG4gICAgfVxufTtcblxuTm9kZS5wcm90b3R5cGUgPSB7XG4gICAgZ2V0IGZpcnN0Q2hpbGQoKSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG5cbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuICYmIGNoaWxkcmVuWzBdIHx8IG51bGw7XG4gICAgfSxcblxuICAgIGdldCBsYXN0Q2hpbGQoKSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG5cbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuICYmIGNoaWxkcmVuW2NoaWxkcmVuLmxlbmd0aCAtIDFdIHx8IG51bGw7XG4gICAgfSxcblxuICAgIGdldCBub2RlVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIG5vZGVUeXBlc1t0aGlzLnR5cGVdIHx8IG5vZGVUeXBlcy5lbGVtZW50O1xuICAgIH1cbn07XG5cbk9iamVjdC5rZXlzKG5vZGVQcm9wZXJ0eVNob3J0aGFuZHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIHZhciBzaG9ydGhhbmQgPSBub2RlUHJvcGVydHlTaG9ydGhhbmRzW2tleV07XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTm9kZS5wcm90b3R5cGUsIGtleSwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW3Nob3J0aGFuZF0gfHwgbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICB0aGlzW3Nob3J0aGFuZF0gPSB2YWw7XG4gICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuXG4vL05vZGUgY29uc3RydWN0aW9uXG5leHBvcnRzLmNyZWF0ZURvY3VtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICdyb290JyxcbiAgICAgICAgbmFtZTogJ3Jvb3QnLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgICAgJ3gtbW9kZSc6IERPQ1VNRU5UX01PREUuTk9fUVVJUktTXG4gICAgfSk7XG59O1xuXG5leHBvcnRzLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBOb2RlKHtcbiAgICAgICAgdHlwZTogJ3Jvb3QnLFxuICAgICAgICBuYW1lOiAncm9vdCcsXG4gICAgICAgIHBhcmVudDogbnVsbCxcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgY2hpbGRyZW46IFtdXG4gICAgfSk7XG59O1xuXG5leHBvcnRzLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAodGFnTmFtZSwgbmFtZXNwYWNlVVJJLCBhdHRycykge1xuICAgIHZhciBhdHRyaWJzID0gT2JqZWN0LmNyZWF0ZShudWxsKSxcbiAgICAgICAgYXR0cmlic05hbWVzcGFjZSA9IE9iamVjdC5jcmVhdGUobnVsbCksXG4gICAgICAgIGF0dHJpYnNQcmVmaXggPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYXR0ck5hbWUgPSBhdHRyc1tpXS5uYW1lO1xuXG4gICAgICAgIGF0dHJpYnNbYXR0ck5hbWVdID0gYXR0cnNbaV0udmFsdWU7XG4gICAgICAgIGF0dHJpYnNOYW1lc3BhY2VbYXR0ck5hbWVdID0gYXR0cnNbaV0ubmFtZXNwYWNlO1xuICAgICAgICBhdHRyaWJzUHJlZml4W2F0dHJOYW1lXSA9IGF0dHJzW2ldLnByZWZpeDtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IE5vZGUoe1xuICAgICAgICB0eXBlOiB0YWdOYW1lID09PSAnc2NyaXB0JyB8fCB0YWdOYW1lID09PSAnc3R5bGUnID8gdGFnTmFtZSA6ICd0YWcnLFxuICAgICAgICBuYW1lOiB0YWdOYW1lLFxuICAgICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZVVSSSxcbiAgICAgICAgYXR0cmliczogYXR0cmlicyxcbiAgICAgICAgJ3gtYXR0cmlic05hbWVzcGFjZSc6IGF0dHJpYnNOYW1lc3BhY2UsXG4gICAgICAgICd4LWF0dHJpYnNQcmVmaXgnOiBhdHRyaWJzUHJlZml4LFxuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgIHBhcmVudDogbnVsbCxcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbFxuICAgIH0pO1xufTtcblxuZXhwb3J0cy5jcmVhdGVDb21tZW50Tm9kZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBOb2RlKHtcbiAgICAgICAgdHlwZTogJ2NvbW1lbnQnLFxuICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGxcbiAgICB9KTtcbn07XG5cbnZhciBjcmVhdGVUZXh0Tm9kZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgZGF0YTogdmFsdWUsXG4gICAgICAgIHBhcmVudDogbnVsbCxcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbFxuICAgIH0pO1xufTtcblxuXG4vL1RyZWUgbXV0YXRpb25cbnZhciBhcHBlbmRDaGlsZCA9IGV4cG9ydHMuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbiAocGFyZW50Tm9kZSwgbmV3Tm9kZSkge1xuICAgIHZhciBwcmV2ID0gcGFyZW50Tm9kZS5jaGlsZHJlbltwYXJlbnROb2RlLmNoaWxkcmVuLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKHByZXYpIHtcbiAgICAgICAgcHJldi5uZXh0ID0gbmV3Tm9kZTtcbiAgICAgICAgbmV3Tm9kZS5wcmV2ID0gcHJldjtcbiAgICB9XG5cbiAgICBwYXJlbnROb2RlLmNoaWxkcmVuLnB1c2gobmV3Tm9kZSk7XG4gICAgbmV3Tm9kZS5wYXJlbnQgPSBwYXJlbnROb2RlO1xufTtcblxudmFyIGluc2VydEJlZm9yZSA9IGV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpIHtcbiAgICB2YXIgaW5zZXJ0aW9uSWR4ID0gcGFyZW50Tm9kZS5jaGlsZHJlbi5pbmRleE9mKHJlZmVyZW5jZU5vZGUpLFxuICAgICAgICBwcmV2ID0gcmVmZXJlbmNlTm9kZS5wcmV2O1xuXG4gICAgaWYgKHByZXYpIHtcbiAgICAgICAgcHJldi5uZXh0ID0gbmV3Tm9kZTtcbiAgICAgICAgbmV3Tm9kZS5wcmV2ID0gcHJldjtcbiAgICB9XG5cbiAgICByZWZlcmVuY2VOb2RlLnByZXYgPSBuZXdOb2RlO1xuICAgIG5ld05vZGUubmV4dCA9IHJlZmVyZW5jZU5vZGU7XG5cbiAgICBwYXJlbnROb2RlLmNoaWxkcmVuLnNwbGljZShpbnNlcnRpb25JZHgsIDAsIG5ld05vZGUpO1xuICAgIG5ld05vZGUucGFyZW50ID0gcGFyZW50Tm9kZTtcbn07XG5cbmV4cG9ydHMuc2V0VGVtcGxhdGVDb250ZW50ID0gZnVuY3Rpb24gKHRlbXBsYXRlRWxlbWVudCwgY29udGVudEVsZW1lbnQpIHtcbiAgICBhcHBlbmRDaGlsZCh0ZW1wbGF0ZUVsZW1lbnQsIGNvbnRlbnRFbGVtZW50KTtcbn07XG5cbmV4cG9ydHMuZ2V0VGVtcGxhdGVDb250ZW50ID0gZnVuY3Rpb24gKHRlbXBsYXRlRWxlbWVudCkge1xuICAgIHJldHVybiB0ZW1wbGF0ZUVsZW1lbnQuY2hpbGRyZW5bMF07XG59O1xuXG5leHBvcnRzLnNldERvY3VtZW50VHlwZSA9IGZ1bmN0aW9uIChkb2N1bWVudCwgbmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKSB7XG4gICAgdmFyIGRhdGEgPSBkb2N0eXBlLnNlcmlhbGl6ZUNvbnRlbnQobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKSxcbiAgICAgICAgZG9jdHlwZU5vZGUgPSBudWxsO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2N1bWVudC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZG9jdW1lbnQuY2hpbGRyZW5baV0udHlwZSA9PT0gJ2RpcmVjdGl2ZScgJiYgZG9jdW1lbnQuY2hpbGRyZW5baV0ubmFtZSA9PT0gJyFkb2N0eXBlJykge1xuICAgICAgICAgICAgZG9jdHlwZU5vZGUgPSBkb2N1bWVudC5jaGlsZHJlbltpXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRvY3R5cGVOb2RlKSB7XG4gICAgICAgIGRvY3R5cGVOb2RlLmRhdGEgPSBkYXRhO1xuICAgICAgICBkb2N0eXBlTm9kZVsneC1uYW1lJ10gPSBuYW1lO1xuICAgICAgICBkb2N0eXBlTm9kZVsneC1wdWJsaWNJZCddID0gcHVibGljSWQ7XG4gICAgICAgIGRvY3R5cGVOb2RlWyd4LXN5c3RlbUlkJ10gPSBzeXN0ZW1JZDtcbiAgICB9XG5cbiAgICBlbHNlIHtcbiAgICAgICAgYXBwZW5kQ2hpbGQoZG9jdW1lbnQsIG5ldyBOb2RlKHtcbiAgICAgICAgICAgIHR5cGU6ICdkaXJlY3RpdmUnLFxuICAgICAgICAgICAgbmFtZTogJyFkb2N0eXBlJyxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAneC1uYW1lJzogbmFtZSxcbiAgICAgICAgICAgICd4LXB1YmxpY0lkJzogcHVibGljSWQsXG4gICAgICAgICAgICAneC1zeXN0ZW1JZCc6IHN5c3RlbUlkXG4gICAgICAgIH0pKTtcbiAgICB9XG5cbn07XG5cbmV4cG9ydHMuc2V0RG9jdW1lbnRNb2RlID0gZnVuY3Rpb24gKGRvY3VtZW50LCBtb2RlKSB7XG4gICAgZG9jdW1lbnRbJ3gtbW9kZSddID0gbW9kZTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRNb2RlID0gZnVuY3Rpb24gKGRvY3VtZW50KSB7XG4gICAgcmV0dXJuIGRvY3VtZW50Wyd4LW1vZGUnXTtcbn07XG5cbmV4cG9ydHMuZGV0YWNoTm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgaWYgKG5vZGUucGFyZW50KSB7XG4gICAgICAgIHZhciBpZHggPSBub2RlLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLFxuICAgICAgICAgICAgcHJldiA9IG5vZGUucHJldixcbiAgICAgICAgICAgIG5leHQgPSBub2RlLm5leHQ7XG5cbiAgICAgICAgbm9kZS5wcmV2ID0gbnVsbDtcbiAgICAgICAgbm9kZS5uZXh0ID0gbnVsbDtcblxuICAgICAgICBpZiAocHJldilcbiAgICAgICAgICAgIHByZXYubmV4dCA9IG5leHQ7XG5cbiAgICAgICAgaWYgKG5leHQpXG4gICAgICAgICAgICBuZXh0LnByZXYgPSBwcmV2O1xuXG4gICAgICAgIG5vZGUucGFyZW50LmNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xuICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XG4gICAgfVxufTtcblxuZXhwb3J0cy5pbnNlcnRUZXh0ID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIHRleHQpIHtcbiAgICB2YXIgbGFzdENoaWxkID0gcGFyZW50Tm9kZS5jaGlsZHJlbltwYXJlbnROb2RlLmNoaWxkcmVuLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKGxhc3RDaGlsZCAmJiBsYXN0Q2hpbGQudHlwZSA9PT0gJ3RleHQnKVxuICAgICAgICBsYXN0Q2hpbGQuZGF0YSArPSB0ZXh0O1xuICAgIGVsc2VcbiAgICAgICAgYXBwZW5kQ2hpbGQocGFyZW50Tm9kZSwgY3JlYXRlVGV4dE5vZGUodGV4dCkpO1xufTtcblxuZXhwb3J0cy5pbnNlcnRUZXh0QmVmb3JlID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIHRleHQsIHJlZmVyZW5jZU5vZGUpIHtcbiAgICB2YXIgcHJldk5vZGUgPSBwYXJlbnROb2RlLmNoaWxkcmVuW3BhcmVudE5vZGUuY2hpbGRyZW4uaW5kZXhPZihyZWZlcmVuY2VOb2RlKSAtIDFdO1xuXG4gICAgaWYgKHByZXZOb2RlICYmIHByZXZOb2RlLnR5cGUgPT09ICd0ZXh0JylcbiAgICAgICAgcHJldk5vZGUuZGF0YSArPSB0ZXh0O1xuICAgIGVsc2VcbiAgICAgICAgaW5zZXJ0QmVmb3JlKHBhcmVudE5vZGUsIGNyZWF0ZVRleHROb2RlKHRleHQpLCByZWZlcmVuY2VOb2RlKTtcbn07XG5cbmV4cG9ydHMuYWRvcHRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKHJlY2lwaWVudCwgYXR0cnMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBhdHRyTmFtZSA9IGF0dHJzW2ldLm5hbWU7XG5cbiAgICAgICAgaWYgKHR5cGVvZiByZWNpcGllbnQuYXR0cmlic1thdHRyTmFtZV0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZWNpcGllbnQuYXR0cmlic1thdHRyTmFtZV0gPSBhdHRyc1tpXS52YWx1ZTtcbiAgICAgICAgICAgIHJlY2lwaWVudFsneC1hdHRyaWJzTmFtZXNwYWNlJ11bYXR0ck5hbWVdID0gYXR0cnNbaV0ubmFtZXNwYWNlO1xuICAgICAgICAgICAgcmVjaXBpZW50Wyd4LWF0dHJpYnNQcmVmaXgnXVthdHRyTmFtZV0gPSBhdHRyc1tpXS5wcmVmaXg7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5cbi8vVHJlZSB0cmF2ZXJzaW5nXG5leHBvcnRzLmdldEZpcnN0Q2hpbGQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzBdO1xufTtcblxuZXhwb3J0cy5nZXRDaGlsZE5vZGVzID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5jaGlsZHJlbjtcbn07XG5cbmV4cG9ydHMuZ2V0UGFyZW50Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUucGFyZW50O1xufTtcblxuZXhwb3J0cy5nZXRBdHRyTGlzdCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdmFyIGF0dHJMaXN0ID0gW107XG5cbiAgICBmb3IgKHZhciBuYW1lIGluIGVsZW1lbnQuYXR0cmlicykge1xuICAgICAgICBhdHRyTGlzdC5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogZWxlbWVudC5hdHRyaWJzW25hbWVdLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBlbGVtZW50Wyd4LWF0dHJpYnNOYW1lc3BhY2UnXVtuYW1lXSxcbiAgICAgICAgICAgIHByZWZpeDogZWxlbWVudFsneC1hdHRyaWJzUHJlZml4J11bbmFtZV1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF0dHJMaXN0O1xufTtcblxuXG4vL05vZGUgZGF0YVxuZXhwb3J0cy5nZXRUYWdOYW1lID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5uYW1lO1xufTtcblxuZXhwb3J0cy5nZXROYW1lc3BhY2VVUkkgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50Lm5hbWVzcGFjZTtcbn07XG5cbmV4cG9ydHMuZ2V0VGV4dE5vZGVDb250ZW50ID0gZnVuY3Rpb24gKHRleHROb2RlKSB7XG4gICAgcmV0dXJuIHRleHROb2RlLmRhdGE7XG59O1xuXG5leHBvcnRzLmdldENvbW1lbnROb2RlQ29udGVudCA9IGZ1bmN0aW9uIChjb21tZW50Tm9kZSkge1xuICAgIHJldHVybiBjb21tZW50Tm9kZS5kYXRhO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlTmFtZSA9IGZ1bmN0aW9uIChkb2N0eXBlTm9kZSkge1xuICAgIHJldHVybiBkb2N0eXBlTm9kZVsneC1uYW1lJ107XG59O1xuXG5leHBvcnRzLmdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZCA9IGZ1bmN0aW9uIChkb2N0eXBlTm9kZSkge1xuICAgIHJldHVybiBkb2N0eXBlTm9kZVsneC1wdWJsaWNJZCddO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlU3lzdGVtSWQgPSBmdW5jdGlvbiAoZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGVbJ3gtc3lzdGVtSWQnXTtcbn07XG5cblxuLy9Ob2RlIHR5cGVzXG5leHBvcnRzLmlzVGV4dE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLnR5cGUgPT09ICd0ZXh0Jztcbn07XG5cbmV4cG9ydHMuaXNDb21tZW50Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUudHlwZSA9PT0gJ2NvbW1lbnQnO1xufTtcblxuZXhwb3J0cy5pc0RvY3VtZW50VHlwZU5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLnR5cGUgPT09ICdkaXJlY3RpdmUnICYmIG5vZGUubmFtZSA9PT0gJyFkb2N0eXBlJztcbn07XG5cbmV4cG9ydHMuaXNFbGVtZW50Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuICEhbm9kZS5hdHRyaWJzO1xufTtcbiJdfQ==