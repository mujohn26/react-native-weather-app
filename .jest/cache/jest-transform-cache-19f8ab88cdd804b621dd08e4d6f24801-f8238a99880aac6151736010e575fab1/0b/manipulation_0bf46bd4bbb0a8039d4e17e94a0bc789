d0a0bc3c73ddb38c575d427f835278c0
var parse = require("../parse"),
    $ = require("../static"),
    updateDOM = parse.update,
    evaluate = parse.evaluate,
    utils = require("../utils"),
    domEach = utils.domEach,
    cloneDom = utils.cloneDom,
    isHtml = utils.isHtml,
    slice = Array.prototype.slice,
    _ = {
  flatten: require('lodash/flatten'),
  bind: require('lodash/bind'),
  forEach: require('lodash/forEach')
};

exports._makeDomArray = function makeDomArray(elem, clone) {
  if (elem == null) {
    return [];
  } else if (elem.cheerio) {
    return clone ? cloneDom(elem.get(), elem.options) : elem.get();
  } else if (Array.isArray(elem)) {
    return _.flatten(elem.map(function (el) {
      return this._makeDomArray(el, clone);
    }, this));
  } else if (typeof elem === 'string') {
    return evaluate(elem, this.options, false);
  } else {
    return clone ? cloneDom([elem]) : [elem];
  }
};

var _insert = function _insert(concatenator) {
  return function () {
    var elems = slice.call(arguments),
        lastIdx = this.length - 1;
    return domEach(this, function (i, el) {
      var dom, domSrc;

      if (typeof elems[0] === 'function') {
        domSrc = elems[0].call(el, i, $.html(el.children));
      } else {
        domSrc = elems;
      }

      dom = this._makeDomArray(domSrc, i < lastIdx);
      concatenator(dom, el.children, el);
    });
  };
};

var uniqueSplice = function uniqueSplice(array, spliceIdx, spliceCount, newElems, parent) {
  var spliceArgs = [spliceIdx, spliceCount].concat(newElems),
      prev = array[spliceIdx - 1] || null,
      next = array[spliceIdx] || null;
  var idx, len, prevIdx, node, oldParent;

  for (idx = 0, len = newElems.length; idx < len; ++idx) {
    node = newElems[idx];
    oldParent = node.parent || node.root;
    prevIdx = oldParent && oldParent.children.indexOf(newElems[idx]);

    if (oldParent && prevIdx > -1) {
      oldParent.children.splice(prevIdx, 1);

      if (parent === oldParent && spliceIdx > prevIdx) {
        spliceArgs[0]--;
      }
    }

    node.root = null;
    node.parent = parent;

    if (node.prev) {
      node.prev.next = node.next || null;
    }

    if (node.next) {
      node.next.prev = node.prev || null;
    }

    node.prev = newElems[idx - 1] || prev;
    node.next = newElems[idx + 1] || next;
  }

  if (prev) {
    prev.next = newElems[0];
  }

  if (next) {
    next.prev = newElems[newElems.length - 1];
  }

  return array.splice.apply(array, spliceArgs);
};

exports.appendTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.append(this);
  return this;
};

exports.prependTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.prepend(this);
  return this;
};

exports.append = _insert(function (dom, children, parent) {
  uniqueSplice(children, children.length, 0, dom, parent);
});
exports.prepend = _insert(function (dom, children, parent) {
  uniqueSplice(children, 0, 0, dom, parent);
});

exports.wrap = function (wrapper) {
  var wrapperFn = typeof wrapper === 'function' && wrapper,
      lastIdx = this.length - 1;

  _.forEach(this, _.bind(function (el, i) {
    var parent = el.parent || el.root,
        siblings = parent.children,
        wrapperDom,
        elInsertLocation,
        j,
        index;

    if (!parent) {
      return;
    }

    if (wrapperFn) {
      wrapper = wrapperFn.call(el, i);
    }

    if (typeof wrapper === 'string' && !isHtml(wrapper)) {
      wrapper = this.parents().last().find(wrapper).clone();
    }

    wrapperDom = this._makeDomArray(wrapper, i < lastIdx).slice(0, 1);
    elInsertLocation = wrapperDom[0];
    j = 0;

    while (elInsertLocation && elInsertLocation.children) {
      if (j >= elInsertLocation.children.length) {
        break;
      }

      if (elInsertLocation.children[j].type === 'tag') {
        elInsertLocation = elInsertLocation.children[j];
        j = 0;
      } else {
        j++;
      }
    }

    index = siblings.indexOf(el);
    updateDOM([el], elInsertLocation);
    uniqueSplice(siblings, index, 0, wrapperDom, parent);
  }, this));

  return this;
};

exports.after = function () {
  var elems = slice.call(arguments),
      lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el),
        domSrc,
        dom;
    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, $.html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx);
    uniqueSplice(siblings, index + 1, 0, dom, parent);
  });
  return this;
};

exports.insertAfter = function (target) {
  var clones = [],
      self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el);
    if (index < 0) return;
    uniqueSplice(siblings, index + 1, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};

exports.before = function () {
  var elems = slice.call(arguments),
      lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el),
        domSrc,
        dom;
    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, $.html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx);
    uniqueSplice(siblings, index, 0, dom, parent);
  });
  return this;
};

exports.insertBefore = function (target) {
  var clones = [],
      self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el);
    if (index < 0) return;
    uniqueSplice(siblings, index, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};

exports.remove = function (selector) {
  var elems = this;
  if (selector) elems = elems.filter(selector);
  domEach(elems, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el);
    if (index < 0) return;
    siblings.splice(index, 1);

    if (el.prev) {
      el.prev.next = el.next;
    }

    if (el.next) {
      el.next.prev = el.prev;
    }

    el.prev = el.next = el.parent = el.root = null;
  });
  return this;
};

exports.replaceWith = function (content) {
  var self = this;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        dom = self._makeDomArray(typeof content === 'function' ? content.call(el, i, el) : content),
        index;

    updateDOM(dom, null);
    index = siblings.indexOf(el);
    uniqueSplice(siblings, index, 1, dom, parent);
    el.parent = el.prev = el.next = el.root = null;
  });
  return this;
};

exports.empty = function () {
  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    el.children.length = 0;
  });
  return this;
};

exports.html = function (str) {
  if (str === undefined) {
    if (!this[0] || !this[0].children) return null;
    return $.html(this[0].children, this.options);
  }

  var opts = this.options;
  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    var content = str.cheerio ? str.clone().get() : evaluate('' + str, opts, false);
    updateDOM(content, el);
  });
  return this;
};

exports.toString = function () {
  return $.html(this, this.options);
};

exports.text = function (str) {
  if (str === undefined) {
    return $.text(this);
  } else if (typeof str === 'function') {
    return domEach(this, function (i, el) {
      var $el = [el];
      return exports.text.call($el, str.call(el, i, $.text($el)));
    });
  }

  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    var elem = {
      data: '' + str,
      type: 'text',
      parent: el,
      prev: null,
      next: null,
      children: []
    };
    updateDOM(elem, el);
  });
  return this;
};

exports.clone = function () {
  return this._make(cloneDom(this.get(), this.options));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hbmlwdWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJwYXJzZSIsInJlcXVpcmUiLCIkIiwidXBkYXRlRE9NIiwidXBkYXRlIiwiZXZhbHVhdGUiLCJ1dGlscyIsImRvbUVhY2giLCJjbG9uZURvbSIsImlzSHRtbCIsInNsaWNlIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJfIiwiZmxhdHRlbiIsImJpbmQiLCJmb3JFYWNoIiwiZXhwb3J0cyIsIl9tYWtlRG9tQXJyYXkiLCJtYWtlRG9tQXJyYXkiLCJlbGVtIiwiY2xvbmUiLCJjaGVlcmlvIiwiZ2V0Iiwib3B0aW9ucyIsImlzQXJyYXkiLCJtYXAiLCJlbCIsIl9pbnNlcnQiLCJjb25jYXRlbmF0b3IiLCJlbGVtcyIsImNhbGwiLCJhcmd1bWVudHMiLCJsYXN0SWR4IiwibGVuZ3RoIiwiaSIsImRvbSIsImRvbVNyYyIsImh0bWwiLCJjaGlsZHJlbiIsInVuaXF1ZVNwbGljZSIsImFycmF5Iiwic3BsaWNlSWR4Iiwic3BsaWNlQ291bnQiLCJuZXdFbGVtcyIsInBhcmVudCIsInNwbGljZUFyZ3MiLCJjb25jYXQiLCJwcmV2IiwibmV4dCIsImlkeCIsImxlbiIsInByZXZJZHgiLCJub2RlIiwib2xkUGFyZW50Iiwicm9vdCIsImluZGV4T2YiLCJzcGxpY2UiLCJhcHBseSIsImFwcGVuZFRvIiwidGFyZ2V0IiwiY29uc3RydWN0b3IiLCJfb3JpZ2luYWxSb290IiwiYXBwZW5kIiwicHJlcGVuZFRvIiwicHJlcGVuZCIsIndyYXAiLCJ3cmFwcGVyIiwid3JhcHBlckZuIiwic2libGluZ3MiLCJ3cmFwcGVyRG9tIiwiZWxJbnNlcnRMb2NhdGlvbiIsImoiLCJpbmRleCIsInBhcmVudHMiLCJsYXN0IiwiZmluZCIsInR5cGUiLCJhZnRlciIsImluc2VydEFmdGVyIiwiY2xvbmVzIiwic2VsZiIsInJlbW92ZSIsImNsb25lZFNlbGYiLCJwdXNoIiwiYmVmb3JlIiwiaW5zZXJ0QmVmb3JlIiwic2VsZWN0b3IiLCJmaWx0ZXIiLCJyZXBsYWNlV2l0aCIsImNvbnRlbnQiLCJlbXB0eSIsImNoaWxkIiwic3RyIiwidW5kZWZpbmVkIiwib3B0cyIsInRvU3RyaW5nIiwidGV4dCIsIiRlbCIsImRhdGEiLCJfbWFrZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLFlBQW5CO0FBQUEsSUFDSUMsQ0FBQyxHQUFHRCxPQUFPLGFBRGY7QUFBQSxJQUVJRSxTQUFTLEdBQUdILEtBQUssQ0FBQ0ksTUFGdEI7QUFBQSxJQUdJQyxRQUFRLEdBQUdMLEtBQUssQ0FBQ0ssUUFIckI7QUFBQSxJQUlJQyxLQUFLLEdBQUdMLE9BQU8sWUFKbkI7QUFBQSxJQUtJTSxPQUFPLEdBQUdELEtBQUssQ0FBQ0MsT0FMcEI7QUFBQSxJQU1JQyxRQUFRLEdBQUdGLEtBQUssQ0FBQ0UsUUFOckI7QUFBQSxJQU9JQyxNQUFNLEdBQUdILEtBQUssQ0FBQ0csTUFQbkI7QUFBQSxJQVFJQyxLQUFLLEdBQUdDLEtBQUssQ0FBQ0MsU0FBTixDQUFnQkYsS0FSNUI7QUFBQSxJQVNJRyxDQUFDLEdBQUc7QUFDRkMsRUFBQUEsT0FBTyxFQUFFYixPQUFPLENBQUMsZ0JBQUQsQ0FEZDtBQUVGYyxFQUFBQSxJQUFJLEVBQUVkLE9BQU8sQ0FBQyxhQUFELENBRlg7QUFHRmUsRUFBQUEsT0FBTyxFQUFFZixPQUFPLENBQUMsZ0JBQUQ7QUFIZCxDQVRSOztBQWlCQWdCLE9BQU8sQ0FBQ0MsYUFBUixHQUF3QixTQUFTQyxZQUFULENBQXNCQyxJQUF0QixFQUE0QkMsS0FBNUIsRUFBbUM7QUFDekQsTUFBSUQsSUFBSSxJQUFJLElBQVosRUFBa0I7QUFDaEIsV0FBTyxFQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUlBLElBQUksQ0FBQ0UsT0FBVCxFQUFrQjtBQUN2QixXQUFPRCxLQUFLLEdBQUdiLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDRyxHQUFMLEVBQUQsRUFBYUgsSUFBSSxDQUFDSSxPQUFsQixDQUFYLEdBQXdDSixJQUFJLENBQUNHLEdBQUwsRUFBcEQ7QUFD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QUUsS0FBS04sR0FERjtBQUVUaEIsTUFBQUEsSUFBSSxFQUFFLE1BRkc7QUFHVGhDLE1BQUFBLE1BQU0sRUFBRWxCLEVBSEM7QUFJVHFCLE1BQUFBLElBQUksRUFBRSxJQUpHO0FBS1RDLE1BQUFBLElBQUksRUFBRSxJQUxHO0FBTVRWLE1BQUFBLFFBQVEsRUFBRTtBQU5ELEtBQVg7QUFTQXBDLElBQUFBLFNBQVMsQ0FBQ2lCLElBQUQsRUFBT08sRUFBUCxDQUFUO0FBQ0QsR0FmTSxDQUFQO0FBaUJBLFNBQU8sSUFBUDtBQUNELENBL0JEOztBQWlDQVYsT0FBTyxDQUFDSSxLQUFSLEdBQWdCLFlBQVc7QUFDekIsU0FBTyxLQUFLK0UsS0FBTCxDQUFXNUYsUUFBUSxDQUFDLEtBQUtlLEdBQUwsRUFBRCxFQUFhLEtBQUtDLE9BQWxCLENBQW5CLENBQVA7QUFDRCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHBhcnNlID0gcmVxdWlyZSgnLi4vcGFyc2UnKSxcbiAgICAkID0gcmVxdWlyZSgnLi4vc3RhdGljJyksXG4gICAgdXBkYXRlRE9NID0gcGFyc2UudXBkYXRlLFxuICAgIGV2YWx1YXRlID0gcGFyc2UuZXZhbHVhdGUsXG4gICAgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpLFxuICAgIGRvbUVhY2ggPSB1dGlscy5kb21FYWNoLFxuICAgIGNsb25lRG9tID0gdXRpbHMuY2xvbmVEb20sXG4gICAgaXNIdG1sID0gdXRpbHMuaXNIdG1sLFxuICAgIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLFxuICAgIF8gPSB7XG4gICAgICBmbGF0dGVuOiByZXF1aXJlKCdsb2Rhc2gvZmxhdHRlbicpLFxuICAgICAgYmluZDogcmVxdWlyZSgnbG9kYXNoL2JpbmQnKSxcbiAgICAgIGZvckVhY2g6IHJlcXVpcmUoJ2xvZGFzaC9mb3JFYWNoJylcbiAgICB9O1xuXG4vLyBDcmVhdGUgYW4gYXJyYXkgb2Ygbm9kZXMsIHJlY3Vyc2luZyBpbnRvIGFycmF5cyBhbmQgcGFyc2luZyBzdHJpbmdzIGlmXG4vLyBuZWNlc3NhcnlcbmV4cG9ydHMuX21ha2VEb21BcnJheSA9IGZ1bmN0aW9uIG1ha2VEb21BcnJheShlbGVtLCBjbG9uZSkge1xuICBpZiAoZWxlbSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9IGVsc2UgaWYgKGVsZW0uY2hlZXJpbykge1xuICAgIHJldHVybiBjbG9uZSA/IGNsb25lRG9tKGVsZW0uZ2V0KCksIGVsZW0ub3B0aW9ucykgOiBlbGVtLmdldCgpO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZWxlbSkpIHtcbiAgICByZXR1cm4gXy5mbGF0dGVuKGVsZW0ubWFwKGZ1bmN0aW9uKGVsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbWFrZURvbUFycmF5KGVsLCBjbG9uZSk7XG4gICAgfSwgdGhpcykpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBlbGVtID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBldmFsdWF0ZShlbGVtLCB0aGlzLm9wdGlvbnMsIGZhbHNlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY2xvbmUgPyBjbG9uZURvbShbZWxlbV0pIDogW2VsZW1dO1xuICB9XG59O1xuXG52YXIgX2luc2VydCA9IGZ1bmN0aW9uKGNvbmNhdGVuYXRvcikge1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMpLFxuICAgICAgICBsYXN0SWR4ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICAgIHZhciBkb20sIGRvbVNyYztcblxuICAgICAgaWYgKHR5cGVvZiBlbGVtc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBkb21TcmMgPSBlbGVtc1swXS5jYWxsKGVsLCBpLCAkLmh0bWwoZWwuY2hpbGRyZW4pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvbVNyYyA9IGVsZW1zO1xuICAgICAgfVxuXG4gICAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG4gICAgICBjb25jYXRlbmF0b3IoZG9tLCBlbC5jaGlsZHJlbiwgZWwpO1xuICAgIH0pO1xuICB9O1xufTtcblxuLypcbiAqIE1vZGlmeSBhbiBhcnJheSBpbi1wbGFjZSwgcmVtb3Zpbmcgc29tZSBudW1iZXIgb2YgZWxlbWVudHMgYW5kIGFkZGluZyBuZXdcbiAqIGVsZW1lbnRzIGRpcmVjdGx5IGZvbGxvd2luZyB0aGVtLlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRhcmdldCBhcnJheSB0byBzcGxpY2UuXG4gKiBAcGFyYW0ge051bWJlcn0gc3BsaWNlSWR4IEluZGV4IGF0IHdoaWNoIHRvIGJlZ2luIGNoYW5naW5nIHRoZSBhcnJheS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBzcGxpY2VDb3VudCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gcmVtb3ZlIGZyb20gdGhlIGFycmF5LlxuICogQHBhcmFtIHtBcnJheX0gbmV3RWxlbXMgRWxlbWVudHMgdG8gaW5zZXJ0IGludG8gdGhlIGFycmF5LlxuICpcbiAqIEBhcGkgcHJpdmF0ZVxuICovXG52YXIgdW5pcXVlU3BsaWNlID0gZnVuY3Rpb24oYXJyYXksIHNwbGljZUlkeCwgc3BsaWNlQ291bnQsIG5ld0VsZW1zLCBwYXJlbnQpIHtcbiAgdmFyIHNwbGljZUFyZ3MgPSBbc3BsaWNlSWR4LCBzcGxpY2VDb3VudF0uY29uY2F0KG5ld0VsZW1zKSxcbiAgICAgIHByZXYgPSBhcnJheVtzcGxpY2VJZHggLSAxXSB8fCBudWxsLFxuICAgICAgbmV4dCA9IGFycmF5W3NwbGljZUlkeF0gfHwgbnVsbDtcbiAgdmFyIGlkeCwgbGVuLCBwcmV2SWR4LCBub2RlLCBvbGRQYXJlbnQ7XG5cbiAgLy8gQmVmb3JlIHNwbGljaW5nIGluIG5ldyBlbGVtZW50cywgZW5zdXJlIHRoZXkgZG8gbm90IGFscmVhZHkgYXBwZWFyIGluIHRoZVxuICAvLyBjdXJyZW50IGFycmF5LlxuICBmb3IgKGlkeCA9IDAsIGxlbiA9IG5ld0VsZW1zLmxlbmd0aDsgaWR4IDwgbGVuOyArK2lkeCkge1xuICAgIG5vZGUgPSBuZXdFbGVtc1tpZHhdO1xuICAgIG9sZFBhcmVudCA9IG5vZGUucGFyZW50IHx8IG5vZGUucm9vdDtcbiAgICBwcmV2SWR4ID0gb2xkUGFyZW50ICYmIG9sZFBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5ld0VsZW1zW2lkeF0pO1xuXG4gICAgaWYgKG9sZFBhcmVudCAmJiBwcmV2SWR4ID4gLTEpIHtcbiAgICAgIG9sZFBhcmVudC5jaGlsZHJlbi5zcGxpY2UocHJldklkeCwgMSk7XG4gICAgICBpZiAocGFyZW50ID09PSBvbGRQYXJlbnQgJiYgc3BsaWNlSWR4ID4gcHJldklkeCkge1xuICAgICAgICBzcGxpY2VBcmdzWzBdLS07XG4gICAgICB9XG4gICAgfVxuXG4gICAgbm9kZS5yb290ID0gbnVsbDtcbiAgICBub2RlLnBhcmVudCA9IHBhcmVudDtcblxuICAgIGlmIChub2RlLnByZXYpIHtcbiAgICAgIG5vZGUucHJldi5uZXh0ID0gbm9kZS5uZXh0IHx8IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKG5vZGUubmV4dCkge1xuICAgICAgbm9kZS5uZXh0LnByZXYgPSBub2RlLnByZXYgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBub2RlLnByZXYgPSBuZXdFbGVtc1tpZHggLSAxXSB8fCBwcmV2O1xuICAgIG5vZGUubmV4dCA9IG5ld0VsZW1zW2lkeCArIDFdIHx8IG5leHQ7XG4gIH1cblxuICBpZiAocHJldikge1xuICAgIHByZXYubmV4dCA9IG5ld0VsZW1zWzBdO1xuICB9XG4gIGlmIChuZXh0KSB7XG4gICAgbmV4dC5wcmV2ID0gbmV3RWxlbXNbbmV3RWxlbXMubGVuZ3RoIC0gMV07XG4gIH1cbiAgcmV0dXJuIGFycmF5LnNwbGljZS5hcHBseShhcnJheSwgc3BsaWNlQXJncyk7XG59O1xuXG5leHBvcnRzLmFwcGVuZFRvID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG5cbiAgdGFyZ2V0LmFwcGVuZCh0aGlzKTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMucHJlcGVuZFRvID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG5cbiAgdGFyZ2V0LnByZXBlbmQodGhpcyk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmFwcGVuZCA9IF9pbnNlcnQoZnVuY3Rpb24oZG9tLCBjaGlsZHJlbiwgcGFyZW50KSB7XG4gIHVuaXF1ZVNwbGljZShjaGlsZHJlbiwgY2hpbGRyZW4ubGVuZ3RoLCAwLCBkb20sIHBhcmVudCk7XG59KTtcblxuZXhwb3J0cy5wcmVwZW5kID0gX2luc2VydChmdW5jdGlvbihkb20sIGNoaWxkcmVuLCBwYXJlbnQpIHtcbiAgdW5pcXVlU3BsaWNlKGNoaWxkcmVuLCAwLCAwLCBkb20sIHBhcmVudCk7XG59KTtcblxuZXhwb3J0cy53cmFwID0gZnVuY3Rpb24od3JhcHBlcikge1xuICB2YXIgd3JhcHBlckZuID0gdHlwZW9mIHdyYXBwZXIgPT09ICdmdW5jdGlvbicgJiYgd3JhcHBlcixcbiAgICAgIGxhc3RJZHggPSB0aGlzLmxlbmd0aCAtIDE7XG5cbiAgXy5mb3JFYWNoKHRoaXMsIF8uYmluZChmdW5jdGlvbihlbCwgaSkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdCxcbiAgICAgICAgc2libGluZ3MgPSBwYXJlbnQuY2hpbGRyZW4sXG4gICAgICAgIHdyYXBwZXJEb20sIGVsSW5zZXJ0TG9jYXRpb24sIGosIGluZGV4O1xuXG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAod3JhcHBlckZuKSB7XG4gICAgICB3cmFwcGVyID0gd3JhcHBlckZuLmNhbGwoZWwsIGkpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygd3JhcHBlciA9PT0gJ3N0cmluZycgJiYgIWlzSHRtbCh3cmFwcGVyKSkge1xuICAgICAgd3JhcHBlciA9IHRoaXMucGFyZW50cygpLmxhc3QoKS5maW5kKHdyYXBwZXIpLmNsb25lKCk7XG4gICAgfVxuXG4gICAgd3JhcHBlckRvbSA9IHRoaXMuX21ha2VEb21BcnJheSh3cmFwcGVyLCBpIDwgbGFzdElkeCkuc2xpY2UoMCwgMSk7XG4gICAgZWxJbnNlcnRMb2NhdGlvbiA9IHdyYXBwZXJEb21bMF07XG4gICAgLy8gRmluZCB0aGUgZGVlcGVzdCBjaGlsZC4gT25seSBjb25zaWRlciB0aGUgZmlyc3QgdGFnIGNoaWxkIG9mIGVhY2ggbm9kZVxuICAgIC8vIChpZ25vcmUgdGV4dCk7IHN0b3AgaWYgbm8gY2hpbGRyZW4gYXJlIGZvdW5kLlxuICAgIGogPSAwO1xuXG4gICAgd2hpbGUgKGVsSW5zZXJ0TG9jYXRpb24gJiYgZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbikge1xuICAgICAgaWYgKGogPj0gZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbEluc2VydExvY2F0aW9uLmNoaWxkcmVuW2pdLnR5cGUgPT09ICd0YWcnKSB7XG4gICAgICAgIGVsSW5zZXJ0TG9jYXRpb24gPSBlbEluc2VydExvY2F0aW9uLmNoaWxkcmVuW2pdO1xuICAgICAgICBqPTA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBqKys7XG4gICAgICB9XG4gICAgfVxuICAgIGluZGV4ID0gc2libGluZ3MuaW5kZXhPZihlbCk7XG5cbiAgICB1cGRhdGVET00oW2VsXSwgZWxJbnNlcnRMb2NhdGlvbik7XG4gICAgLy8gVGhlIHByZXZpb3VzIG9wZXJhdGlvbiByZW1vdmVkIHRoZSBjdXJyZW50IGVsZW1lbnQgZnJvbSB0aGUgYHNpYmxpbmdzYFxuICAgIC8vIGFycmF5LCBzbyB0aGUgYGRvbWAgYXJyYXkgY2FuIGJlIGluc2VydGVkIHdpdGhvdXQgcmVtb3ZpbmcgYW55XG4gICAgLy8gYWRkaXRpb25hbCBlbGVtZW50cy5cbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4LCAwLCB3cmFwcGVyRG9tLCBwYXJlbnQpO1xuICB9LCB0aGlzKSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmFmdGVyID0gZnVuY3Rpb24oKSB7XG4gIHZhciBlbGVtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKSxcbiAgICAgIGxhc3RJZHggPSB0aGlzLmxlbmd0aCAtIDE7XG5cbiAgZG9tRWFjaCh0aGlzLCBmdW5jdGlvbihpLCBlbCkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKSxcbiAgICAgICAgZG9tU3JjLCBkb207XG5cbiAgICAvLyBJZiBub3QgZm91bmQsIG1vdmUgb25cbiAgICBpZiAoaW5kZXggPCAwKSByZXR1cm47XG5cbiAgICBpZiAodHlwZW9mIGVsZW1zWzBdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkb21TcmMgPSBlbGVtc1swXS5jYWxsKGVsLCBpLCAkLmh0bWwoZWwuY2hpbGRyZW4pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tU3JjID0gZWxlbXM7XG4gICAgfVxuICAgIGRvbSA9IHRoaXMuX21ha2VEb21BcnJheShkb21TcmMsIGkgPCBsYXN0SWR4KTtcblxuICAgIC8vIEFkZCBlbGVtZW50IGFmdGVyIGB0aGlzYCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCArIDEsIDAsIGRvbSwgcGFyZW50KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmluc2VydEFmdGVyID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIHZhciBjbG9uZXMgPSBbXSxcbiAgICAgIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICB2YXIgY2xvbmVkU2VsZiA9IHNlbGYuX21ha2VEb21BcnJheShzZWxmLmNsb25lKCkpO1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIC8vIEFkZCBjbG9uZWQgYHRoaXNgIGVsZW1lbnQocykgYWZ0ZXIgdGFyZ2V0IGVsZW1lbnRcbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4ICsgMSwgMCwgY2xvbmVkU2VsZiwgcGFyZW50KTtcbiAgICBjbG9uZXMucHVzaChjbG9uZWRTZWxmKTtcbiAgfSk7XG4gIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGhpcy5fbWFrZURvbUFycmF5KGNsb25lcykpO1xufTtcblxuZXhwb3J0cy5iZWZvcmUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGVsZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMpLFxuICAgICAgbGFzdElkeCA9IHRoaXMubGVuZ3RoIC0gMTtcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudCB8fCBlbC5yb290O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuLFxuICAgICAgICBpbmRleCA9IHNpYmxpbmdzLmluZGV4T2YoZWwpLFxuICAgICAgICBkb21TcmMsIGRvbTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIGlmICh0eXBlb2YgZWxlbXNbMF0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGRvbVNyYyA9IGVsZW1zWzBdLmNhbGwoZWwsIGksICQuaHRtbChlbC5jaGlsZHJlbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb21TcmMgPSBlbGVtcztcbiAgICB9XG5cbiAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG5cbiAgICAvLyBBZGQgZWxlbWVudCBiZWZvcmUgYGVsYCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMCwgZG9tLCBwYXJlbnQpO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIHZhciBjbG9uZXMgPSBbXSxcbiAgICAgIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICB2YXIgY2xvbmVkU2VsZiA9IHNlbGYuX21ha2VEb21BcnJheShzZWxmLmNsb25lKCkpO1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIC8vIEFkZCBjbG9uZWQgYHRoaXNgIGVsZW1lbnQocykgYWZ0ZXIgdGFyZ2V0IGVsZW1lbnRcbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4LCAwLCBjbG9uZWRTZWxmLCBwYXJlbnQpO1xuICAgIGNsb25lcy5wdXNoKGNsb25lZFNlbGYpO1xuICB9KTtcbiAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IuY2FsbCh0aGlzLmNvbnN0cnVjdG9yLCB0aGlzLl9tYWtlRG9tQXJyYXkoY2xvbmVzKSk7XG59O1xuXG4vKlxuICByZW1vdmUoW3NlbGVjdG9yXSlcbiovXG5leHBvcnRzLnJlbW92ZSA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG4gIHZhciBlbGVtcyA9IHRoaXM7XG5cbiAgLy8gRmlsdGVyIGlmIHdlIGhhdmUgc2VsZWN0b3JcbiAgaWYgKHNlbGVjdG9yKVxuICAgIGVsZW1zID0gZWxlbXMuZmlsdGVyKHNlbGVjdG9yKTtcblxuICBkb21FYWNoKGVsZW1zLCBmdW5jdGlvbihpLCBlbCkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIHNpYmxpbmdzLnNwbGljZShpbmRleCwgMSk7XG4gICAgaWYgKGVsLnByZXYpIHtcbiAgICAgIGVsLnByZXYubmV4dCA9IGVsLm5leHQ7XG4gICAgfVxuICAgIGlmIChlbC5uZXh0KSB7XG4gICAgICBlbC5uZXh0LnByZXYgPSBlbC5wcmV2O1xuICAgIH1cbiAgICBlbC5wcmV2ID0gZWwubmV4dCA9IGVsLnBhcmVudCA9IGVsLnJvb3QgPSBudWxsO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMucmVwbGFjZVdpdGggPSBmdW5jdGlvbihjb250ZW50KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudCB8fCBlbC5yb290O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuLFxuICAgICAgICBkb20gPSBzZWxmLl9tYWtlRG9tQXJyYXkodHlwZW9mIGNvbnRlbnQgPT09ICdmdW5jdGlvbicgPyBjb250ZW50LmNhbGwoZWwsIGksIGVsKSA6IGNvbnRlbnQpLFxuICAgICAgICBpbmRleDtcblxuICAgIC8vIEluIHRoZSBjYXNlIHRoYXQgYGRvbWAgY29udGFpbnMgbm9kZXMgdGhhdCBhbHJlYWR5IGV4aXN0IGluIG90aGVyXG4gICAgLy8gc3RydWN0dXJlcywgZW5zdXJlIHRob3NlIG5vZGVzIGFyZSBwcm9wZXJseSByZW1vdmVkLlxuICAgIHVwZGF0ZURPTShkb20sIG51bGwpO1xuXG4gICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIENvbXBsZXRlbHkgcmVtb3ZlIG9sZCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMSwgZG9tLCBwYXJlbnQpO1xuICAgIGVsLnBhcmVudCA9IGVsLnByZXYgPSBlbC5uZXh0ID0gZWwucm9vdCA9IG51bGw7XG4gIH0pO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuZXhwb3J0cy5lbXB0eSA9IGZ1bmN0aW9uKCkge1xuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgXy5mb3JFYWNoKGVsLmNoaWxkcmVuLCBmdW5jdGlvbihjaGlsZCkge1xuICAgICAgY2hpbGQubmV4dCA9IGNoaWxkLnByZXYgPSBjaGlsZC5wYXJlbnQgPSBudWxsO1xuICAgIH0pO1xuXG4gICAgZWwuY2hpbGRyZW4ubGVuZ3RoID0gMDtcbiAgfSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBTZXQvR2V0IHRoZSBIVE1MXG4gKi9cbmV4cG9ydHMuaHRtbCA9IGZ1bmN0aW9uKHN0cikge1xuICBpZiAoc3RyID09PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIXRoaXNbMF0gfHwgIXRoaXNbMF0uY2hpbGRyZW4pIHJldHVybiBudWxsO1xuICAgIHJldHVybiAkLmh0bWwodGhpc1swXS5jaGlsZHJlbiwgdGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIHZhciBvcHRzID0gdGhpcy5vcHRpb25zO1xuXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICBfLmZvckVhY2goZWwuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgY29udGVudCA9IHN0ci5jaGVlcmlvID8gc3RyLmNsb25lKCkuZ2V0KCkgOiBldmFsdWF0ZSgnJyArIHN0ciwgb3B0cywgZmFsc2UpO1xuXG4gICAgdXBkYXRlRE9NKGNvbnRlbnQsIGVsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAkLmh0bWwodGhpcywgdGhpcy5vcHRpb25zKTtcbn07XG5cbmV4cG9ydHMudGV4dCA9IGZ1bmN0aW9uKHN0cikge1xuICAvLyBJZiBgc3RyYCBpcyB1bmRlZmluZWQsIGFjdCBhcyBhIFwiZ2V0dGVyXCJcbiAgaWYgKHN0ciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuICQudGV4dCh0aGlzKTtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc3RyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gRnVuY3Rpb24gc3VwcG9ydFxuICAgIHJldHVybiBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgICB2YXIgJGVsID0gW2VsXTtcbiAgICAgIHJldHVybiBleHBvcnRzLnRleHQuY2FsbCgkZWwsIHN0ci5jYWxsKGVsLCBpLCAkLnRleHQoJGVsKSkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQXBwZW5kIHRleHQgbm9kZSB0byBlYWNoIHNlbGVjdGVkIGVsZW1lbnRzXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICBfLmZvckVhY2goZWwuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgZWxlbSA9IHtcbiAgICAgIGRhdGE6ICcnICsgc3RyLFxuICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgcGFyZW50OiBlbCxcbiAgICAgIHByZXY6IG51bGwsXG4gICAgICBuZXh0OiBudWxsLFxuICAgICAgY2hpbGRyZW46IFtdXG4gICAgfTtcblxuICAgIHVwZGF0ZURPTShlbGVtLCBlbCk7XG4gIH0pO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuZXhwb3J0cy5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5fbWFrZShjbG9uZURvbSh0aGlzLmdldCgpLCB0aGlzLm9wdGlvbnMpKTtcbn07XG4iXX0=