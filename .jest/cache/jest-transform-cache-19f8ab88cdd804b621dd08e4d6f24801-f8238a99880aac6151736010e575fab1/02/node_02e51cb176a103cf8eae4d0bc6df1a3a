bfb321767d9a9e45bf895db360f92637
var tty = require('tty');

var util = require('util');

exports = module.exports = require("./debug");
exports.init = init;
exports.log = log;
exports.formatArgs = formatArgs;
exports.save = save;
exports.load = load;
exports.useColors = useColors;
exports.colors = [6, 2, 3, 4, 5, 1];
exports.inspectOpts = Object.keys(process.env).filter(function (key) {
  return /^debug_/i.test(key);
}).reduce(function (obj, key) {
  var prop = key.substring(6).toLowerCase().replace(/_([a-z])/g, function (_, k) {
    return k.toUpperCase();
  });
  var val = process.env[key];
  if (/^(yes|on|true|enabled)$/i.test(val)) val = true;else if (/^(no|off|false|disabled)$/i.test(val)) val = false;else if (val === 'null') val = null;else val = Number(val);
  obj[prop] = val;
  return obj;
}, {});
var fd = parseInt(process.env.DEBUG_FD, 10) || 2;

if (1 !== fd && 2 !== fd) {
  util.deprecate(function () {}, 'except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)')();
}

var stream = 1 === fd ? process.stdout : 2 === fd ? process.stderr : createWritableStdioStream(fd);

function useColors() {
  return 'colors' in exports.inspectOpts ? Boolean(exports.inspectOpts.colors) : tty.isatty(fd);
}

exports.formatters.o = function (v) {
  this.inspectOpts.colors = this.useColors;
  return util.inspect(v, this.inspectOpts).split('\n').map(function (str) {
    return str.trim();
  }).join(' ');
};

exports.formatters.O = function (v) {
  this.inspectOpts.colors = this.useColors;
  return util.inspect(v, this.inspectOpts);
};

function formatArgs(args) {
  var name = this.namespace;
  var useColors = this.useColors;

  if (useColors) {
    var c = this.color;
    var prefix = "  \x1B[3" + c + ';1m' + name + ' ' + "\x1B[0m";
    args[0] = prefix + args[0].split('\n').join('\n' + prefix);
    args.push("\x1B[3" + c + 'm+' + exports.humanize(this.diff) + "\x1B[0m");
  } else {
    args[0] = new Date().toUTCString() + ' ' + name + ' ' + args[0];
  }
}

function log() {
  return stream.write(util.format.apply(util, arguments) + '\n');
}

function save(namespaces) {
  if (null == namespaces) {
    delete process.env.DEBUG;
  } else {
    process.env.DEBUG = namespaces;
  }
}

function load() {
  return process.env.DEBUG;
}

function createWritableStdioStream(fd) {
  var stream;
  var tty_wrap = process.binding('tty_wrap');

  switch (tty_wrap.guessHandleType(fd)) {
    case 'TTY':
      stream = new tty.WriteStream(fd);
      stream._type = 'tty';

      if (stream._handle && stream._handle.unref) {
        stream._handle.unref();
      }

      break;

    case 'FILE':
      var fs = require('fs');

      stream = new fs.SyncWriteStream(fd, {
        autoClose: false
      });
      stream._type = 'fs';
      break;

    case 'PIPE':
    case 'TCP':
      var net = require('net');

      stream = new net.Socket({
        fd: fd,
        readable: false,
        writable: true
      });
      stream.readable = false;
      stream.read = null;
      stream._type = 'pipe';

      if (stream._handle && stream._handle.unref) {
        stream._handle.unref();
      }

      break;

    default:
      throw new Error('Implement me. Unknown stream file type!');
  }

  stream.fd = fd;
  stream._isStdio = true;
  return stream;
}

function init(debug) {
  debug.inspectOpts = {};
  var keys = Object.keys(exports.inspectOpts);

  for (var i = 0; i < keys.length; i++) {
    debug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];
  }
}

exports.enable(load());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGUuanMiXSwibmFtZXMiOlsidHR5IiwicmVxdWlyZSIsInV0aWwiLCJleHBvcnRzIiwibW9kdWxlIiwiaW5pdCIsImxvZyIsImZvcm1hdEFyZ3MiLCJzYXZlIiwibG9hZCIsInVzZUNvbG9ycyIsImNvbG9ycyIsImluc3BlY3RPcHRzIiwiT2JqZWN0Iiwia2V5cyIsInByb2Nlc3MiLCJlbnYiLCJmaWx0ZXIiLCJrZXkiLCJ0ZXN0IiwicmVkdWNlIiwib2JqIiwicHJvcCIsInN1YnN0cmluZyIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsIl8iLCJrIiwidG9VcHBlckNhc2UiLCJ2YWwiLCJOdW1iZXIiLCJmZCIsInBhcnNlSW50IiwiREVCVUdfRkQiLCJkZXByZWNhdGUiLCJzdHJlYW0iLCJzdGRvdXQiLCJzdGRlcnIiLCJjcmVhdGVXcml0YWJsZVN0ZGlvU3RyZWFtIiwiQm9vbGVhbiIsImlzYXR0eSIsImZvcm1hdHRlcnMiLCJvIiwidiIsImluc3BlY3QiLCJzcGxpdCIsIm1hcCIsInN0ciIsInRyaW0iLCJqb2luIiwiTyIsImFyZ3MiLCJuYW1lIiwibmFtZXNwYWNlIiwiYyIsImNvbG9yIiwicHJlZml4IiwicHVzaCIsImh1bWFuaXplIiwiZGlmZiIsIkRhdGUiLCJ0b1VUQ1N0cmluZyIsIndyaXRlIiwiZm9ybWF0IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJuYW1lc3BhY2VzIiwiREVCVUciLCJ0dHlfd3JhcCIsImJpbmRpbmciLCJndWVzc0hhbmRsZVR5cGUiLCJXcml0ZVN0cmVhbSIsIl90eXBlIiwiX2hhbmRsZSIsInVucmVmIiwiZnMiLCJTeW5jV3JpdGVTdHJlYW0iLCJhdXRvQ2xvc2UiLCJuZXQiLCJTb2NrZXQiLCJyZWFkYWJsZSIsIndyaXRhYmxlIiwicmVhZCIsIkVycm9yIiwiX2lzU3RkaW8iLCJkZWJ1ZyIsImkiLCJsZW5ndGgiLCJlbmFibGUiXSwibWFwcGluZ3MiOiJBQUlBLElBQUlBLEdBQUcsR0FBR0MsT0FBTyxDQUFDLEtBQUQs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TyxDQUFDUyxXQUFwQixDQUFYOztBQUNBLE9BQUssSUFBSTBFLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUd4RSxJQUFJLENBQUN5RSxNQUF6QixFQUFpQ0QsQ0FBQyxFQUFsQyxFQUFzQztBQUNwQ0QsSUFBQUEsS0FBSyxDQUFDekUsV0FBTixDQUFrQkUsSUFBSSxDQUFDd0UsQ0FBRCxDQUF0QixJQUE2Qm5GLE9BQU8sQ0FBQ1MsV0FBUixDQUFvQkUsSUFBSSxDQUFDd0UsQ0FBRCxDQUF4QixDQUE3QjtBQUNEO0FBQ0Y7O0FBTURuRixPQUFPLENBQUNxRixNQUFSLENBQWUvRSxJQUFJLEVBQW5CIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2R1bGUgZGVwZW5kZW5jaWVzLlxuICovXG5cbnZhciB0dHkgPSByZXF1aXJlKCd0dHknKTtcbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuXG4vKipcbiAqIFRoaXMgaXMgdGhlIE5vZGUuanMgaW1wbGVtZW50YXRpb24gb2YgYGRlYnVnKClgLlxuICpcbiAqIEV4cG9zZSBgZGVidWcoKWAgYXMgdGhlIG1vZHVsZS5cbiAqL1xuXG5leHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL2RlYnVnJyk7XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZXhwb3J0cy5sb2cgPSBsb2c7XG5leHBvcnRzLmZvcm1hdEFyZ3MgPSBmb3JtYXRBcmdzO1xuZXhwb3J0cy5zYXZlID0gc2F2ZTtcbmV4cG9ydHMubG9hZCA9IGxvYWQ7XG5leHBvcnRzLnVzZUNvbG9ycyA9IHVzZUNvbG9ycztcblxuLyoqXG4gKiBDb2xvcnMuXG4gKi9cblxuZXhwb3J0cy5jb2xvcnMgPSBbNiwgMiwgMywgNCwgNSwgMV07XG5cbi8qKlxuICogQnVpbGQgdXAgdGhlIGRlZmF1bHQgYGluc3BlY3RPcHRzYCBvYmplY3QgZnJvbSB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzLlxuICpcbiAqICAgJCBERUJVR19DT0xPUlM9bm8gREVCVUdfREVQVEg9MTAgREVCVUdfU0hPV19ISURERU49ZW5hYmxlZCBub2RlIHNjcmlwdC5qc1xuICovXG5cbmV4cG9ydHMuaW5zcGVjdE9wdHMgPSBPYmplY3Qua2V5cyhwcm9jZXNzLmVudikuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHtcbiAgcmV0dXJuIC9eZGVidWdfL2kudGVzdChrZXkpO1xufSkucmVkdWNlKGZ1bmN0aW9uIChvYmosIGtleSkge1xuICAvLyBjYW1lbC1jYXNlXG4gIHZhciBwcm9wID0ga2V5XG4gICAgLnN1YnN0cmluZyg2KVxuICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgLnJlcGxhY2UoL18oW2Etel0pL2csIGZ1bmN0aW9uIChfLCBrKSB7IHJldHVybiBrLnRvVXBwZXJDYXNlKCkgfSk7XG5cbiAgLy8gY29lcmNlIHN0cmluZyB2YWx1ZSBpbnRvIEpTIHZhbHVlXG4gIHZhciB2YWwgPSBwcm9jZXNzLmVudltrZXldO1xuICBpZiAoL14oeWVzfG9ufHRydWV8ZW5hYmxlZCkkL2kudGVzdCh2YWwpKSB2YWwgPSB0cnVlO1xuICBlbHNlIGlmICgvXihub3xvZmZ8ZmFsc2V8ZGlzYWJsZWQpJC9pLnRlc3QodmFsKSkgdmFsID0gZmFsc2U7XG4gIGVsc2UgaWYgKHZhbCA9PT0gJ251bGwnKSB2YWwgPSBudWxsO1xuICBlbHNlIHZhbCA9IE51bWJlcih2YWwpO1xuXG4gIG9ialtwcm9wXSA9IHZhbDtcbiAgcmV0dXJuIG9iajtcbn0sIHt9KTtcblxuLyoqXG4gKiBUaGUgZmlsZSBkZXNjcmlwdG9yIHRvIHdyaXRlIHRoZSBgZGVidWcoKWAgY2FsbHMgdG8uXG4gKiBTZXQgdGhlIGBERUJVR19GRGAgZW52IHZhcmlhYmxlIHRvIG92ZXJyaWRlIHdpdGggYW5vdGhlciB2YWx1ZS4gaS5lLjpcbiAqXG4gKiAgICQgREVCVUdfRkQ9MyBub2RlIHNjcmlwdC5qcyAzPmRlYnVnLmxvZ1xuICovXG5cbnZhciBmZCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LkRFQlVHX0ZELCAxMCkgfHwgMjtcblxuaWYgKDEgIT09IGZkICYmIDIgIT09IGZkKSB7XG4gIHV0aWwuZGVwcmVjYXRlKGZ1bmN0aW9uKCl7fSwgJ2V4Y2VwdCBmb3Igc3RkZXJyKDIpIGFuZCBzdGRvdXQoMSksIGFueSBvdGhlciB1c2FnZSBvZiBERUJVR19GRCBpcyBkZXByZWNhdGVkLiBPdmVycmlkZSBkZWJ1Zy5sb2cgaWYgeW91IHdhbnQgdG8gdXNlIGEgZGlmZmVyZW50IGxvZyBmdW5jdGlvbiAoaHR0cHM6Ly9naXQuaW8vZGVidWdfZmQpJykoKVxufVxuXG52YXIgc3RyZWFtID0gMSA9PT0gZmQgPyBwcm9jZXNzLnN0ZG91dCA6XG4gICAgICAgICAgICAgMiA9PT0gZmQgPyBwcm9jZXNzLnN0ZGVyciA6XG4gICAgICAgICAgICAgY3JlYXRlV3JpdGFibGVTdGRpb1N0cmVhbShmZCk7XG5cbi8qKlxuICogSXMgc3Rkb3V0IGEgVFRZPyBDb2xvcmVkIG91dHB1dCBpcyBlbmFibGVkIHdoZW4gYHRydWVgLlxuICovXG5cbmZ1bmN0aW9uIHVzZUNvbG9ycygpIHtcbiAgcmV0dXJuICdjb2xvcnMnIGluIGV4cG9ydHMuaW5zcGVjdE9wdHNcbiAgICA/IEJvb2xlYW4oZXhwb3J0cy5pbnNwZWN0T3B0cy5jb2xvcnMpXG4gICAgOiB0dHkuaXNhdHR5KGZkKTtcbn1cblxuLyoqXG4gKiBNYXAgJW8gdG8gYHV0aWwuaW5zcGVjdCgpYCwgYWxsIG9uIGEgc2luZ2xlIGxpbmUuXG4gKi9cblxuZXhwb3J0cy5mb3JtYXR0ZXJzLm8gPSBmdW5jdGlvbih2KSB7XG4gIHRoaXMuaW5zcGVjdE9wdHMuY29sb3JzID0gdGhpcy51c2VDb2xvcnM7XG4gIHJldHVybiB1dGlsLmluc3BlY3QodiwgdGhpcy5pbnNwZWN0T3B0cylcbiAgICAuc3BsaXQoJ1xcbicpLm1hcChmdW5jdGlvbihzdHIpIHtcbiAgICAgIHJldHVybiBzdHIudHJpbSgpXG4gICAgfSkuam9pbignICcpO1xufTtcblxuLyoqXG4gKiBNYXAgJW8gdG8gYHV0aWwuaW5zcGVjdCgpYCwgYWxsb3dpbmcgbXVsdGlwbGUgbGluZXMgaWYgbmVlZGVkLlxuICovXG5cbmV4cG9ydHMuZm9ybWF0dGVycy5PID0gZnVuY3Rpb24odikge1xuICB0aGlzLmluc3BlY3RPcHRzLmNvbG9ycyA9IHRoaXMudXNlQ29sb3JzO1xuICByZXR1cm4gdXRpbC5pbnNwZWN0KHYsIHRoaXMuaW5zcGVjdE9wdHMpO1xufTtcblxuLyoqXG4gKiBBZGRzIEFOU0kgY29sb3IgZXNjYXBlIGNvZGVzIGlmIGVuYWJsZWQuXG4gKlxuICogQGFwaSBwdWJsaWNcbiAqL1xuXG5mdW5jdGlvbiBmb3JtYXRBcmdzKGFyZ3MpIHtcbiAgdmFyIG5hbWUgPSB0aGlzLm5hbWVzcGFjZTtcbiAgdmFyIHVzZUNvbG9ycyA9IHRoaXMudXNlQ29sb3JzO1xuXG4gIGlmICh1c2VDb2xvcnMpIHtcbiAgICB2YXIgYyA9IHRoaXMuY29sb3I7XG4gICAgdmFyIHByZWZpeCA9ICcgIFxcdTAwMWJbMycgKyBjICsgJzsxbScgKyBuYW1lICsgJyAnICsgJ1xcdTAwMWJbMG0nO1xuXG4gICAgYXJnc1swXSA9IHByZWZpeCArIGFyZ3NbMF0uc3BsaXQoJ1xcbicpLmpvaW4oJ1xcbicgKyBwcmVmaXgpO1xuICAgIGFyZ3MucHVzaCgnXFx1MDAxYlszJyArIGMgKyAnbSsnICsgZXhwb3J0cy5odW1hbml6ZSh0aGlzLmRpZmYpICsgJ1xcdTAwMWJbMG0nKTtcbiAgfSBlbHNlIHtcbiAgICBhcmdzWzBdID0gbmV3IERhdGUoKS50b1VUQ1N0cmluZygpXG4gICAgICArICcgJyArIG5hbWUgKyAnICcgKyBhcmdzWzBdO1xuICB9XG59XG5cbi8qKlxuICogSW52b2tlcyBgdXRpbC5mb3JtYXQoKWAgd2l0aCB0aGUgc3BlY2lmaWVkIGFyZ3VtZW50cyBhbmQgd3JpdGVzIHRvIGBzdHJlYW1gLlxuICovXG5cbmZ1bmN0aW9uIGxvZygpIHtcbiAgcmV0dXJuIHN0cmVhbS53cml0ZSh1dGlsLmZvcm1hdC5hcHBseSh1dGlsLCBhcmd1bWVudHMpICsgJ1xcbicpO1xufVxuXG4vKipcbiAqIFNhdmUgYG5hbWVzcGFjZXNgLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lc3BhY2VzXG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5mdW5jdGlvbiBzYXZlKG5hbWVzcGFjZXMpIHtcbiAgaWYgKG51bGwgPT0gbmFtZXNwYWNlcykge1xuICAgIC8vIElmIHlvdSBzZXQgYSBwcm9jZXNzLmVudiBmaWVsZCB0byBudWxsIG9yIHVuZGVmaW5lZCwgaXQgZ2V0cyBjYXN0IHRvIHRoZVxuICAgIC8vIHN0cmluZyAnbnVsbCcgb3IgJ3VuZGVmaW5lZCcuIEp1c3QgZGVsZXRlIGluc3RlYWQuXG4gICAgZGVsZXRlIHByb2Nlc3MuZW52LkRFQlVHO1xuICB9IGVsc2Uge1xuICAgIHByb2Nlc3MuZW52LkRFQlVHID0gbmFtZXNwYWNlcztcbiAgfVxufVxuXG4vKipcbiAqIExvYWQgYG5hbWVzcGFjZXNgLlxuICpcbiAqIEByZXR1cm4ge1N0cmluZ30gcmV0dXJucyB0aGUgcHJldmlvdXNseSBwZXJzaXN0ZWQgZGVidWcgbW9kZXNcbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmZ1bmN0aW9uIGxvYWQoKSB7XG4gIHJldHVybiBwcm9jZXNzLmVudi5ERUJVRztcbn1cblxuLyoqXG4gKiBDb3BpZWQgZnJvbSBgbm9kZS9zcmMvbm9kZS5qc2AuXG4gKlxuICogWFhYOiBJdCdzIGxhbWUgdGhhdCBub2RlIGRvZXNuJ3QgZXhwb3NlIHRoaXMgQVBJIG91dC1vZi10aGUtYm94LiBJdCBhbHNvXG4gKiByZWxpZXMgb24gdGhlIHVuZG9jdW1lbnRlZCBgdHR5X3dyYXAuZ3Vlc3NIYW5kbGVUeXBlKClgIHdoaWNoIGlzIGFsc28gbGFtZS5cbiAqL1xuXG5mdW5jdGlvbiBjcmVhdGVXcml0YWJsZVN0ZGlvU3RyZWFtIChmZCkge1xuICB2YXIgc3RyZWFtO1xuICB2YXIgdHR5X3dyYXAgPSBwcm9jZXNzLmJpbmRpbmcoJ3R0eV93cmFwJyk7XG5cbiAgLy8gTm90ZSBzdHJlYW0uX3R5cGUgaXMgdXNlZCBmb3IgdGVzdC1tb2R1bGUtbG9hZC1saXN0LmpzXG5cbiAgc3dpdGNoICh0dHlfd3JhcC5ndWVzc0hhbmRsZVR5cGUoZmQpKSB7XG4gICAgY2FzZSAnVFRZJzpcbiAgICAgIHN0cmVhbSA9IG5ldyB0dHkuV3JpdGVTdHJlYW0oZmQpO1xuICAgICAgc3RyZWFtLl90eXBlID0gJ3R0eSc7XG5cbiAgICAgIC8vIEhhY2sgdG8gaGF2ZSBzdHJlYW0gbm90IGtlZXAgdGhlIGV2ZW50IGxvb3AgYWxpdmUuXG4gICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2pveWVudC9ub2RlL2lzc3Vlcy8xNzI2XG4gICAgICBpZiAoc3RyZWFtLl9oYW5kbGUgJiYgc3RyZWFtLl9oYW5kbGUudW5yZWYpIHtcbiAgICAgICAgc3RyZWFtLl9oYW5kbGUudW5yZWYoKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnRklMRSc6XG4gICAgICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xuICAgICAgc3RyZWFtID0gbmV3IGZzLlN5bmNXcml0ZVN0cmVhbShmZCwgeyBhdXRvQ2xvc2U6IGZhbHNlIH0pO1xuICAgICAgc3RyZWFtLl90eXBlID0gJ2ZzJztcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnUElQRSc6XG4gICAgY2FzZSAnVENQJzpcbiAgICAgIHZhciBuZXQgPSByZXF1aXJlKCduZXQnKTtcbiAgICAgIHN0cmVhbSA9IG5ldyBuZXQuU29ja2V0KHtcbiAgICAgICAgZmQ6IGZkLFxuICAgICAgICByZWFkYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgLy8gRklYTUUgU2hvdWxkIHByb2JhYmx5IGhhdmUgYW4gb3B0aW9uIGluIG5ldC5Tb2NrZXQgdG8gY3JlYXRlIGFcbiAgICAgIC8vIHN0cmVhbSBmcm9tIGFuIGV4aXN0aW5nIGZkIHdoaWNoIGlzIHdyaXRhYmxlIG9ubHkuIEJ1dCBmb3Igbm93XG4gICAgICAvLyB3ZSdsbCBqdXN0IGFkZCB0aGlzIGhhY2sgYW5kIHNldCB0aGUgYHJlYWRhYmxlYCBtZW1iZXIgdG8gZmFsc2UuXG4gICAgICAvLyBUZXN0OiAuL25vZGUgdGVzdC9maXh0dXJlcy9lY2hvLmpzIDwgL2V0Yy9wYXNzd2RcbiAgICAgIHN0cmVhbS5yZWFkYWJsZSA9IGZhbHNlO1xuICAgICAgc3RyZWFtLnJlYWQgPSBudWxsO1xuICAgICAgc3RyZWFtLl90eXBlID0gJ3BpcGUnO1xuXG4gICAgICAvLyBGSVhNRSBIYWNrIHRvIGhhdmUgc3RyZWFtIG5vdCBrZWVwIHRoZSBldmVudCBsb29wIGFsaXZlLlxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9qb3llbnQvbm9kZS9pc3N1ZXMvMTcyNlxuICAgICAgaWYgKHN0cmVhbS5faGFuZGxlICYmIHN0cmVhbS5faGFuZGxlLnVucmVmKSB7XG4gICAgICAgIHN0cmVhbS5faGFuZGxlLnVucmVmKCk7XG4gICAgICB9XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICAvLyBQcm9iYWJseSBhbiBlcnJvciBvbiBpbiB1dl9ndWVzc19oYW5kbGUoKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBsZW1lbnQgbWUuIFVua25vd24gc3RyZWFtIGZpbGUgdHlwZSEnKTtcbiAgfVxuXG4gIC8vIEZvciBzdXBwb3J0aW5nIGxlZ2FjeSBBUEkgd2UgcHV0IHRoZSBGRCBoZXJlLlxuICBzdHJlYW0uZmQgPSBmZDtcblxuICBzdHJlYW0uX2lzU3RkaW8gPSB0cnVlO1xuXG4gIHJldHVybiBzdHJlYW07XG59XG5cbi8qKlxuICogSW5pdCBsb2dpYyBmb3IgYGRlYnVnYCBpbnN0YW5jZXMuXG4gKlxuICogQ3JlYXRlIGEgbmV3IGBpbnNwZWN0T3B0c2Agb2JqZWN0IGluIGNhc2UgYHVzZUNvbG9yc2AgaXMgc2V0XG4gKiBkaWZmZXJlbnRseSBmb3IgYSBwYXJ0aWN1bGFyIGBkZWJ1Z2AgaW5zdGFuY2UuXG4gKi9cblxuZnVuY3Rpb24gaW5pdCAoZGVidWcpIHtcbiAgZGVidWcuaW5zcGVjdE9wdHMgPSB7fTtcblxuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGV4cG9ydHMuaW5zcGVjdE9wdHMpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBkZWJ1Zy5pbnNwZWN0T3B0c1trZXlzW2ldXSA9IGV4cG9ydHMuaW5zcGVjdE9wdHNba2V5c1tpXV07XG4gIH1cbn1cblxuLyoqXG4gKiBFbmFibGUgbmFtZXNwYWNlcyBsaXN0ZWQgaW4gYHByb2Nlc3MuZW52LkRFQlVHYCBpbml0aWFsbHkuXG4gKi9cblxuZXhwb3J0cy5lbmFibGUobG9hZCgpKTtcbiJdfQ==