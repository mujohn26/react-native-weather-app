1ad4671806fff7d94aabf9cdd9bedd62
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = sequenceOfValidator;

var _propTypes = require("prop-types");

var _and = _interopRequireDefault(require("./and"));

var _between = _interopRequireDefault(require("./between"));

var _nonNegativeInteger = _interopRequireDefault(require("./nonNegativeInteger"));

var _object = _interopRequireDefault(require("./object"));

var _withShape = _interopRequireDefault(require("./withShape"));

var _typeOf = _interopRequireDefault(require("./helpers/typeOf"));

var _wrapValidator = _interopRequireDefault(require("./helpers/wrapValidator"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var minValidator = _nonNegativeInteger["default"];
var maxValidator = (0, _and["default"])([_nonNegativeInteger["default"], (0, _between["default"])({
  gte: 1
})]);

function validateRange(min, max) {
  if (typeof max !== 'number' || typeof min !== 'number') {
    return null;
  }

  if (min <= max) {
    return null;
  }

  return new RangeError('min must be less than or equal to max');
}

var specifierShape = {
  validator: function validator(props, propName) {
    var propValue = props[propName];

    if (typeof propValue !== 'function') {
      return new TypeError('"validator" must be a propType validator function');
    }

    return null;
  },
  min: function min(props, propName) {
    return minValidator(props, propName) || validateRange(props.min, props.max);
  },
  max: function max(props, propName) {
    return maxValidator(props, propName) || validateRange(props.min, props.max);
  }
};

function getMinMax(_ref) {
  var min = _ref.min,
      max = _ref.max;
  var minimum;
  var maximum;

  if (typeof min !== 'number' && typeof max !== 'number') {
    minimum = 1;
    maximum = 1;
  } else {
    minimum = typeof min === 'number' ? min : 1;
    maximum = typeof max === 'number' ? max : Infinity;
  }

  return {
    minimum: minimum,
    maximum: maximum
  };
}

function chunkByType(items) {
  var chunk = [];
  var lastType;
  return items.reduce(function (chunks, item) {
    var itemType = (0, _typeOf["default"])(item);

    if (!lastType || itemType === lastType) {
      chunk.push(item);
    } else {
      chunks.push(chunk);
      chunk = [item];
    }

    lastType = itemType;
    return chunks;
  }, []).concat(chunk.length > 0 ? [chunk] : []);
}

function validateChunks(specifiers, props, propName, componentName) {
  var items = props[propName];
  var chunks = chunkByType(items);

  for (var _len = arguments.length, rest = new Array(_len > 4 ? _len - 4 : 0), _key = 4; _key < _len; _key++) {
    rest[_key - 4] = arguments[_key];
  }

  for (var i = 0; i < specifiers.length; i += 1) {
    var _specifiers$i = specifiers[i],
        validator = _specifiers$i.validator,
        min = _specifiers$i.min,
        max = _specifiers$i.max;

    var _getMinMax = getMinMax({
      min: min,
      max: max
    }),
        minimum = _getMinMax.minimum,
        maximum = _getMinMax.maximum;

    if (chunks.length === 0 && minimum === 0) {
      continue;
    }

    var arrayOfValidator = (0, _propTypes.arrayOf)(validator).isRequired;
    var chunk = chunks.shift();
    var chunkError = arrayOfValidator.apply(void 0, [_objectSpread(_objectSpread({}, props), {}, _defineProperty({}, propName, chunk)), propName, componentName].concat(rest));

    if (chunkError) {
      if (minimum === 0) {
        chunks.unshift(chunk);
        continue;
      }

      return chunkError;
    }

    if (chunk.length < minimum) {
      return new RangeError("".concat(componentName, ": specifier index ").concat(i, " requires a minimum of ").concat(min, " items, but only has ").concat(chunk.length, "."));
    }

    if (chunk.length > maximum) {
      return new RangeError("".concat(componentName, ": specifier index ").concat(i, " requires a maximum of ").concat(max, " items, but has ").concat(chunk.length, "."));
    }
  }

  if (chunks.length > 0) {
    return new TypeError("".concat(componentName, ": after all ").concat(specifiers.length, " specifiers matched, ").concat(chunks.length, " types of items were remaining."));
  }

  return null;
}

var specifierValidator = (0, _withShape["default"])((0, _object["default"])(), specifierShape).isRequired;

function sequenceOfValidator() {
  for (var _len2 = arguments.length, specifiers = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
    specifiers[_key2] = arguments[_key2];
  }

  if (specifiers.length === 0) {
    throw new RangeError('sequenceOf: at least one specifier is required');
  }

  var errors = specifiers.map(function (specifier, i) {
    return specifierValidator({
      specifier: specifier
    }, 'specifier', 'sequenceOf specifier', "suequenceOf specifier, index ".concat(i), "specifier, index ".concat(i));
  });

  if (errors.some(Boolean)) {
    throw new TypeError("\n      sequenceOf: all specifiers must match the appropriate shape.\n\n      Errors:\n        ".concat(errors.map(function (e, i) {
      return " - Argument index ".concat(i, ": ").concat(e.message);
    }).join(',\n        '), "\n    "));
  }

  var validator = function sequenceOf(props, propName) {
    var propValue = props[propName];

    if (propValue == null) {
      return null;
    }

    for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {
      rest[_key3 - 2] = arguments[_key3];
    }

    var error = _propTypes.array.apply(void 0, [props, propName].concat(rest));

    if (error) {
      return error;
    }

    return validateChunks.apply(void 0, [specifiers, props, propName].concat(rest));
  };

  validator.isRequired = function sequenceOfRequired(props, propName, componentName) {
    for (var _len4 = arguments.length, rest = new Array(_len4 > 3 ? _len4 - 3 : 0), _key4 = 3; _key4 < _len4; _key4++) {
      rest[_key4 - 3] = arguments[_key4];
    }

    var error = _propTypes.array.isRequired.apply(_propTypes.array, [props, propName, componentName].concat(rest));

    if (error) {
      return error;
    }

    return validateChunks.apply(void 0, [specifiers, props, propName, componentName].concat(rest));
  };

  return (0, _wrapValidator["default"])(validator, 'sequenceOf', specifiers);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXF1ZW5jZU9mLmpzIl0sIm5hbWVzIjpbIm1pblZhbGlkYXRvciIsIm5vbk5lZ2F0aXZlSW50ZWdlciIsIm1heFZhbGlkYXRvciIsImd0ZSIsIm1pbiIsInNwZWNpZmllclNoYXBlIiwidmFsaWRhdG9yIiwicHJvcFZhbHVlIiwicHJvcHMiLCJ2YWxpZGF0ZVJhbmdlIiwibWF4IiwibWluaW11bSIsIm1heGltdW0iLCJjaHVuayIsIml0ZW1UeXBlIiwiY2h1bmtzIiwibGFzdFR5cGUiLCJyZXN0IiwiaXRlbXMiLCJjaHVua0J5VHlwZSIsImkiLCJzcGVjaWZpZXJzIiwiZ2V0TWluTWF4IiwiYXJyYXlPZlZhbGlkYXRvciIsImNodW5rRXJyb3IiLCJzcGVjaWZpZXJWYWxpZGF0b3IiLCJlcnJvcnMiLCJzcGVjaWZpZXIiLCJlIiwiZXJyb3IiLCJhcnJheSIsInZhbGlkYXRlQ2h1bmtzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsSUFBQSxVQUFBLEdBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQTs7QUFFQSxJQUFBLElBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsU0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxhQUFBLENBQUE7O0FBQ0EsSUFBQSxtQkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSx3QkFBQSxDQUFBOztBQUNBLElBQUEsT0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxZQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLGVBQUEsQ0FBQTs7QUFDQSxJQUFBLE9BQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsb0JBQUEsQ0FBQTs7QUFDQSxJQUFBLGNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsMkJBQUEsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsWUFBWSxHQUFHQyxtQkFBQUEsQ0FB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QWQ7O0FBQ0EsUUFBQSxLQUFBLEVBQVc7QUFDVCxhQUFBLEtBQUE7QUFDRDs7QUFFRCxXQUFPQyxjQUFjLENBQWRBLEtBQUFBLENBQUFBLEtBQUFBLENBQUFBLEVBQUFBLENBQUFBLFVBQUFBLEVBQUFBLEtBQUFBLEVBQUFBLFFBQUFBLEVBQUFBLGFBQUFBLEVBQUFBLE1BQUFBLENBQVAsSUFBT0EsQ0FBQUEsQ0FBUDtBQU5GekIsR0FBQUE7O0FBU0EsU0FBTyxDQUFBLEdBQUEsY0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxZQUFBLEVBQVAsVUFBTyxDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcnJheSwgYXJyYXlPZiB9IGZyb20gJ3Byb3AtdHlwZXMnO1xuXG5pbXBvcnQgYW5kIGZyb20gJy4vYW5kJztcbmltcG9ydCBiZXR3ZWVuIGZyb20gJy4vYmV0d2Vlbic7XG5pbXBvcnQgbm9uTmVnYXRpdmVJbnRlZ2VyIGZyb20gJy4vbm9uTmVnYXRpdmVJbnRlZ2VyJztcbmltcG9ydCBvYmplY3QgZnJvbSAnLi9vYmplY3QnO1xuaW1wb3J0IHdpdGhTaGFwZSBmcm9tICcuL3dpdGhTaGFwZSc7XG5pbXBvcnQgdHlwZU9mIGZyb20gJy4vaGVscGVycy90eXBlT2YnO1xuaW1wb3J0IHdyYXBWYWxpZGF0b3IgZnJvbSAnLi9oZWxwZXJzL3dyYXBWYWxpZGF0b3InO1xuXG5jb25zdCBtaW5WYWxpZGF0b3IgPSBub25OZWdhdGl2ZUludGVnZXI7XG5jb25zdCBtYXhWYWxpZGF0b3IgPSBhbmQoW25vbk5lZ2F0aXZlSW50ZWdlciwgYmV0d2Vlbih7IGd0ZTogMSB9KV0pO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZVJhbmdlKG1pbiwgbWF4KSB7XG4gIGlmICh0eXBlb2YgbWF4ICE9PSAnbnVtYmVyJyB8fCB0eXBlb2YgbWluICE9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiBudWxsOyAvLyBubyBhZGRpdGlvbmFsIGNoZWNraW5nIG5lZWRlZCB1bmxlc3MgYm90aCBhcmUgcHJlc2VudFxuICB9XG5cbiAgaWYgKG1pbiA8PSBtYXgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gbmV3IFJhbmdlRXJyb3IoJ21pbiBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byBtYXgnKTtcbn1cblxuY29uc3Qgc3BlY2lmaWVyU2hhcGUgPSB7XG4gIHZhbGlkYXRvcihwcm9wcywgcHJvcE5hbWUpIHtcbiAgICBjb25zdCB7IFtwcm9wTmFtZV06IHByb3BWYWx1ZSB9ID0gcHJvcHM7XG4gICAgaWYgKHR5cGVvZiBwcm9wVmFsdWUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCdcInZhbGlkYXRvclwiIG11c3QgYmUgYSBwcm9wVHlwZSB2YWxpZGF0b3IgZnVuY3Rpb24nKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG5cbiAgbWluKHByb3BzLCBwcm9wTmFtZSkge1xuICAgIHJldHVybiBtaW5WYWxpZGF0b3IocHJvcHMsIHByb3BOYW1lKSB8fCB2YWxpZGF0ZVJhbmdlKHByb3BzLm1pbiwgcHJvcHMubWF4KTtcbiAgfSxcblxuICBtYXgocHJvcHMsIHByb3BOYW1lKSB7XG4gICAgcmV0dXJuIG1heFZhbGlkYXRvcihwcm9wcywgcHJvcE5hbWUpIHx8IHZhbGlkYXRlUmFuZ2UocHJvcHMubWluLCBwcm9wcy5tYXgpO1xuICB9LFxufTtcblxuZnVuY3Rpb24gZ2V0TWluTWF4KHsgbWluLCBtYXggfSkge1xuICBsZXQgbWluaW11bTtcbiAgbGV0IG1heGltdW07XG4gIGlmICh0eXBlb2YgbWluICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgbWF4ICE9PSAnbnVtYmVyJykge1xuICAgIC8vIG5laXRoZXIgcHJvdmlkZWQsIGRlZmF1bHQgdG8gXCIxXCJcbiAgICBtaW5pbXVtID0gMTtcbiAgICBtYXhpbXVtID0gMTtcbiAgfSBlbHNlIHtcbiAgICBtaW5pbXVtID0gdHlwZW9mIG1pbiA9PT0gJ251bWJlcicgPyBtaW4gOiAxO1xuICAgIG1heGltdW0gPSB0eXBlb2YgbWF4ID09PSAnbnVtYmVyJyA/IG1heCA6IEluZmluaXR5O1xuICB9XG4gIHJldHVybiB7IG1pbmltdW0sIG1heGltdW0gfTtcbn1cblxuZnVuY3Rpb24gY2h1bmtCeVR5cGUoaXRlbXMpIHtcbiAgbGV0IGNodW5rID0gW107XG4gIGxldCBsYXN0VHlwZTtcbiAgcmV0dXJuIGl0ZW1zLnJlZHVjZSgoY2h1bmtzLCBpdGVtKSA9PiB7XG4gICAgY29uc3QgaXRlbVR5cGUgPSB0eXBlT2YoaXRlbSk7XG4gICAgaWYgKCFsYXN0VHlwZSB8fCBpdGVtVHlwZSA9PT0gbGFzdFR5cGUpIHtcbiAgICAgIGNodW5rLnB1c2goaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgIGNodW5rID0gW2l0ZW1dO1xuICAgIH1cbiAgICBsYXN0VHlwZSA9IGl0ZW1UeXBlO1xuICAgIHJldHVybiBjaHVua3M7XG4gIH0sIFtdKS5jb25jYXQoY2h1bmsubGVuZ3RoID4gMCA/IFtjaHVua10gOiBbXSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQ2h1bmtzKHNwZWNpZmllcnMsIHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgLi4ucmVzdCkge1xuICBjb25zdCB7IFtwcm9wTmFtZV06IGl0ZW1zIH0gPSBwcm9wcztcbiAgY29uc3QgY2h1bmtzID0gY2h1bmtCeVR5cGUoaXRlbXMpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3BlY2lmaWVycy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGNvbnN0IHsgdmFsaWRhdG9yLCBtaW4sIG1heCB9ID0gc3BlY2lmaWVyc1tpXTtcblxuICAgIGNvbnN0IHsgbWluaW11bSwgbWF4aW11bSB9ID0gZ2V0TWluTWF4KHsgbWluLCBtYXggfSk7XG5cbiAgICBpZiAoY2h1bmtzLmxlbmd0aCA9PT0gMCAmJiBtaW5pbXVtID09PSAwKSB7XG4gICAgICAvLyBubyBjaHVua3MgbGVmdCwgYnV0IHRoaXMgc3BlY2lmaWVyIGRvZXMgbm90IHJlcXVpcmUgYW55IGl0ZW1zXG4gICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZVxuICAgIH1cblxuICAgIGNvbnN0IGFycmF5T2ZWYWxpZGF0b3IgPSBhcnJheU9mKHZhbGlkYXRvcikuaXNSZXF1aXJlZDtcblxuICAgIGNvbnN0IGNodW5rID0gY2h1bmtzLnNoaWZ0KCk7IC8vIGV4dHJhY3QgdGhlIG5leHQgY2h1bmsgdG8gdGVzdFxuXG4gICAgY29uc3QgY2h1bmtFcnJvciA9IGFycmF5T2ZWYWxpZGF0b3IoXG4gICAgICB7IC4uLnByb3BzLCBbcHJvcE5hbWVdOiBjaHVuayB9LFxuICAgICAgcHJvcE5hbWUsXG4gICAgICBjb21wb25lbnROYW1lLFxuICAgICAgLi4ucmVzdCxcbiAgICApO1xuXG4gICAgaWYgKGNodW5rRXJyb3IpIHsgLy8gdGhpcyBjaHVuayBpcyBpbnZhbGlkXG4gICAgICBpZiAobWluaW11bSA9PT0gMCkgeyAvLyBidXQsIHNwZWNpZmllciBoYXMgYSBtaW4gb2YgMCBhbmQgY2FuIGJlIHNraXBwZWRcbiAgICAgICAgY2h1bmtzLnVuc2hpZnQoY2h1bmspOyAvLyBwdXQgdGhlIGNodW5rIGJhY2ssIGZvciB0aGUgbmV4dCBpdGVyYXRpb25cbiAgICAgICAgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29udGludWVcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaHVua0Vycm9yO1xuICAgIH1cblxuICAgIC8vIGNodW5rIGlzIHZhbGlkIVxuXG4gICAgaWYgKGNodW5rLmxlbmd0aCA8IG1pbmltdW0pIHtcbiAgICAgIHJldHVybiBuZXcgUmFuZ2VFcnJvcihgJHtjb21wb25lbnROYW1lfTogc3BlY2lmaWVyIGluZGV4ICR7aX0gcmVxdWlyZXMgYSBtaW5pbXVtIG9mICR7bWlufSBpdGVtcywgYnV0IG9ubHkgaGFzICR7Y2h1bmsubGVuZ3RofS5gKTtcbiAgICB9XG5cbiAgICBpZiAoY2h1bmsubGVuZ3RoID4gbWF4aW11bSkge1xuICAgICAgcmV0dXJuIG5ldyBSYW5nZUVycm9yKGAke2NvbXBvbmVudE5hbWV9OiBzcGVjaWZpZXIgaW5kZXggJHtpfSByZXF1aXJlcyBhIG1heGltdW0gb2YgJHttYXh9IGl0ZW1zLCBidXQgaGFzICR7Y2h1bmsubGVuZ3RofS5gKTtcbiAgICB9XG4gIH1cblxuICBpZiAoY2h1bmtzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gbmV3IFR5cGVFcnJvcihgJHtjb21wb25lbnROYW1lfTogYWZ0ZXIgYWxsICR7c3BlY2lmaWVycy5sZW5ndGh9IHNwZWNpZmllcnMgbWF0Y2hlZCwgJHtjaHVua3MubGVuZ3RofSB0eXBlcyBvZiBpdGVtcyB3ZXJlIHJlbWFpbmluZy5gKTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuXG5jb25zdCBzcGVjaWZpZXJWYWxpZGF0b3IgPSB3aXRoU2hhcGUob2JqZWN0KCksIHNwZWNpZmllclNoYXBlKS5pc1JlcXVpcmVkO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzZXF1ZW5jZU9mVmFsaWRhdG9yKC4uLnNwZWNpZmllcnMpIHtcbiAgaWYgKHNwZWNpZmllcnMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NlcXVlbmNlT2Y6IGF0IGxlYXN0IG9uZSBzcGVjaWZpZXIgaXMgcmVxdWlyZWQnKTtcbiAgfVxuXG4gIGNvbnN0IGVycm9ycyA9IHNwZWNpZmllcnMubWFwKChzcGVjaWZpZXIsIGkpID0+IHNwZWNpZmllclZhbGlkYXRvcihcbiAgICB7IHNwZWNpZmllciB9LFxuICAgICdzcGVjaWZpZXInLFxuICAgICdzZXF1ZW5jZU9mIHNwZWNpZmllcicsXG4gICAgYHN1ZXF1ZW5jZU9mIHNwZWNpZmllciwgaW5kZXggJHtpfWAsXG4gICAgYHNwZWNpZmllciwgaW5kZXggJHtpfWAsXG4gICkpO1xuICBpZiAoZXJyb3JzLnNvbWUoQm9vbGVhbikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBcbiAgICAgIHNlcXVlbmNlT2Y6IGFsbCBzcGVjaWZpZXJzIG11c3QgbWF0Y2ggdGhlIGFwcHJvcHJpYXRlIHNoYXBlLlxuXG4gICAgICBFcnJvcnM6XG4gICAgICAgICR7ZXJyb3JzLm1hcCgoZSwgaSkgPT4gYCAtIEFyZ3VtZW50IGluZGV4ICR7aX06ICR7ZS5tZXNzYWdlfWApLmpvaW4oJyxcXG4gICAgICAgICcpfVxuICAgIGApO1xuICB9XG5cbiAgY29uc3QgdmFsaWRhdG9yID0gZnVuY3Rpb24gc2VxdWVuY2VPZihwcm9wcywgcHJvcE5hbWUsIC4uLnJlc3QpIHtcbiAgICBjb25zdCB7IFtwcm9wTmFtZV06IHByb3BWYWx1ZSB9ID0gcHJvcHM7XG5cbiAgICBpZiAocHJvcFZhbHVlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGVycm9yID0gYXJyYXkocHJvcHMsIHByb3BOYW1lLCAuLi5yZXN0KTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRhdGVDaHVua3Moc3BlY2lmaWVycywgcHJvcHMsIHByb3BOYW1lLCAuLi5yZXN0KTtcbiAgfTtcblxuICB2YWxpZGF0b3IuaXNSZXF1aXJlZCA9IGZ1bmN0aW9uIHNlcXVlbmNlT2ZSZXF1aXJlZChwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIC4uLnJlc3QpIHtcbiAgICBjb25zdCBlcnJvciA9IGFycmF5LmlzUmVxdWlyZWQocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRhdGVDaHVua3Moc3BlY2lmaWVycywgcHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KTtcbiAgfTtcblxuICByZXR1cm4gd3JhcFZhbGlkYXRvcih2YWxpZGF0b3IsICdzZXF1ZW5jZU9mJywgc3BlY2lmaWVycyk7XG59XG4iXX0=