106970ee4d5a0fbd2e40e7ff031b8a05
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = formatISO;

var _index = _interopRequireDefault(require("../toDate/index.js"));

var _index2 = _interopRequireDefault(require("../isValid/index.js"));

var _index3 = _interopRequireDefault(require("../_lib/addLeadingZeros/index.js"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function formatISO(dirtyDate, dirtyOptions) {
  if (arguments.length < 1) {
    throw new TypeError("1 argument required, but only ".concat(arguments.length, " present"));
  }

  var originalDate = (0, _index.default)(dirtyDate);

  if (!(0, _index2.default)(originalDate)) {
    throw new RangeError('Invalid time value');
  }

  var options = dirtyOptions || {};
  var format = options.format == null ? 'extended' : String(options.format);
  var representation = options.representation == null ? 'complete' : String(options.representation);

  if (format !== 'extended' && format !== 'basic') {
    throw new RangeError("format must be 'extended' or 'basic'");
  }

  if (representation !== 'date' && representation !== 'time' && representation !== 'complete') {
    throw new RangeError("representation must be 'date', 'time', or 'complete'");
  }

  var result = '';
  var tzOffset = '';
  var dateDelimiter = format === 'extended' ? '-' : '';
  var timeDelimiter = format === 'extended' ? ':' : '';

  if (representation !== 'time') {
    var day = (0, _index3.default)(originalDate.getDate(), 2);
    var month = (0, _index3.default)(originalDate.getMonth() + 1, 2);
    var year = (0, _index3.default)(originalDate.getFullYear(), 4);
    result = "".concat(year).concat(dateDelimiter).concat(month).concat(dateDelimiter).concat(day);
  }

  if (representation !== 'date') {
    var offset = originalDate.getTimezoneOffset();

    if (offset !== 0) {
      var absoluteOffset = Math.abs(offset);
      var hourOffset = (0, _index3.default)(Math.floor(absoluteOffset / 60), 2);
      var minuteOffset = (0, _index3.default)(absoluteOffset % 60, 2);
      var sign = offset < 0 ? '+' : '-';
      tzOffset = "".concat(sign).concat(hourOffset, ":").concat(minuteOffset);
    } else {
      tzOffset = 'Z';
    }

    var hour = (0, _index3.default)(originalDate.getHours(), 2);
    var minute = (0, _index3.default)(originalDate.getMinutes(), 2);
    var second = (0, _index3.default)(originalDate.getSeconds(), 2);
    var separator = result === '' ? '' : 'T';
    var time = [hour, minute, second].join(timeDelimiter);
    result = "".concat(result).concat(separator).concat(time).concat(tzOffset);
  }

  return result;
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsImZvcm1hdElTTyIsIl9pbmRleCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2luZGV4MiIsIl9pbmRleDMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGlydHlEYXRlIiwiZGlydHlPcHRpb25zIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiVHlwZUVycm9yIiwiY29uY2F0Iiwib3JpZ2luYWxEYXRlIiwiUmFuZ2VFcnJvciIsIm9wdGlvbnMiLCJmb3JtYXQiLCJTdHJpbmciLCJyZXByZXNlbnRhdGlvbiIsInJlc3VsdCIsInR6T2Zmc2V0IiwiZGF0ZURlbGltaXRlciIsInRpbWVEZWxpbWl0ZXIiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsIm9mZnNldCIsImdldFRpbWV6b25lT2Zmc2V0IiwiYWJzb2x1dGVPZmZzZXQiLCJNYXRoIiwiYWJzIiwiaG91ck9mZnNldCIsImZsb29yIiwibWludXRlT2Zmc2V0Iiwic2lnbiIsImhvdXIiLCJnZXRIb3VycyIsIm1pbnV0ZSIsImdldE1pbnV0ZXMiLCJzZWNvbmQiLCJnZXRTZWNvbmRzIiwic2VwYXJhdG9yIiwidGltZSIsImpvaW4iLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCQyxTQUFsQjs7QUFFQSxJQUFJQyxNQUFNLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLHNCQUFSLENBQW5DOztBQUVBLElBQUlDLE9BQU8sR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sdUJBQVIsQ0FBcEM7O0FBRUEsSUFB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QixhQUE1QixDQUFYO0FBRUFILElBQUFBLE1BQU0sR0FBRyxHQUFHUCxNQUFILENBQVVPLE1BQVYsRUFBa0JQLE1BQWxCLENBQXlCZ0MsU0FBekIsRUFBb0NoQyxNQUFwQyxDQUEyQ2lDLElBQTNDLEVBQWlEakMsTUFBakQsQ0FBd0RRLFFBQXhELENBQVQ7QUFDRDs7QUFFRCxTQUFPRCxNQUFQO0FBQ0Q7O0FBRUQ0QixNQUFNLENBQUNuRCxPQUFQLEdBQWlCQSxPQUFPLENBQUNFLE9BQXpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmRlZmF1bHQgPSBmb3JtYXRJU087XG5cbnZhciBfaW5kZXggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi90b0RhdGUvaW5kZXguanNcIikpO1xuXG52YXIgX2luZGV4MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL2lzVmFsaWQvaW5kZXguanNcIikpO1xuXG52YXIgX2luZGV4MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL19saWIvYWRkTGVhZGluZ1plcm9zL2luZGV4LmpzXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyoqXG4gKiBAbmFtZSBmb3JtYXRJU09cbiAqIEBjYXRlZ29yeSBDb21tb24gSGVscGVyc1xuICogQHN1bW1hcnkgRm9ybWF0IHRoZSBkYXRlIGFjY29yZGluZyB0byB0aGUgSVNPIDg2MDEgc3RhbmRhcmQgKGh0dHA6Ly9zdXBwb3J0LnNhcy5jb20vZG9jdW1lbnRhdGlvbi9jZGwvZW4vbHJkaWN0LzY0MzE2L0hUTUwvZGVmYXVsdC92aWV3ZXIuaHRtI2EwMDMxNjk4MTQuaHRtKS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJldHVybiB0aGUgZm9ybWF0dGVkIGRhdGUgc3RyaW5nIGluIElTTyA4NjAxIGZvcm1hdC4gT3B0aW9ucyBtYXkgYmUgcGFzc2VkIHRvIGNvbnRyb2wgdGhlIHBhcnRzIGFuZCBub3RhdGlvbnMgb2YgdGhlIGRhdGUuXG4gKlxuICogQHBhcmFtIHtEYXRlfE51bWJlcn0gZGF0ZSAtIHRoZSBvcmlnaW5hbCBkYXRlXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gYW4gb2JqZWN0IHdpdGggb3B0aW9ucy5cbiAqIEBwYXJhbSB7J2V4dGVuZGVkJ3wnYmFzaWMnfSBbb3B0aW9ucy5mb3JtYXQ9J2V4dGVuZGVkJ10gLSBpZiAnYmFzaWMnLCBoaWRlIGRlbGltaXRlcnMgYmV0d2VlbiBkYXRlIGFuZCB0aW1lIHZhbHVlcy5cbiAqIEBwYXJhbSB7J2NvbXBsZXRlJ3wnZGF0ZSd8J3RpbWUnfSBbb3B0aW9ucy5yZXByZXNlbnRhdGlvbj0nY29tcGxldGUnXSAtIGZvcm1hdCBkYXRlLCB0aW1lIHdpdGggdGltZSB6b25lLCBvciBib3RoLlxuICogQHJldHVybnMge1N0cmluZ30gdGhlIGZvcm1hdHRlZCBkYXRlIHN0cmluZ1xuICogQHRocm93cyB7VHlwZUVycm9yfSAxIGFyZ3VtZW50IHJlcXVpcmVkXG4gKiBAdGhyb3dzIHtSYW5nZUVycm9yfSBgZGF0ZWAgbXVzdCBub3QgYmUgSW52YWxpZCBEYXRlXG4gKiBAdGhyb3dzIHtSYW5nZUVycm9yfSBgb3B0aW9ucy5mb3JtYXRgIG11c3QgYmUgJ2V4dGVuZGVkJyBvciAnYmFzaWMnXG4gKiBAdGhyb3dzIHtSYW5nZUVycm9yfSBgb3B0aW9ucy5yZXByZXNlbmF0aW9uYCBtdXN0IGJlICdkYXRlJywgJ3RpbWUnIG9yICdjb21wbGV0ZSdcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gUmVwcmVzZW50IDE4IFNlcHRlbWJlciAyMDE5IGluIElTTyA4NjAxIGZvcm1hdCAoVVRDKTpcbiAqIGNvbnN0IHJlc3VsdCA9IGZvcm1hdElTTyhuZXcgRGF0ZSgyMDE5LCA4LCAxOCwgMTksIDAsIDUyKSlcbiAqIC8vPT4gJzIwMTktMDktMThUMTk6MDA6NTJaJ1xuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBSZXByZXNlbnQgMTggU2VwdGVtYmVyIDIwMTkgaW4gSVNPIDg2MDEsIHNob3J0IGZvcm1hdCAoVVRDKTpcbiAqIGNvbnN0IHJlc3VsdCA9IGZvcm1hdElTTyhuZXcgRGF0ZSgyMDE5LCA4LCAxOCwgMTksIDAsIDUyKSwgeyBmb3JtYXQ6ICdiYXNpYycgfSlcbiAqIC8vPT4gJzIwMTkwOTE4VDE5MDA1MidcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gUmVwcmVzZW50IDE4IFNlcHRlbWJlciAyMDE5IGluIElTTyA4NjAxIGZvcm1hdCwgZGF0ZSBvbmx5OlxuICogY29uc3QgcmVzdWx0ID0gZm9ybWF0SVNPKG5ldyBEYXRlKDIwMTksIDgsIDE4LCAxOSwgMCwgNTIpLCB7IHJlcHJlc2VudGF0aW9uOiAnZGF0ZScgfSlcbiAqIC8vPT4gJzIwMTktMDktMTgnXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFJlcHJlc2VudCAxOCBTZXB0ZW1iZXIgMjAxOSBpbiBJU08gODYwMSBmb3JtYXQsIHRpbWUgb25seSAoVVRDKTpcbiAqIGNvbnN0IHJlc3VsdCA9IGZvcm1hdElTTyhuZXcgRGF0ZSgyMDE5LCA4LCAxOCwgMTksIDAsIDUyKSwgeyByZXByZXNlbnRhdGlvbjogJ3RpbWUnIH0pXG4gKiAvLz0+ICcxOTowMDo1MlonXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdElTTyhkaXJ0eURhdGUsIGRpcnR5T3B0aW9ucykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiMSBhcmd1bWVudCByZXF1aXJlZCwgYnV0IG9ubHkgXCIuY29uY2F0KGFyZ3VtZW50cy5sZW5ndGgsIFwiIHByZXNlbnRcIikpO1xuICB9XG5cbiAgdmFyIG9yaWdpbmFsRGF0ZSA9ICgwLCBfaW5kZXguZGVmYXVsdCkoZGlydHlEYXRlKTtcblxuICBpZiAoISgwLCBfaW5kZXgyLmRlZmF1bHQpKG9yaWdpbmFsRGF0ZSkpIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW52YWxpZCB0aW1lIHZhbHVlJyk7XG4gIH1cblxuICB2YXIgb3B0aW9ucyA9IGRpcnR5T3B0aW9ucyB8fCB7fTtcbiAgdmFyIGZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0ID09IG51bGwgPyAnZXh0ZW5kZWQnIDogU3RyaW5nKG9wdGlvbnMuZm9ybWF0KTtcbiAgdmFyIHJlcHJlc2VudGF0aW9uID0gb3B0aW9ucy5yZXByZXNlbnRhdGlvbiA9PSBudWxsID8gJ2NvbXBsZXRlJyA6IFN0cmluZyhvcHRpb25zLnJlcHJlc2VudGF0aW9uKTtcblxuICBpZiAoZm9ybWF0ICE9PSAnZXh0ZW5kZWQnICYmIGZvcm1hdCAhPT0gJ2Jhc2ljJykge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiZm9ybWF0IG11c3QgYmUgJ2V4dGVuZGVkJyBvciAnYmFzaWMnXCIpO1xuICB9XG5cbiAgaWYgKHJlcHJlc2VudGF0aW9uICE9PSAnZGF0ZScgJiYgcmVwcmVzZW50YXRpb24gIT09ICd0aW1lJyAmJiByZXByZXNlbnRhdGlvbiAhPT0gJ2NvbXBsZXRlJykge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwicmVwcmVzZW50YXRpb24gbXVzdCBiZSAnZGF0ZScsICd0aW1lJywgb3IgJ2NvbXBsZXRlJ1wiKTtcbiAgfVxuXG4gIHZhciByZXN1bHQgPSAnJztcbiAgdmFyIHR6T2Zmc2V0ID0gJyc7XG4gIHZhciBkYXRlRGVsaW1pdGVyID0gZm9ybWF0ID09PSAnZXh0ZW5kZWQnID8gJy0nIDogJyc7XG4gIHZhciB0aW1lRGVsaW1pdGVyID0gZm9ybWF0ID09PSAnZXh0ZW5kZWQnID8gJzonIDogJyc7IC8vIFJlcHJlc2VudGF0aW9uIGlzIGVpdGhlciAnZGF0ZScgb3IgJ2NvbXBsZXRlJ1xuXG4gIGlmIChyZXByZXNlbnRhdGlvbiAhPT0gJ3RpbWUnKSB7XG4gICAgdmFyIGRheSA9ICgwLCBfaW5kZXgzLmRlZmF1bHQpKG9yaWdpbmFsRGF0ZS5nZXREYXRlKCksIDIpO1xuICAgIHZhciBtb250aCA9ICgwLCBfaW5kZXgzLmRlZmF1bHQpKG9yaWdpbmFsRGF0ZS5nZXRNb250aCgpICsgMSwgMik7XG4gICAgdmFyIHllYXIgPSAoMCwgX2luZGV4My5kZWZhdWx0KShvcmlnaW5hbERhdGUuZ2V0RnVsbFllYXIoKSwgNCk7IC8vIHl5eXlNTWRkIG9yIHl5eXktTU0tZGQuXG5cbiAgICByZXN1bHQgPSBcIlwiLmNvbmNhdCh5ZWFyKS5jb25jYXQoZGF0ZURlbGltaXRlcikuY29uY2F0KG1vbnRoKS5jb25jYXQoZGF0ZURlbGltaXRlcikuY29uY2F0KGRheSk7XG4gIH0gLy8gUmVwcmVzZW50YXRpb24gaXMgZWl0aGVyICd0aW1lJyBvciAnY29tcGxldGUnXG5cblxuICBpZiAocmVwcmVzZW50YXRpb24gIT09ICdkYXRlJykge1xuICAgIC8vIEFkZCB0aGUgdGltZXpvbmUuXG4gICAgdmFyIG9mZnNldCA9IG9yaWdpbmFsRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpO1xuXG4gICAgaWYgKG9mZnNldCAhPT0gMCkge1xuICAgICAgdmFyIGFic29sdXRlT2Zmc2V0ID0gTWF0aC5hYnMob2Zmc2V0KTtcbiAgICAgIHZhciBob3VyT2Zmc2V0ID0gKDAsIF9pbmRleDMuZGVmYXVsdCkoTWF0aC5mbG9vcihhYnNvbHV0ZU9mZnNldCAvIDYwKSwgMik7XG4gICAgICB2YXIgbWludXRlT2Zmc2V0ID0gKDAsIF9pbmRleDMuZGVmYXVsdCkoYWJzb2x1dGVPZmZzZXQgJSA2MCwgMik7IC8vIElmIGxlc3MgdGhhbiAwLCB0aGUgc2lnbiBpcyArLCBiZWNhdXNlIGl0IGlzIGFoZWFkIG9mIHRpbWUuXG5cbiAgICAgIHZhciBzaWduID0gb2Zmc2V0IDwgMCA/ICcrJyA6ICctJztcbiAgICAgIHR6T2Zmc2V0ID0gXCJcIi5jb25jYXQoc2lnbikuY29uY2F0KGhvdXJPZmZzZXQsIFwiOlwiKS5jb25jYXQobWludXRlT2Zmc2V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHpPZmZzZXQgPSAnWic7XG4gICAgfVxuXG4gICAgdmFyIGhvdXIgPSAoMCwgX2luZGV4My5kZWZhdWx0KShvcmlnaW5hbERhdGUuZ2V0SG91cnMoKSwgMik7XG4gICAgdmFyIG1pbnV0ZSA9ICgwLCBfaW5kZXgzLmRlZmF1bHQpKG9yaWdpbmFsRGF0ZS5nZXRNaW51dGVzKCksIDIpO1xuICAgIHZhciBzZWNvbmQgPSAoMCwgX2luZGV4My5kZWZhdWx0KShvcmlnaW5hbERhdGUuZ2V0U2Vjb25kcygpLCAyKTsgLy8gSWYgdGhlcmUncyBhbHNvIGRhdGUsIHNlcGFyYXRlIGl0IHdpdGggdGltZSB3aXRoICdUJ1xuXG4gICAgdmFyIHNlcGFyYXRvciA9IHJlc3VsdCA9PT0gJycgPyAnJyA6ICdUJzsgLy8gQ3JlYXRlcyBhIHRpbWUgc3RyaW5nIGNvbnNpc3Rpbmcgb2YgaG91ciwgbWludXRlLCBhbmQgc2Vjb25kLCBzZXBhcmF0ZWQgYnkgZGVsaW1pdGVycywgaWYgZGVmaW5lZC5cblxuICAgIHZhciB0aW1lID0gW2hvdXIsIG1pbnV0ZSwgc2Vjb25kXS5qb2luKHRpbWVEZWxpbWl0ZXIpOyAvLyBISG1tc3Mgb3IgSEg6bW06c3MuXG5cbiAgICByZXN1bHQgPSBcIlwiLmNvbmNhdChyZXN1bHQpLmNvbmNhdChzZXBhcmF0b3IpLmNvbmNhdCh0aW1lKS5jb25jYXQodHpPZmZzZXQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19