3929dc19a2ee77a8d1d5bf1b49d48601
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var url = require("url");

var URL = url.URL;

var http = require("http");

var https = require("https");

var Writable = require("stream").Writable;

var assert = require("assert");

var debug = require("./debug");

var eventHandlers = Object.create(null);
["abort", "aborted", "connect", "error", "socket", "timeout"].forEach(function (event) {
  eventHandlers[event] = function (arg1, arg2, arg3) {
    this._redirectable.emit(event, arg1, arg2, arg3);
  };
});
var RedirectionError = createErrorType("ERR_FR_REDIRECTION_FAILURE", "");
var TooManyRedirectsError = createErrorType("ERR_FR_TOO_MANY_REDIRECTS", "Maximum number of redirects exceeded");
var MaxBodyLengthExceededError = createErrorType("ERR_FR_MAX_BODY_LENGTH_EXCEEDED", "Request body larger than maxBodyLength limit");
var WriteAfterEndError = createErrorType("ERR_STREAM_WRITE_AFTER_END", "write after end");

function RedirectableRequest(options, responseCallback) {
  Writable.call(this);

  this._sanitizeOptions(options);

  this._options = options;
  this._ended = false;
  this._ending = false;
  this._redirectCount = 0;
  this._redirects = [];
  this._requestBodyLength = 0;
  this._requestBodyBuffers = [];

  if (responseCallback) {
    this.on("response", responseCallback);
  }

  var self = this;

  this._onNativeResponse = function (response) {
    self._processResponse(response);
  };

  this._performRequest();
}

RedirectableRequest.prototype = Object.create(Writable.prototype);

RedirectableRequest.prototype.write = function (data, encoding, callback) {
  if (this._ending) {
    throw new WriteAfterEndError();
  }

  if (!(typeof data === "string" || typeof data === "object" && "length" in data)) {
    throw new TypeError("data should be a string, Buffer or Uint8Array");
  }

  if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (data.length === 0) {
    if (callback) {
      callback();
    }

    return;
  }

  if (this._requestBodyLength + data.length <= this._options.maxBodyLength) {
    this._requestBodyLength += data.length;

    this._requestBodyBuffers.push({
      data: data,
      encoding: encoding
    });

    this._currentRequest.write(data, encoding, callback);
  } else {
      this.emit("error", new MaxBodyLengthExceededError());
      this.abort();
    }
};

RedirectableRequest.prototype.end = function (data, encoding, callback) {
  if (typeof data === "function") {
    callback = data;
    data = encoding = null;
  } else if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (!data) {
    this._ended = this._ending = true;

    this._currentRequest.end(null, null, callback);
  } else {
    var self = this;
    var currentRequest = this._currentRequest;
    this.write(data, encoding, function () {
      self._ended = true;
      currentRequest.end(null, null, callback);
    });
    this._ending = true;
  }
};

RedirectableRequest.prototype.setHeader = function (name, value) {
  this._options.headers[name] = value;

  this._currentRequest.setHeader(name, value);
};

RedirectableRequest.prototype.removeHeader = function (name) {
  delete this._options.headers[name];

  this._currentRequest.removeHeader(name);
};

RedirectableRequest.prototype.setTimeout = function (msecs, callback) {
  if (callback) {
    this.once("timeout", callback);
  }

  if (this.socket) {
    startTimer(this, msecs);
  } else {
    var self = this;

    this._currentRequest.once("socket", function () {
      startTimer(self, msecs);
    });
  }

  this.once("response", clearTimer);
  this.once("error", clearTimer);
  return this;
};

function startTimer(request, msecs) {
  clearTimeout(request._timeout);
  request._timeout = setTimeout(function () {
    request.emit("timeout");
  }, msecs);
}

function clearTimer() {
  clearTimeout(this._timeout);
}

["abort", "flushHeaders", "getHeader", "setNoDelay", "setSocketKeepAlive"].forEach(function (method) {
  RedirectableRequest.prototype[method] = function (a, b) {
    return this._currentRequest[method](a, b);
  };
});
["aborted", "connection", "socket"].forEach(function (property) {
  Object.defineProperty(RedirectableRequest.prototype, property, {
    get: function get() {
      return this._currentRequest[property];
    }
  });
});

RedirectableRequest.prototype._sanitizeOptions = function (options) {
  if (!options.headers) {
    options.headers = {};
  }

  if (options.host) {
    if (!options.hostname) {
      options.hostname = options.host;
    }

    delete options.host;
  }

  if (!options.pathname && options.path) {
    var searchPos = options.path.indexOf("?");

    if (searchPos < 0) {
      options.pathname = options.path;
    } else {
      options.pathname = options.path.substring(0, searchPos);
      options.search = options.path.substring(searchPos);
    }
  }
};

RedirectableRequest.prototype._performRequest = function () {
  var protocol = this._options.protocol;
  var nativeProtocol = this._options.nativeProtocols[protocol];

  if (!nativeProtocol) {
    this.emit("error", new TypeError("Unsupported protocol " + protocol));
    return;
  }

  if (this._options.agents) {
    var scheme = protocol.substr(0, protocol.length - 1);
    this._options.agent = this._options.agents[scheme];
  }

  var request = this._currentRequest = nativeProtocol.request(this._options, this._onNativeResponse);
  this._currentUrl = url.format(this._options);
  request._redirectable = this;

  for (var event in eventHandlers) {
    if (event) {
      request.on(event, eventHandlers[event]);
    }
  }

  if (this._isRedirect) {
    var i = 0;
    var self = this;
    var buffers = this._requestBodyBuffers;

    (function writeNext(error) {
      if (request === self._currentRequest) {
        if (error) {
          self.emit("error", error);
        } else if (i < buffers.length) {
            var buffer = buffers[i++];

            if (!request.finished) {
              request.write(buffer.data, buffer.encoding, writeNext);
            }
          } else if (self._ended) {
              request.end();
            }
      }
    })();
  }
};

RedirectableRequest.prototype._processResponse = function (response) {
  var statusCode = response.statusCode;

  if (this._options.trackRedirects) {
    this._redirects.push({
      url: this._currentUrl,
      headers: response.headers,
      statusCode: statusCode
    });
  }

  var location = response.headers.location;

  if (location && this._options.followRedirects !== false && statusCode >= 300 && statusCode < 400) {
    this._currentRequest.removeAllListeners();

    this._currentRequest.on("error", noop);

    this._currentRequest.abort();

    response.destroy();

    if (++this._redirectCount > this._options.maxRedirects) {
      this.emit("error", new TooManyRedirectsError());
      return;
    }

    if ((statusCode === 301 || statusCode === 302) && this._options.method === "POST" || statusCode === 303 && !/^(?:GET|HEAD)$/.test(this._options.method)) {
      this._options.method = "GET";
      this._requestBodyBuffers = [];
      removeMatchingHeaders(/^content-/i, this._options.headers);
    }

    var previousHostName = removeMatchingHeaders(/^host$/i, this._options.headers) || url.parse(this._currentUrl).hostname;
    var redirectUrl = url.resolve(this._currentUrl, location);
    debug("redirecting to", redirectUrl);
    this._isRedirect = true;
    var redirectUrlParts = url.parse(redirectUrl);
    (0, _extends2.default)(this._options, redirectUrlParts);

    if (redirectUrlParts.hostname !== previousHostName) {
      removeMatchingHeaders(/^authorization$/i, this._options.headers);
    }

    if (typeof this._options.beforeRedirect === "function") {
      var responseDetails = {
        headers: response.headers
      };

      try {
        this._options.beforeRedirect.call(null, this._options, responseDetails);
      } catch (err) {
        this.emit("error", err);
        return;
      }

      this._sanitizeOptions(this._options);
    }

    try {
      this._performRequest();
    } catch (cause) {
      var error = new RedirectionError("Redirected request failed: " + cause.message);
      error.cause = cause;
      this.emit("error", error);
    }
  } else {
    response.responseUrl = this._currentUrl;
    response.redirects = this._redirects;
    this.emit("response", response);
    this._requestBodyBuffers = [];
  }
};

function wrap(protocols) {
  var exports = {
    maxRedirects: 21,
    maxBodyLength: 10 * 1024 * 1024
  };
  var nativeProtocols = {};
  Object.keys(protocols).forEach(function (scheme) {
    var protocol = scheme + ":";
    var nativeProtocol = nativeProtocols[protocol] = protocols[scheme];
    var wrappedProtocol = exports[scheme] = Object.create(nativeProtocol);

    wrappedProtocol.request = function (input, options, callback) {
      if (typeof input === "string") {
        var urlStr = input;

        try {
          input = urlToOptions(new URL(urlStr));
        } catch (err) {
          input = url.parse(urlStr);
        }
      } else if (URL && input instanceof URL) {
        input = urlToOptions(input);
      } else {
        callback = options;
        options = input;
        input = {
          protocol: protocol
        };
      }

      if (typeof options === "function") {
        callback = options;
        options = null;
      }

      options = (0, _extends2.default)({
        maxRedirects: exports.maxRedirects,
        maxBodyLength: exports.maxBodyLength
      }, input, options);
      options.nativeProtocols = nativeProtocols;
      assert.equal(options.protocol, protocol, "protocol mismatch");
      debug("options", options);
      return new RedirectableRequest(options, callback);
    };

    wrappedProtocol.get = function (input, options, callback) {
      var request = wrappedProtocol.request(input, options, callback);
      request.end();
      return request;
    };
  });
  return exports;
}

function noop() {}

function urlToOptions(urlObject) {
  var options = {
    protocol: urlObject.protocol,
    hostname: urlObject.hostname.startsWith("[") ? urlObject.hostname.slice(1, -1) : urlObject.hostname,
    hash: urlObject.hash,
    search: urlObject.search,
    pathname: urlObject.pathname,
    path: urlObject.pathname + urlObject.search,
    href: urlObject.href
  };

  if (urlObject.port !== "") {
    options.port = Number(urlObject.port);
  }

  return options;
}

function removeMatchingHeaders(regex, headers) {
  var lastValue;

  for (var header in headers) {
    if (regex.test(header)) {
      lastValue = headers[header];
      delete headers[header];
    }
  }

  return lastValue;
}

function createErrorType(code, defaultMessage) {
  function CustomError(message) {
    Error.captureStackTrace(this, this.constructor);
    this.message = message || defaultMessage;
  }

  CustomError.prototype = new Error();
  CustomError.prototype.constructor = CustomError;
  CustomError.prototype.name = "Error [" + code + "]";
  CustomError.prototype.code = code;
  return CustomError;
}

module.exports = wrap({
  http: http,
  https: https
});
module.exports.wrap = wrap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInVybCIsInJlcXVpcmUiLCJVUkwiLCJodHRwIiwiaHR0cHMiLCJXcml0YWJsZSIsImFzc2VydCIsImRlYnVnIiwiZXZlbnRIYW5kbGVycyIsIk9iamVjdCIsImNyZWF0ZSIsImZvckVhY2giLCJldmVudCIsImFyZzEiLCJhcmcyIiwiYXJnMyIsIl9yZWRpcmVjdGFibGUiLCJlbWl0IiwiUmVkaXJlY3Rpb25FcnJvciIsImNyZWF0ZUVycm9yVHlwZSIsIlRvb01hbnlSZWRpcmVjdHNFcnJvciIsIk1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yIiwiV3JpdGVBZnRlckVuZEVycm9yIiwiUmVkaXJlY3RhYmxlUmVxdWVzdCIsIm9wdGlvbnMiLCJyZXNwb25zZUNhbGxiYWNrIiwiY2FsbCIsIl9zYW5pdGl6ZU9wdGlvbnMiLCJfb3B0aW9ucyIsIl9lbmRlZCIsIl9lbmRpbmciLCJfcmVkaXJlY3RDb3VudCIsIl9yZWRpcmVjdHMiLCJfcmVxdWVzdEJvZHlMZW5ndGgiLCJfcmVxdWVzdEJvZHlCdWZmZXJzIiwib24iLCJzZWxmIiwiX29uTmF0aXZlUmVzcG9uc2UiLCJyZXNwb25zZSIsIl9wcm9jZXNzUmVzcG9uc2UiLCJfcGVyZm9ybVJlcXVlc3QiLCJwcm90b3R5cGUiLCJ3cml0ZSIsImRhdGEiLCJlbmNvZGluZyIsImNhbGxiYWNrIiwiVHlwZUVycm9yIiwibGVuZ3RoIiwibWF4Qm9keUxlbmd0aCIsInB1c2giLCJfY3VycmVudFJlcXVlc3QiLCJhYm9ydCIsImVuZCIsImN1cnJlbnRSZXF1ZXN0Iiwic2V0SGVhZGVyIiwibmFtZSIsInZhbHVlIiwiaGVhZGVycyIsInJlbW92ZUhlYWRlciIsInNldFRpbWVvdXQiLCJtc2VjcyIsIm9uY2UiLCJzb2NrZXQiLCJzdGFydFRpbWVyIiwiY2xlYXJUaW1lciIsInJlcXVlc3QiLCJjbGVhclRpbWVvdXQiLCJfdGltZW91dCIsIm1ldGhvZCIsImEiLCJiIiwicHJvcGVydHkiLCJkZWZpbmVQcm9wZXJ0eSIsImdldCIsImhvc3QiLCJob3N0bmFtZSIsInBhdGhuYW1lIiwicGF0aCIsInNlYXJjaFBvcyIsImluZGV4T2YiLCJzdWJzdHJpbmciLCJzZWFyY2giLCJwcm90b2NvbCIsIm5hdGl2ZVByb3RvY29sIiwibmF0aXZlUHJvdG9jb2xzIiwiYWdlbnRzIiwic2NoZW1lIiwic3Vic3RyIiwiYWdlbnQiLCJfY3VycmVudFVybCIsImZvcm1hdCIsIl9pc1JlZGlyZWN0IiwiaSIsImJ1ZmZlcnMiLCJ3cml0ZU5leHQiLCJlcnJvciIsImJ1ZmZlciIsImZpbmlzaGVkIiwic3RhdHVzQ29kZSIsInRyYWNrUmVkaXJlY3RzIiwibG9jYXRpb24iLCJmb2xsb3dSZWRpcmVjdHMiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJub29wIiwiZGVzdHJveSIsIm1heFJlZGlyZWN0cyIsInRlc3QiLCJyZW1vdmVNYXRjaGluZ0hlYWRlcnMiLCJwcmV2aW91c0hvc3ROYW1lIiwicGFyc2UiLCJyZWRpcmVjdFVybCIsInJlc29sdmUiLCJyZWRpcmVjdFVybFBhcnRzIiwiYmVmb3JlUmVkaXJlY3QiLCJyZXNwb25zZURldGFpbHMiLCJlcnIiLCJjYXVzZSIsIm1lc3NhZ2UiLCJyZXNwb25zZVVybCIsInJlZGlyZWN0cyIsIndyYXAiLCJwcm90b2NvbHMiLCJleHBvcnRzIiwia2V5cyIsIndyYXBwZWRQcm90b2NvbCIsImlucHV0IiwidXJsU3RyIiwidXJsVG9PcHRpb25zIiwiZXF1YWwiLCJ1cmxPYmplY3QiLCJzdGFydHNXaXRoIiwic2xpY2UiLCJoYXNoIiwiaHJlZiIsInBvcnQiLCJOdW1iZXIiLCJyZWdleCIsImxhc3RWYWx1ZSIsImhlYWRlciIsImNvZGUiLCJkZWZhdWx0TWVzc2FnZSIsIkN1c3RvbUVycm9yIiwiRXJyb3IiLCJjYXB0dXJlU3RhY2tUcmFjZSIsImNvbnN0cnVjdG9yIiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsSUFBSUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsS0FBRCxD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QUVBLElBQVI7QUFBY0MsRUFBQUEsS0FBSyxFQUFFQTtBQUFyQixDQUFELENBQXJCO0FBQ0E2SSxNQUFNLENBQUN2QixPQUFQLENBQWVGLElBQWYsR0FBc0JBLElBQXRCIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHVybCA9IHJlcXVpcmUoXCJ1cmxcIik7XG52YXIgVVJMID0gdXJsLlVSTDtcbnZhciBodHRwID0gcmVxdWlyZShcImh0dHBcIik7XG52YXIgaHR0cHMgPSByZXF1aXJlKFwiaHR0cHNcIik7XG52YXIgV3JpdGFibGUgPSByZXF1aXJlKFwic3RyZWFtXCIpLldyaXRhYmxlO1xudmFyIGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XG52YXIgZGVidWcgPSByZXF1aXJlKFwiLi9kZWJ1Z1wiKTtcblxuLy8gQ3JlYXRlIGhhbmRsZXJzIHRoYXQgcGFzcyBldmVudHMgZnJvbSBuYXRpdmUgcmVxdWVzdHNcbnZhciBldmVudEhhbmRsZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbltcImFib3J0XCIsIFwiYWJvcnRlZFwiLCBcImNvbm5lY3RcIiwgXCJlcnJvclwiLCBcInNvY2tldFwiLCBcInRpbWVvdXRcIl0uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnRIYW5kbGVyc1tldmVudF0gPSBmdW5jdGlvbiAoYXJnMSwgYXJnMiwgYXJnMykge1xuICAgIHRoaXMuX3JlZGlyZWN0YWJsZS5lbWl0KGV2ZW50LCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfTtcbn0pO1xuXG4vLyBFcnJvciB0eXBlcyB3aXRoIGNvZGVzXG52YXIgUmVkaXJlY3Rpb25FcnJvciA9IGNyZWF0ZUVycm9yVHlwZShcbiAgXCJFUlJfRlJfUkVESVJFQ1RJT05fRkFJTFVSRVwiLFxuICBcIlwiXG4pO1xudmFyIFRvb01hbnlSZWRpcmVjdHNFcnJvciA9IGNyZWF0ZUVycm9yVHlwZShcbiAgXCJFUlJfRlJfVE9PX01BTllfUkVESVJFQ1RTXCIsXG4gIFwiTWF4aW11bSBudW1iZXIgb2YgcmVkaXJlY3RzIGV4Y2VlZGVkXCJcbik7XG52YXIgTWF4Qm9keUxlbmd0aEV4Y2VlZGVkRXJyb3IgPSBjcmVhdGVFcnJvclR5cGUoXG4gIFwiRVJSX0ZSX01BWF9CT0RZX0xFTkdUSF9FWENFRURFRFwiLFxuICBcIlJlcXVlc3QgYm9keSBsYXJnZXIgdGhhbiBtYXhCb2R5TGVuZ3RoIGxpbWl0XCJcbik7XG52YXIgV3JpdGVBZnRlckVuZEVycm9yID0gY3JlYXRlRXJyb3JUeXBlKFxuICBcIkVSUl9TVFJFQU1fV1JJVEVfQUZURVJfRU5EXCIsXG4gIFwid3JpdGUgYWZ0ZXIgZW5kXCJcbik7XG5cbi8vIEFuIEhUVFAoUykgcmVxdWVzdCB0aGF0IGNhbiBiZSByZWRpcmVjdGVkXG5mdW5jdGlvbiBSZWRpcmVjdGFibGVSZXF1ZXN0KG9wdGlvbnMsIHJlc3BvbnNlQ2FsbGJhY2spIHtcbiAgLy8gSW5pdGlhbGl6ZSB0aGUgcmVxdWVzdFxuICBXcml0YWJsZS5jYWxsKHRoaXMpO1xuICB0aGlzLl9zYW5pdGl6ZU9wdGlvbnMob3B0aW9ucyk7XG4gIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICB0aGlzLl9lbmRlZCA9IGZhbHNlO1xuICB0aGlzLl9lbmRpbmcgPSBmYWxzZTtcbiAgdGhpcy5fcmVkaXJlY3RDb3VudCA9IDA7XG4gIHRoaXMuX3JlZGlyZWN0cyA9IFtdO1xuICB0aGlzLl9yZXF1ZXN0Qm9keUxlbmd0aCA9IDA7XG4gIHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycyA9IFtdO1xuXG4gIC8vIEF0dGFjaCBhIGNhbGxiYWNrIGlmIHBhc3NlZFxuICBpZiAocmVzcG9uc2VDYWxsYmFjaykge1xuICAgIHRoaXMub24oXCJyZXNwb25zZVwiLCByZXNwb25zZUNhbGxiYWNrKTtcbiAgfVxuXG4gIC8vIFJlYWN0IHRvIHJlc3BvbnNlcyBvZiBuYXRpdmUgcmVxdWVzdHNcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLl9vbk5hdGl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgc2VsZi5fcHJvY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlKTtcbiAgfTtcblxuICAvLyBQZXJmb3JtIHRoZSBmaXJzdCByZXF1ZXN0XG4gIHRoaXMuX3BlcmZvcm1SZXF1ZXN0KCk7XG59XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoV3JpdGFibGUucHJvdG90eXBlKTtcblxuLy8gV3JpdGVzIGJ1ZmZlcmVkIGRhdGEgdG8gdGhlIGN1cnJlbnQgbmF0aXZlIHJlcXVlc3RcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGRhdGEsIGVuY29kaW5nLCBjYWxsYmFjaykge1xuICAvLyBXcml0aW5nIGlzIG5vdCBhbGxvd2VkIGlmIGVuZCBoYXMgYmVlbiBjYWxsZWRcbiAgaWYgKHRoaXMuX2VuZGluZykge1xuICAgIHRocm93IG5ldyBXcml0ZUFmdGVyRW5kRXJyb3IoKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIGlucHV0IGFuZCBzaGlmdCBwYXJhbWV0ZXJzIGlmIG5lY2Vzc2FyeVxuICBpZiAoISh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIiAmJiAoXCJsZW5ndGhcIiBpbiBkYXRhKSkpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiZGF0YSBzaG91bGQgYmUgYSBzdHJpbmcsIEJ1ZmZlciBvciBVaW50OEFycmF5XCIpO1xuICB9XG4gIGlmICh0eXBlb2YgZW5jb2RpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNhbGxiYWNrID0gZW5jb2Rpbmc7XG4gICAgZW5jb2RpbmcgPSBudWxsO1xuICB9XG5cbiAgLy8gSWdub3JlIGVtcHR5IGJ1ZmZlcnMsIHNpbmNlIHdyaXRpbmcgdGhlbSBkb2Vzbid0IGludm9rZSB0aGUgY2FsbGJhY2tcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL25vZGVqcy9ub2RlL2lzc3Vlcy8yMjA2NlxuICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICAvLyBPbmx5IHdyaXRlIHdoZW4gd2UgZG9uJ3QgZXhjZWVkIHRoZSBtYXhpbXVtIGJvZHkgbGVuZ3RoXG4gIGlmICh0aGlzLl9yZXF1ZXN0Qm9keUxlbmd0aCArIGRhdGEubGVuZ3RoIDw9IHRoaXMuX29wdGlvbnMubWF4Qm9keUxlbmd0aCkge1xuICAgIHRoaXMuX3JlcXVlc3RCb2R5TGVuZ3RoICs9IGRhdGEubGVuZ3RoO1xuICAgIHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycy5wdXNoKHsgZGF0YTogZGF0YSwgZW5jb2Rpbmc6IGVuY29kaW5nIH0pO1xuICAgIHRoaXMuX2N1cnJlbnRSZXF1ZXN0LndyaXRlKGRhdGEsIGVuY29kaW5nLCBjYWxsYmFjayk7XG4gIH1cbiAgLy8gRXJyb3Igd2hlbiB3ZSBleGNlZWQgdGhlIG1heGltdW0gYm9keSBsZW5ndGhcbiAgZWxzZSB7XG4gICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgbmV3IE1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yKCkpO1xuICAgIHRoaXMuYWJvcnQoKTtcbiAgfVxufTtcblxuLy8gRW5kcyB0aGUgY3VycmVudCBuYXRpdmUgcmVxdWVzdFxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24gKGRhdGEsIGVuY29kaW5nLCBjYWxsYmFjaykge1xuICAvLyBTaGlmdCBwYXJhbWV0ZXJzIGlmIG5lY2Vzc2FyeVxuICBpZiAodHlwZW9mIGRhdGEgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNhbGxiYWNrID0gZGF0YTtcbiAgICBkYXRhID0gZW5jb2RpbmcgPSBudWxsO1xuICB9XG4gIGVsc2UgaWYgKHR5cGVvZiBlbmNvZGluZyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgY2FsbGJhY2sgPSBlbmNvZGluZztcbiAgICBlbmNvZGluZyA9IG51bGw7XG4gIH1cblxuICAvLyBXcml0ZSBkYXRhIGlmIG5lZWRlZCBhbmQgZW5kXG4gIGlmICghZGF0YSkge1xuICAgIHRoaXMuX2VuZGVkID0gdGhpcy5fZW5kaW5nID0gdHJ1ZTtcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5lbmQobnVsbCwgbnVsbCwgY2FsbGJhY2spO1xuICB9XG4gIGVsc2Uge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgY3VycmVudFJlcXVlc3QgPSB0aGlzLl9jdXJyZW50UmVxdWVzdDtcbiAgICB0aGlzLndyaXRlKGRhdGEsIGVuY29kaW5nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZWxmLl9lbmRlZCA9IHRydWU7XG4gICAgICBjdXJyZW50UmVxdWVzdC5lbmQobnVsbCwgbnVsbCwgY2FsbGJhY2spO1xuICAgIH0pO1xuICAgIHRoaXMuX2VuZGluZyA9IHRydWU7XG4gIH1cbn07XG5cbi8vIFNldHMgYSBoZWFkZXIgdmFsdWUgb24gdGhlIGN1cnJlbnQgbmF0aXZlIHJlcXVlc3RcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLnNldEhlYWRlciA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICB0aGlzLl9vcHRpb25zLmhlYWRlcnNbbmFtZV0gPSB2YWx1ZTtcbiAgdGhpcy5fY3VycmVudFJlcXVlc3Quc2V0SGVhZGVyKG5hbWUsIHZhbHVlKTtcbn07XG5cbi8vIENsZWFycyBhIGhlYWRlciB2YWx1ZSBvbiB0aGUgY3VycmVudCBuYXRpdmUgcmVxdWVzdFxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUucmVtb3ZlSGVhZGVyID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgZGVsZXRlIHRoaXMuX29wdGlvbnMuaGVhZGVyc1tuYW1lXTtcbiAgdGhpcy5fY3VycmVudFJlcXVlc3QucmVtb3ZlSGVhZGVyKG5hbWUpO1xufTtcblxuLy8gR2xvYmFsIHRpbWVvdXQgZm9yIGFsbCB1bmRlcmx5aW5nIHJlcXVlc3RzXG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5zZXRUaW1lb3V0ID0gZnVuY3Rpb24gKG1zZWNzLCBjYWxsYmFjaykge1xuICBpZiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLm9uY2UoXCJ0aW1lb3V0XCIsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGlmICh0aGlzLnNvY2tldCkge1xuICAgIHN0YXJ0VGltZXIodGhpcywgbXNlY3MpO1xuICB9XG4gIGVsc2Uge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5vbmNlKFwic29ja2V0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHN0YXJ0VGltZXIoc2VsZiwgbXNlY3MpO1xuICAgIH0pO1xuICB9XG5cbiAgdGhpcy5vbmNlKFwicmVzcG9uc2VcIiwgY2xlYXJUaW1lcik7XG4gIHRoaXMub25jZShcImVycm9yXCIsIGNsZWFyVGltZXIpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuZnVuY3Rpb24gc3RhcnRUaW1lcihyZXF1ZXN0LCBtc2Vjcykge1xuICBjbGVhclRpbWVvdXQocmVxdWVzdC5fdGltZW91dCk7XG4gIHJlcXVlc3QuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICByZXF1ZXN0LmVtaXQoXCJ0aW1lb3V0XCIpO1xuICB9LCBtc2Vjcyk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyVGltZXIoKSB7XG4gIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbn1cblxuLy8gUHJveHkgYWxsIG90aGVyIHB1YmxpYyBDbGllbnRSZXF1ZXN0IG1ldGhvZHNcbltcbiAgXCJhYm9ydFwiLCBcImZsdXNoSGVhZGVyc1wiLCBcImdldEhlYWRlclwiLFxuICBcInNldE5vRGVsYXlcIiwgXCJzZXRTb2NrZXRLZWVwQWxpdmVcIixcbl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7XG4gIFJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiB0aGlzLl9jdXJyZW50UmVxdWVzdFttZXRob2RdKGEsIGIpO1xuICB9O1xufSk7XG5cbi8vIFByb3h5IGFsbCBwdWJsaWMgQ2xpZW50UmVxdWVzdCBwcm9wZXJ0aWVzXG5bXCJhYm9ydGVkXCIsIFwiY29ubmVjdGlvblwiLCBcInNvY2tldFwiXS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUsIHByb3BlcnR5LCB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jdXJyZW50UmVxdWVzdFtwcm9wZXJ0eV07IH0sXG4gIH0pO1xufSk7XG5cblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLl9zYW5pdGl6ZU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAvLyBFbnN1cmUgaGVhZGVycyBhcmUgYWx3YXlzIHByZXNlbnRcbiAgaWYgKCFvcHRpb25zLmhlYWRlcnMpIHtcbiAgICBvcHRpb25zLmhlYWRlcnMgPSB7fTtcbiAgfVxuXG4gIC8vIFNpbmNlIGh0dHAucmVxdWVzdCB0cmVhdHMgaG9zdCBhcyBhbiBhbGlhcyBvZiBob3N0bmFtZSxcbiAgLy8gYnV0IHRoZSB1cmwgbW9kdWxlIGludGVycHJldHMgaG9zdCBhcyBob3N0bmFtZSBwbHVzIHBvcnQsXG4gIC8vIGVsaW1pbmF0ZSB0aGUgaG9zdCBwcm9wZXJ0eSB0byBhdm9pZCBjb25mdXNpb24uXG4gIGlmIChvcHRpb25zLmhvc3QpIHtcbiAgICAvLyBVc2UgaG9zdG5hbWUgaWYgc2V0LCBiZWNhdXNlIGl0IGhhcyBwcmVjZWRlbmNlXG4gICAgaWYgKCFvcHRpb25zLmhvc3RuYW1lKSB7XG4gICAgICBvcHRpb25zLmhvc3RuYW1lID0gb3B0aW9ucy5ob3N0O1xuICAgIH1cbiAgICBkZWxldGUgb3B0aW9ucy5ob3N0O1xuICB9XG5cbiAgLy8gQ29tcGxldGUgdGhlIFVSTCBvYmplY3Qgd2hlbiBuZWNlc3NhcnlcbiAgaWYgKCFvcHRpb25zLnBhdGhuYW1lICYmIG9wdGlvbnMucGF0aCkge1xuICAgIHZhciBzZWFyY2hQb3MgPSBvcHRpb25zLnBhdGguaW5kZXhPZihcIj9cIik7XG4gICAgaWYgKHNlYXJjaFBvcyA8IDApIHtcbiAgICAgIG9wdGlvbnMucGF0aG5hbWUgPSBvcHRpb25zLnBhdGg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgb3B0aW9ucy5wYXRobmFtZSA9IG9wdGlvbnMucGF0aC5zdWJzdHJpbmcoMCwgc2VhcmNoUG9zKTtcbiAgICAgIG9wdGlvbnMuc2VhcmNoID0gb3B0aW9ucy5wYXRoLnN1YnN0cmluZyhzZWFyY2hQb3MpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vLyBFeGVjdXRlcyB0aGUgbmV4dCBuYXRpdmUgcmVxdWVzdCAoaW5pdGlhbCBvciByZWRpcmVjdClcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLl9wZXJmb3JtUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gTG9hZCB0aGUgbmF0aXZlIHByb3RvY29sXG4gIHZhciBwcm90b2NvbCA9IHRoaXMuX29wdGlvbnMucHJvdG9jb2w7XG4gIHZhciBuYXRpdmVQcm90b2NvbCA9IHRoaXMuX29wdGlvbnMubmF0aXZlUHJvdG9jb2xzW3Byb3RvY29sXTtcbiAgaWYgKCFuYXRpdmVQcm90b2NvbCkge1xuICAgIHRoaXMuZW1pdChcImVycm9yXCIsIG5ldyBUeXBlRXJyb3IoXCJVbnN1cHBvcnRlZCBwcm90b2NvbCBcIiArIHByb3RvY29sKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gSWYgc3BlY2lmaWVkLCB1c2UgdGhlIGFnZW50IGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3RvY29sXG4gIC8vIChIVFRQIGFuZCBIVFRQUyB1c2UgZGlmZmVyZW50IHR5cGVzIG9mIGFnZW50cylcbiAgaWYgKHRoaXMuX29wdGlvbnMuYWdlbnRzKSB7XG4gICAgdmFyIHNjaGVtZSA9IHByb3RvY29sLnN1YnN0cigwLCBwcm90b2NvbC5sZW5ndGggLSAxKTtcbiAgICB0aGlzLl9vcHRpb25zLmFnZW50ID0gdGhpcy5fb3B0aW9ucy5hZ2VudHNbc2NoZW1lXTtcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgbmF0aXZlIHJlcXVlc3RcbiAgdmFyIHJlcXVlc3QgPSB0aGlzLl9jdXJyZW50UmVxdWVzdCA9XG4gICAgICAgIG5hdGl2ZVByb3RvY29sLnJlcXVlc3QodGhpcy5fb3B0aW9ucywgdGhpcy5fb25OYXRpdmVSZXNwb25zZSk7XG4gIHRoaXMuX2N1cnJlbnRVcmwgPSB1cmwuZm9ybWF0KHRoaXMuX29wdGlvbnMpO1xuXG4gIC8vIFNldCB1cCBldmVudCBoYW5kbGVyc1xuICByZXF1ZXN0Ll9yZWRpcmVjdGFibGUgPSB0aGlzO1xuICBmb3IgKHZhciBldmVudCBpbiBldmVudEhhbmRsZXJzKSB7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIHJlcXVlc3Qub24oZXZlbnQsIGV2ZW50SGFuZGxlcnNbZXZlbnRdKTtcbiAgICB9XG4gIH1cblxuICAvLyBFbmQgYSByZWRpcmVjdGVkIHJlcXVlc3RcbiAgLy8gKFRoZSBmaXJzdCByZXF1ZXN0IG11c3QgYmUgZW5kZWQgZXhwbGljaXRseSB3aXRoIFJlZGlyZWN0YWJsZVJlcXVlc3QjZW5kKVxuICBpZiAodGhpcy5faXNSZWRpcmVjdCkge1xuICAgIC8vIFdyaXRlIHRoZSByZXF1ZXN0IGVudGl0eSBhbmQgZW5kLlxuICAgIHZhciBpID0gMDtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGJ1ZmZlcnMgPSB0aGlzLl9yZXF1ZXN0Qm9keUJ1ZmZlcnM7XG4gICAgKGZ1bmN0aW9uIHdyaXRlTmV4dChlcnJvcikge1xuICAgICAgLy8gT25seSB3cml0ZSBpZiB0aGlzIHJlcXVlc3QgaGFzIG5vdCBiZWVuIHJlZGlyZWN0ZWQgeWV0XG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgICAgaWYgKHJlcXVlc3QgPT09IHNlbGYuX2N1cnJlbnRSZXF1ZXN0KSB7XG4gICAgICAgIC8vIFJlcG9ydCBhbnkgd3JpdGUgZXJyb3JzXG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBzZWxmLmVtaXQoXCJlcnJvclwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV3JpdGUgdGhlIG5leHQgYnVmZmVyIGlmIHRoZXJlIGFyZSBzdGlsbCBsZWZ0XG4gICAgICAgIGVsc2UgaWYgKGkgPCBidWZmZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHZhciBidWZmZXIgPSBidWZmZXJzW2krK107XG4gICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgICAgICBpZiAoIXJlcXVlc3QuZmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJlcXVlc3Qud3JpdGUoYnVmZmVyLmRhdGEsIGJ1ZmZlci5lbmNvZGluZywgd3JpdGVOZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5kIHRoZSByZXF1ZXN0IGlmIGBlbmRgIGhhcyBiZWVuIGNhbGxlZCBvbiB1c1xuICAgICAgICBlbHNlIGlmIChzZWxmLl9lbmRlZCkge1xuICAgICAgICAgIHJlcXVlc3QuZW5kKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KCkpO1xuICB9XG59O1xuXG4vLyBQcm9jZXNzZXMgYSByZXNwb25zZSBmcm9tIHRoZSBjdXJyZW50IG5hdGl2ZSByZXF1ZXN0XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5fcHJvY2Vzc1Jlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gIC8vIFN0b3JlIHRoZSByZWRpcmVjdGVkIHJlc3BvbnNlXG4gIHZhciBzdGF0dXNDb2RlID0gcmVzcG9uc2Uuc3RhdHVzQ29kZTtcbiAgaWYgKHRoaXMuX29wdGlvbnMudHJhY2tSZWRpcmVjdHMpIHtcbiAgICB0aGlzLl9yZWRpcmVjdHMucHVzaCh7XG4gICAgICB1cmw6IHRoaXMuX2N1cnJlbnRVcmwsXG4gICAgICBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzLFxuICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJGQzcyMzHCpzYuNDogVGhlIDN4eCAoUmVkaXJlY3Rpb24pIGNsYXNzIG9mIHN0YXR1cyBjb2RlIGluZGljYXRlc1xuICAvLyB0aGF0IGZ1cnRoZXIgYWN0aW9uIG5lZWRzIHRvIGJlIHRha2VuIGJ5IHRoZSB1c2VyIGFnZW50IGluIG9yZGVyIHRvXG4gIC8vIGZ1bGZpbGwgdGhlIHJlcXVlc3QuIElmIGEgTG9jYXRpb24gaGVhZGVyIGZpZWxkIGlzIHByb3ZpZGVkLFxuICAvLyB0aGUgdXNlciBhZ2VudCBNQVkgYXV0b21hdGljYWxseSByZWRpcmVjdCBpdHMgcmVxdWVzdCB0byB0aGUgVVJJXG4gIC8vIHJlZmVyZW5jZWQgYnkgdGhlIExvY2F0aW9uIGZpZWxkIHZhbHVlLFxuICAvLyBldmVuIGlmIHRoZSBzcGVjaWZpYyBzdGF0dXMgY29kZSBpcyBub3QgdW5kZXJzdG9vZC5cbiAgdmFyIGxvY2F0aW9uID0gcmVzcG9uc2UuaGVhZGVycy5sb2NhdGlvbjtcbiAgaWYgKGxvY2F0aW9uICYmIHRoaXMuX29wdGlvbnMuZm9sbG93UmVkaXJlY3RzICE9PSBmYWxzZSAmJlxuICAgICAgc3RhdHVzQ29kZSA+PSAzMDAgJiYgc3RhdHVzQ29kZSA8IDQwMCkge1xuICAgIC8vIEFib3J0IHRoZSBjdXJyZW50IHJlcXVlc3RcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5vbihcImVycm9yXCIsIG5vb3ApO1xuICAgIHRoaXMuX2N1cnJlbnRSZXF1ZXN0LmFib3J0KCk7XG4gICAgLy8gRGlzY2FyZCB0aGUgcmVtYWluZGVyIG9mIHRoZSByZXNwb25zZSB0byBhdm9pZCB3YWl0aW5nIGZvciBkYXRhXG4gICAgcmVzcG9uc2UuZGVzdHJveSgpO1xuXG4gICAgLy8gUkZDNzIzMcKnNi40OiBBIGNsaWVudCBTSE9VTEQgZGV0ZWN0IGFuZCBpbnRlcnZlbmVcbiAgICAvLyBpbiBjeWNsaWNhbCByZWRpcmVjdGlvbnMgKGkuZS4sIFwiaW5maW5pdGVcIiByZWRpcmVjdGlvbiBsb29wcykuXG4gICAgaWYgKCsrdGhpcy5fcmVkaXJlY3RDb3VudCA+IHRoaXMuX29wdGlvbnMubWF4UmVkaXJlY3RzKSB7XG4gICAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBuZXcgVG9vTWFueVJlZGlyZWN0c0Vycm9yKCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJGQzcyMzHCpzYuNDogQXV0b21hdGljIHJlZGlyZWN0aW9uIG5lZWRzIHRvIGRvbmUgd2l0aFxuICAgIC8vIGNhcmUgZm9yIG1ldGhvZHMgbm90IGtub3duIHRvIGJlIHNhZmUsIFvigKZdXG4gICAgLy8gUkZDNzIzMcKnNi40LjLigJMzOiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCBhIHVzZXIgYWdlbnQgTUFZIGNoYW5nZVxuICAgIC8vIHRoZSByZXF1ZXN0IG1ldGhvZCBmcm9tIFBPU1QgdG8gR0VUIGZvciB0aGUgc3Vic2VxdWVudCByZXF1ZXN0LlxuICAgIGlmICgoc3RhdHVzQ29kZSA9PT0gMzAxIHx8IHN0YXR1c0NvZGUgPT09IDMwMikgJiYgdGhpcy5fb3B0aW9ucy5tZXRob2QgPT09IFwiUE9TVFwiIHx8XG4gICAgICAgIC8vIFJGQzcyMzHCpzYuNC40OiBUaGUgMzAzIChTZWUgT3RoZXIpIHN0YXR1cyBjb2RlIGluZGljYXRlcyB0aGF0XG4gICAgICAgIC8vIHRoZSBzZXJ2ZXIgaXMgcmVkaXJlY3RpbmcgdGhlIHVzZXIgYWdlbnQgdG8gYSBkaWZmZXJlbnQgcmVzb3VyY2UgW+KApl1cbiAgICAgICAgLy8gQSB1c2VyIGFnZW50IGNhbiBwZXJmb3JtIGEgcmV0cmlldmFsIHJlcXVlc3QgdGFyZ2V0aW5nIHRoYXQgVVJJXG4gICAgICAgIC8vIChhIEdFVCBvciBIRUFEIHJlcXVlc3QgaWYgdXNpbmcgSFRUUCkgW+KApl1cbiAgICAgICAgKHN0YXR1c0NvZGUgPT09IDMwMykgJiYgIS9eKD86R0VUfEhFQUQpJC8udGVzdCh0aGlzLl9vcHRpb25zLm1ldGhvZCkpIHtcbiAgICAgIHRoaXMuX29wdGlvbnMubWV0aG9kID0gXCJHRVRcIjtcbiAgICAgIC8vIERyb3AgYSBwb3NzaWJsZSBlbnRpdHkgYW5kIGhlYWRlcnMgcmVsYXRlZCB0byBpdFxuICAgICAgdGhpcy5fcmVxdWVzdEJvZHlCdWZmZXJzID0gW107XG4gICAgICByZW1vdmVNYXRjaGluZ0hlYWRlcnMoL15jb250ZW50LS9pLCB0aGlzLl9vcHRpb25zLmhlYWRlcnMpO1xuICAgIH1cblxuICAgIC8vIERyb3AgdGhlIEhvc3QgaGVhZGVyLCBhcyB0aGUgcmVkaXJlY3QgbWlnaHQgbGVhZCB0byBhIGRpZmZlcmVudCBob3N0XG4gICAgdmFyIHByZXZpb3VzSG9zdE5hbWUgPSByZW1vdmVNYXRjaGluZ0hlYWRlcnMoL15ob3N0JC9pLCB0aGlzLl9vcHRpb25zLmhlYWRlcnMpIHx8XG4gICAgICB1cmwucGFyc2UodGhpcy5fY3VycmVudFVybCkuaG9zdG5hbWU7XG5cbiAgICAvLyBDcmVhdGUgdGhlIHJlZGlyZWN0ZWQgcmVxdWVzdFxuICAgIHZhciByZWRpcmVjdFVybCA9IHVybC5yZXNvbHZlKHRoaXMuX2N1cnJlbnRVcmwsIGxvY2F0aW9uKTtcbiAgICBkZWJ1ZyhcInJlZGlyZWN0aW5nIHRvXCIsIHJlZGlyZWN0VXJsKTtcbiAgICB0aGlzLl9pc1JlZGlyZWN0ID0gdHJ1ZTtcbiAgICB2YXIgcmVkaXJlY3RVcmxQYXJ0cyA9IHVybC5wYXJzZShyZWRpcmVjdFVybCk7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLl9vcHRpb25zLCByZWRpcmVjdFVybFBhcnRzKTtcblxuICAgIC8vIERyb3AgdGhlIEF1dGhvcml6YXRpb24gaGVhZGVyIGlmIHJlZGlyZWN0aW5nIHRvIGFub3RoZXIgaG9zdFxuICAgIGlmIChyZWRpcmVjdFVybFBhcnRzLmhvc3RuYW1lICE9PSBwcmV2aW91c0hvc3ROYW1lKSB7XG4gICAgICByZW1vdmVNYXRjaGluZ0hlYWRlcnMoL15hdXRob3JpemF0aW9uJC9pLCB0aGlzLl9vcHRpb25zLmhlYWRlcnMpO1xuICAgIH1cblxuICAgIC8vIEV2YWx1YXRlIHRoZSBiZWZvcmVSZWRpcmVjdCBjYWxsYmFja1xuICAgIGlmICh0eXBlb2YgdGhpcy5fb3B0aW9ucy5iZWZvcmVSZWRpcmVjdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB2YXIgcmVzcG9uc2VEZXRhaWxzID0geyBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzIH07XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9vcHRpb25zLmJlZm9yZVJlZGlyZWN0LmNhbGwobnVsbCwgdGhpcy5fb3B0aW9ucywgcmVzcG9uc2VEZXRhaWxzKTtcbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fc2FuaXRpemVPcHRpb25zKHRoaXMuX29wdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gdGhlIHJlZGlyZWN0ZWQgcmVxdWVzdFxuICAgIHRyeSB7XG4gICAgICB0aGlzLl9wZXJmb3JtUmVxdWVzdCgpO1xuICAgIH1cbiAgICBjYXRjaCAoY2F1c2UpIHtcbiAgICAgIHZhciBlcnJvciA9IG5ldyBSZWRpcmVjdGlvbkVycm9yKFwiUmVkaXJlY3RlZCByZXF1ZXN0IGZhaWxlZDogXCIgKyBjYXVzZS5tZXNzYWdlKTtcbiAgICAgIGVycm9yLmNhdXNlID0gY2F1c2U7XG4gICAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBlcnJvcik7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIC8vIFRoZSByZXNwb25zZSBpcyBub3QgYSByZWRpcmVjdDsgcmV0dXJuIGl0IGFzLWlzXG4gICAgcmVzcG9uc2UucmVzcG9uc2VVcmwgPSB0aGlzLl9jdXJyZW50VXJsO1xuICAgIHJlc3BvbnNlLnJlZGlyZWN0cyA9IHRoaXMuX3JlZGlyZWN0cztcbiAgICB0aGlzLmVtaXQoXCJyZXNwb25zZVwiLCByZXNwb25zZSk7XG5cbiAgICAvLyBDbGVhbiB1cFxuICAgIHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycyA9IFtdO1xuICB9XG59O1xuXG4vLyBXcmFwcyB0aGUga2V5L3ZhbHVlIG9iamVjdCBvZiBwcm90b2NvbHMgd2l0aCByZWRpcmVjdCBmdW5jdGlvbmFsaXR5XG5mdW5jdGlvbiB3cmFwKHByb3RvY29scykge1xuICAvLyBEZWZhdWx0IHNldHRpbmdzXG4gIHZhciBleHBvcnRzID0ge1xuICAgIG1heFJlZGlyZWN0czogMjEsXG4gICAgbWF4Qm9keUxlbmd0aDogMTAgKiAxMDI0ICogMTAyNCxcbiAgfTtcblxuICAvLyBXcmFwIGVhY2ggcHJvdG9jb2xcbiAgdmFyIG5hdGl2ZVByb3RvY29scyA9IHt9O1xuICBPYmplY3Qua2V5cyhwcm90b2NvbHMpLmZvckVhY2goZnVuY3Rpb24gKHNjaGVtZSkge1xuICAgIHZhciBwcm90b2NvbCA9IHNjaGVtZSArIFwiOlwiO1xuICAgIHZhciBuYXRpdmVQcm90b2NvbCA9IG5hdGl2ZVByb3RvY29sc1twcm90b2NvbF0gPSBwcm90b2NvbHNbc2NoZW1lXTtcbiAgICB2YXIgd3JhcHBlZFByb3RvY29sID0gZXhwb3J0c1tzY2hlbWVdID0gT2JqZWN0LmNyZWF0ZShuYXRpdmVQcm90b2NvbCk7XG5cbiAgICAvLyBFeGVjdXRlcyBhIHJlcXVlc3QsIGZvbGxvd2luZyByZWRpcmVjdHNcbiAgICB3cmFwcGVkUHJvdG9jb2wucmVxdWVzdCA9IGZ1bmN0aW9uIChpbnB1dCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgIC8vIFBhcnNlIHBhcmFtZXRlcnNcbiAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIHVybFN0ciA9IGlucHV0O1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlucHV0ID0gdXJsVG9PcHRpb25zKG5ldyBVUkwodXJsU3RyKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgaW5wdXQgPSB1cmwucGFyc2UodXJsU3RyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAoVVJMICYmIChpbnB1dCBpbnN0YW5jZW9mIFVSTCkpIHtcbiAgICAgICAgaW5wdXQgPSB1cmxUb09wdGlvbnMoaW5wdXQpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgICAgb3B0aW9ucyA9IGlucHV0O1xuICAgICAgICBpbnB1dCA9IHsgcHJvdG9jb2w6IHByb3RvY29sIH07XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgZGVmYXVsdHNcbiAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgbWF4UmVkaXJlY3RzOiBleHBvcnRzLm1heFJlZGlyZWN0cyxcbiAgICAgICAgbWF4Qm9keUxlbmd0aDogZXhwb3J0cy5tYXhCb2R5TGVuZ3RoLFxuICAgICAgfSwgaW5wdXQsIG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy5uYXRpdmVQcm90b2NvbHMgPSBuYXRpdmVQcm90b2NvbHM7XG5cbiAgICAgIGFzc2VydC5lcXVhbChvcHRpb25zLnByb3RvY29sLCBwcm90b2NvbCwgXCJwcm90b2NvbCBtaXNtYXRjaFwiKTtcbiAgICAgIGRlYnVnKFwib3B0aW9uc1wiLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBuZXcgUmVkaXJlY3RhYmxlUmVxdWVzdChvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfTtcblxuICAgIC8vIEV4ZWN1dGVzIGEgR0VUIHJlcXVlc3QsIGZvbGxvd2luZyByZWRpcmVjdHNcbiAgICB3cmFwcGVkUHJvdG9jb2wuZ2V0ID0gZnVuY3Rpb24gKGlucHV0LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgdmFyIHJlcXVlc3QgPSB3cmFwcGVkUHJvdG9jb2wucmVxdWVzdChpbnB1dCwgb3B0aW9ucywgY2FsbGJhY2spO1xuICAgICAgcmVxdWVzdC5lbmQoKTtcbiAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgIH07XG4gIH0pO1xuICByZXR1cm4gZXhwb3J0cztcbn1cblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbmZ1bmN0aW9uIG5vb3AoKSB7IC8qIGVtcHR5ICovIH1cblxuLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi9tYXN0ZXIvbGliL2ludGVybmFsL3VybC5qc1xuZnVuY3Rpb24gdXJsVG9PcHRpb25zKHVybE9iamVjdCkge1xuICB2YXIgb3B0aW9ucyA9IHtcbiAgICBwcm90b2NvbDogdXJsT2JqZWN0LnByb3RvY29sLFxuICAgIGhvc3RuYW1lOiB1cmxPYmplY3QuaG9zdG5hbWUuc3RhcnRzV2l0aChcIltcIikgP1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgIHVybE9iamVjdC5ob3N0bmFtZS5zbGljZSgxLCAtMSkgOlxuICAgICAgdXJsT2JqZWN0Lmhvc3RuYW1lLFxuICAgIGhhc2g6IHVybE9iamVjdC5oYXNoLFxuICAgIHNlYXJjaDogdXJsT2JqZWN0LnNlYXJjaCxcbiAgICBwYXRobmFtZTogdXJsT2JqZWN0LnBhdGhuYW1lLFxuICAgIHBhdGg6IHVybE9iamVjdC5wYXRobmFtZSArIHVybE9iamVjdC5zZWFyY2gsXG4gICAgaHJlZjogdXJsT2JqZWN0LmhyZWYsXG4gIH07XG4gIGlmICh1cmxPYmplY3QucG9ydCAhPT0gXCJcIikge1xuICAgIG9wdGlvbnMucG9ydCA9IE51bWJlcih1cmxPYmplY3QucG9ydCk7XG4gIH1cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU1hdGNoaW5nSGVhZGVycyhyZWdleCwgaGVhZGVycykge1xuICB2YXIgbGFzdFZhbHVlO1xuICBmb3IgKHZhciBoZWFkZXIgaW4gaGVhZGVycykge1xuICAgIGlmIChyZWdleC50ZXN0KGhlYWRlcikpIHtcbiAgICAgIGxhc3RWYWx1ZSA9IGhlYWRlcnNbaGVhZGVyXTtcbiAgICAgIGRlbGV0ZSBoZWFkZXJzW2hlYWRlcl07XG4gICAgfVxuICB9XG4gIHJldHVybiBsYXN0VmFsdWU7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVycm9yVHlwZShjb2RlLCBkZWZhdWx0TWVzc2FnZSkge1xuICBmdW5jdGlvbiBDdXN0b21FcnJvcihtZXNzYWdlKSB7XG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCBkZWZhdWx0TWVzc2FnZTtcbiAgfVxuICBDdXN0b21FcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcbiAgQ3VzdG9tRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3VzdG9tRXJyb3I7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5uYW1lID0gXCJFcnJvciBbXCIgKyBjb2RlICsgXCJdXCI7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5jb2RlID0gY29kZTtcbiAgcmV0dXJuIEN1c3RvbUVycm9yO1xufVxuXG4vLyBFeHBvcnRzXG5tb2R1bGUuZXhwb3J0cyA9IHdyYXAoeyBodHRwOiBodHRwLCBodHRwczogaHR0cHMgfSk7XG5tb2R1bGUuZXhwb3J0cy53cmFwID0gd3JhcDtcbiJdfQ==